/*! For license information please see ecd5c527-d2dacd96987c3570f416.js.LICENSE.txt */
"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[247],{48169:function(t,e,i){i.d(e,{BG:function(){return Pr},H4:function(){return ni},IY:function(){return vr},SV:function(){return Dn},Vj:function(){return Vt},ZD:function(){return fr},p_:function(){return rt},qI:function(){return wr},rD:function(){return E},x3:function(){return Qt}});var n,r,o,s,a,l,u=i(11752),c=i(97326),h=i(60136),d=i(82963),g=i(61120),v=i(84506),f=i(15671),y=i(43144),p=i(29439),b=i(93433),x=i(4942),m=i(64687),k=i.n(m),L=i(29540),I=i(96486),w=i.n(I),P=i(78261),C=i.n(P),D=i(50579),A=i(61619);function R(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=(0,g.Z)(t);if(e){var r=(0,g.Z)(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return(0,d.Z)(this,i)}}function S(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return T(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return T(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw o}}}}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Z,M,O,E,N,H;(Z||(Z={})).PointCloud="pointCloudTool",function(t){t.VideoTextTool="videoTextTool",t.VideoTagTool="videoTagTool",t.VideoClipTool="videoClipTool"}(M||(M={})),function(t){t[t.Rect=0]="Rect",t[t.Tag=1]="Tag"}(O||(O={})),function(t){t.Rect="rectTool",t.Tag="tagTool",t.Point="pointTool",t.PointMarker="pointMarkerTool",t.Segmentation="segmentationTool",t.Filter="filterTool",t.Text="textTool",t.Polygon="polygonTool",t.Line="lineTool",t.LineMarker="lineMarkerTool",t.Empty="emptyTool",t.FolderTag="folderTagTool",t.RectTrack="rectTrackTool",t.Face="faceTool",t.ClientAttribute="clientAttributeTool",t.OCRRelation="OCRRelationTool"}(E||(E={})),function(t){t.Check="check"}(N||(N={})),function(t){t[t.nothing=0]="nothing",t[t.RectBG=1]="RectBG",t[t.showOrder=2]="showOrder"}(H||(H={}));var B,_,z=(n={},(0,x.Z)(n,E.Rect,"拉框"),(0,x.Z)(n,E.Tag,"标签"),(0,x.Z)(n,E.Point,"标点"),(0,x.Z)(n,E.PointMarker,"列表标点"),(0,x.Z)(n,E.Segmentation,"前景分割"),(0,x.Z)(n,E.Filter,"筛选"),(0,x.Z)(n,E.Text,"文本"),(0,x.Z)(n,E.Polygon,"多边形"),(0,x.Z)(n,E.Line,"线条"),(0,x.Z)(n,E.LineMarker,"列表线条"),(0,x.Z)(n,E.FolderTag,"文件夹标签"),(0,x.Z)(n,E.RectTrack,"拉框跟踪"),(0,x.Z)(n,E.Face,"人脸106工具"),(0,x.Z)(n,E.ClientAttribute,"客户端属性工具"),(0,x.Z)(n,E.OCRRelation,"OCR关联关系工具"),(0,x.Z)(n,M.VideoTextTool,"视频文本"),(0,x.Z)(n,M.VideoTagTool,"视频标签"),(0,x.Z)(n,M.VideoClipTool,"视频截取"),(0,x.Z)(n,Z.PointCloud,"点云"),n);!function(t){t[t.noDepend=1]="noDepend",t[t.dependOrigin=2]="dependOrigin",t[t.dependShape=3]="dependShape",t[t.dependLine=4]="dependLine",t[t.dependPolygon=5]="dependPolygon",t[t.dependPreShape=101]="dependPreShape",t[t.dependPreLine=102]="dependPreLine",t[t.dependPrePolygon=103]="dependPrePolygon"}(B||(B={})),function(t){t.lc="leftClick",t.rc="rightClick",t.clc="ctrlLeftClick",t.crc="ctrlRightClick"}(_||(_={}));var F,j,U,V,W,K,X,G,Y;!function(t){t[t.Normal=1]="Normal",t[t.Modify=2]="Modify"}(F||(F={})),function(t){t[t.Line=0]="Line",t[t.Curve=1]="Curve"}(j||(j={})),function(t){t[t.SingleColor=0]="SingleColor",t[t.MultiColor=1]="MultiColor"}(U||(U={})),function(t){t[t.Form=1]="Form",t[t.Json=2]="Json"}(V||(V={})),function(t){t[t.Point=0]="Point",t[t.Line=1]="Line",t[t.Plane=2]="Plane"}(W||(W={})),function(t){t[t.None=0]="None",t[t.Drawing=1]="Drawing",t[t.Edit=2]="Edit"}(K||(K={})),function(t){t[t.Backward=0]="Backward",t[t.Forward=1]="Forward",t[t.JumpSkip=2]="JumpSkip",t[t.None=3]="None"}(X||(X={})),function(t){t[t.Wait=0]="Wait",t[t.Pass=1]="Pass",t[t.Fail=2]="Fail",t[t.Loading=3]="Loading"}(G||(G={})),function(t){t[t.AnyString=0]="AnyString",t[t.Order=1]="Order",t[t.EnglishOnly=2]="EnglishOnly",t[t.NumberOnly=3]="NumberOnly",t[t.CustomFormat=4]="CustomFormat"}(Y||(Y={}));var J,q=1e3,Q="normal normal 500 14px Arial";!function(t){t[t.ImgList=1e3]="ImgList",t[t.TrackPrediction=1001]="TrackPrediction",t[t.ImgSearch=1002]="ImgSearch"}(J||(J={}));var $,tt=(r={},(0,x.Z)(r,Z.PointCloud,"sensebeepc"),(0,x.Z)(r,E.ClientAttribute,"sensebeepc-EnumAttributeTool"),(0,x.Z)(r,E.Face,"sensebeepc-FacePointsLabellingTool"),(0,x.Z)(r,E.OCRRelation,"sensebeepc-OCRRelationTool"),r),et=(o={},(0,x.Z)(o,Z.PointCloud,"点云客户端"),(0,x.Z)(o,E.ClientAttribute,"客户端属性工具"),(0,x.Z)(o,E.Face,"人脸106点工具"),(0,x.Z)(o,E.OCRRelation,"OCR关联关系工具"),o),it=16,nt=10;!function(t){t[t.Normal=0]="Normal",t[t.Rect=1]="Rect"}($||($={}));var rt=Object.freeze({__proto__:null,editStepWidth:320,get EPointCloudName(){return Z},get EVideoToolName(){return M},get EToolType(){return O},get EToolName(){return E},get ECheckModel(){return N},get ERectPattern(){return H},TOOL_NAME:z,get EDependPattern(){return B},get EFilterToolOperation(){return _},OPERATION_LIST:{leftClick:"鼠标左键",rightClick:"鼠标右键",ctrlLeftClick:"ctrl + 鼠标左键",ctrlRightClick:"ctrl + 鼠标右键"},get EAnnotationMode(){return F},get ELineTypes(){return j},get ELineColor(){return U},get ESelectedType(){return V},get EDragTarget(){return W},get EDrawPointPattern(){return K},get EPageOperator(){return X},get EAuditStatus(){return G},get ETextType(){return Y},TEXT_TYPE:{0:"任意字符",1:"序号",2:"仅英文",3:"仅数字"},TEXT_ATTRIBUTE_MAX_LENGTH:q,TEXT_ATTRIBUTE_LINE_HEIGHT:16,DEFAULT_TEXT_MAX_WIDTH:300,DEFAULT_FONT:Q,get EThumbnailOption(){return J},CLIENT_TOOL_HEAD_TYPE:tt,CLIENT_TOOL_NAME:et,SEGMENT_NUMBER:it,edgeAdsorptionScope:nt,get EPolygonPattern(){return $}}),ot=Object.defineProperty,st=Object.defineProperties,at=Object.getOwnPropertyDescriptors,lt=Object.getOwnPropertySymbols,ut=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable,ht=function(t,e,i){return e in t?ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},dt=function(t,e){for(var i in e||(e={}))ut.call(e,i)&&ht(t,i,e[i]);if(lt){var n,r=S(lt(e));try{for(r.s();!(n=r.n()).done;){i=n.value;ct.call(e,i)&&ht(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},gt=function(t,e){return st(t,at(e))};function vt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16;if(t.length<4)return t;var r,o,s,a,l,u,c,h,d,g,v,f,y,p=[],b=t.slice(0);for(i?(b.unshift(t[t.length-1]),b.unshift(t[t.length-2]),b.unshift(t[t.length-1]),b.unshift(t[t.length-2]),b.push(t[0]),b.push(t[1])):(b.unshift(t[1]),b.unshift(t[0]),b.push(t[t.length-2]),b.push(t[t.length-1])),y=2;y<b.length-4;y+=2)for(s=(b[y+2]-b[y-2])*e,a=(b[y+4]-b[y-0])*e,l=(b[y+3]-b[y-1])*e,u=(b[y+5]-b[y+1])*e,f=0;f<=n;f++)v=f/n,c=2*Math.pow(v,3)-3*Math.pow(v,2)+1,h=-2*Math.pow(v,3)+3*Math.pow(v,2),d=Math.pow(v,3)-2*Math.pow(v,2)+v,g=Math.pow(v,3)-Math.pow(v,2),r=c*b[y]+h*b[y+2]+d*s+g*a,o=c*b[y+1]+h*b[y+3]+d*l+g*u,p.push(r),p.push(o);for(var x=[],m=0;m<p.length-1;m+=2)x.push({x:p[m],y:p[m+1]});if(i)for(var k=0;k<n+1;k++){var L=x.shift();x.push(L)}return x}var ft=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;return vt(t.reduce((function(t,e){return[].concat((0,b.Z)(t),[e.x,e.y])}),[]),.5,!1,e)};function yt(t,e){var i,n,r,o,s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.Line,l=0;e=(0,b.Z)(e),a===j.Curve&&(e=vt(e.reduce((function(t,e){return[].concat((0,b.Z)(t),[e.x,e.y])}),[]),.5,!0,it)),i=e,o=(0,p.Z)(i,1)[0];var u=e.length;for(n=1;n<=u;n++)s=e[n%u],t.x>Math.min(o.x,s.x)&&t.x<=Math.max(o.x,s.x)&&t.y<=Math.max(o.y,s.y)&&o.x!==s.x&&(r=(t.x-o.x)*(s.y-o.y)/(s.x-o.x)+o.y,(o.y===s.y||t.y<=r)&&l++),o=s;return l%2!=0}function pt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.map((function(t){return gt(dt({},t),{x:t.x*e,y:t.y*e})}))}var bt=Math.pow,xt=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"add",value:function(t,e){return{x:t.x+e.x,y:t.y+e.y}}},{key:"getVector",value:function(t,e){return{x:e.x-t.x,y:e.y-t.y}}},{key:"len",value:function(t){return Math.sqrt(bt(t.x,2)+bt(t.y,2))}},{key:"dotProduct",value:function(t,e){return t.x*e.x+t.y+e.y}}]),t}(),mt=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"tanAPlusB",value:function(t,e){return(t+e)/(1-t*e)}},{key:"sinAPlusB",value:function(t,e,i,n){return n*t+e*i}},{key:"cosAPlusB",value:function(t,e,i,n){return e*n-t*i}}]),t}(),kt=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"getRotate",value:function(t){return t+90>=360?t+90-360:t+90}},{key:"getLineLength",value:function(t,e){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}},{key:"getTextArea",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Q,r=arguments.length>4?arguments[4]:void 0;if("string"!=typeof e)return{width:0,height:0};var o=t.getContext("2d");o.font=n;var s=0;void 0===r&&"undefined"!=typeof window&&(r=t&&parseInt(window.getComputedStyle(t).lineHeight,10)||parseInt(window.getComputedStyle(document.body).lineHeight,10));var a=0;"undefined"!=typeof window&&(a=t&&parseInt(window.getComputedStyle(t).fontSize,10)||parseInt(window.getComputedStyle(document.body).fontSize,10)||0);for(var l=e.split("\n"),u=0,c=0;c<l.length;c++){for(var h=l[c].split(""),d="",g=0;g<h.length;g++){var v=d+h[g],f=o.measureText(v).width;f>i&&g>0?(d=h[g],s+=r,u=i):(d=v,f>u&&(u=f))}c!==l.length-1&&(s+=r)}return{width:u,height:s+a,lineHeight:r,fontHeight:a}}},{key:"getLineCenterPoint",value:function(t){var e=(0,p.Z)(t,2),i=e[0],n=e[1],r=xt.getVector(i,n);return{x:i.x+r.x/2,y:i.y+r.y/2}}},{key:"getPerpendicularLine",value:function(t){if(2===t.length){var e=(0,p.Z)(t,2),i=e[0],n=e[1];return[n,{x:n.x+n.y-i.y,y:n.y-(n.x-i.x)}]}}},{key:"getPerpendicularFootOfLine",value:function(t,e){if(2!==t.length)return t;var i=this.getPerpendicularLine(t);if(!i)return t;var n=(0,p.Z)(i,2),r=n[0],o=n[1];return this.getFootOfPerpendicular(e,r,o).footPoint}},{key:"getQuadrangleFromTriangle",value:function(t){if(3!==t.length)return t;var e=(0,p.Z)(t,3),i=e[0],n=e[1],r=e[2];return[i,n,r,{x:r.x+i.x-n.x,y:r.y+i.y-n.y}]}},{key:"getRectPerpendicularOffset",value:function(t,e,i){var n=(0,p.Z)(i,2),r=n[0],o=n[1],s=this.getFootOfPerpendicular(t,r,o).footPoint,a=this.getFootOfPerpendicular(e,r,o).footPoint,l={x:s.x-a.x,y:s.y-a.y},u=xt.add(e,l);return xt.getVector(t,u)}},{key:"getArrayIndex",value:function(t,e){return t<0?e+t:t>=e?t-e:t}},{key:"getPointListFromPointOffset",value:function(t,e,i){var n=this.getArrayIndex(e-1,t.length),r=this.getArrayIndex(e+1,t.length),o=this.getArrayIndex(e-2,t.length),s=(0,b.Z)(t);s[e]=xt.add(s[e],i);var a=this.getFootOfPerpendicular(s[e],s[o],s[n]).footPoint,l=this.getFootOfPerpendicular(s[e],s[r],s[o]).footPoint;return s[n]=a,s[r]=l,s}},{key:"getRectCenterPoint",value:function(t){var e=(0,p.Z)(t,3),i=e[0],n=e[2];return{x:(i.x+n.x)/2,y:(i.y+n.y)/2}}},{key:"rotateRectPointList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=arguments.length>1?arguments[1]:void 0,i=this.getRectCenterPoint(e),n=Math.PI,r=Math.sin(t*n/180),o=Math.cos(t*n/180);return e.map((function(t){var e=xt.getVector(i,t),n=xt.len(e),s=e.y/n,a=e.x/n;return{x:n*mt.cosAPlusB(s,a,r,o)+i.x,y:n*mt.sinAPlusB(s,a,r,o)+i.y}}))}},{key:"getRectangleByRightAngle",value:function(e,i){if(2!==i.length)return i;var n=t.getPerpendicularFootOfLine(i,e);return t.getQuadrangleFromTriangle([].concat((0,b.Z)(i),[n]))}}]),t}(),Lt=kt;Lt.isInRange=function(t,e){var i=Math.min.apply(Math,(0,b.Z)(e)),n=Math.max.apply(Math,(0,b.Z)(e));return(Array.isArray(t)?t:[t]).every((function(t){return function(t){return t<=n&&t>=i}(t)}))},Lt.withinRange=function(t,e){var i=Math.min.apply(Math,(0,b.Z)(e)),n=Math.max.apply(Math,(0,b.Z)(e));return t>n?n:t<i?i:t},Lt.calcViewportBoundaries=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:it,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!t)return{top:0,bottom:0,left:0,right:0};var r=20/n,o=[],s=[],a=t;e&&(a=ft(t,i)),a.forEach((function(t){var e=t.x,i=t.y;o.push(e),s.push(i)}));var l=Math.min.apply(Math,o),u=Math.max.apply(Math,o),c=Math.min.apply(Math,s),h=Math.max.apply(Math,s),d=u-l,g=h-c;if(d<r){var v=(r-d)/2;l-=v,u+=v}if(g<r){var f=(r-g)/2;c-=f,h+=f}return{top:c,bottom:h,left:l,right:u}},Lt.getFootOfPerpendicular=function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={x:0,y:0},o=e.x-i.x,s=e.y-i.y;if(Math.abs(o)<1e-8&&Math.abs(s)<1e-8)return r=e;var a=(t.x-e.x)*(e.x-i.x)+(t.y-e.y)*(e.y-i.y);a/=o*o+s*s,r.x=e.x+a*o,r.y=e.y+a*s;var l=kt.getLineLength(t,r),u=2,c=Math.min(e.x,i.x),h=Math.max(e.x,i.x),d=Math.min(e.y,i.y),g=Math.max(e.y,i.y),v=!(kt.isInRange(t.x,[c,h])||kt.isInRange(t.y,[d,g])),f=t.x>h+u||t.x<c-u||t.y>g+u||t.y<d-u;return(n?v:f)?{footPoint:r,length:1/0}:{footPoint:r,length:l}};var It;!function(t){t[t.ANNOTATION=1]="ANNOTATION",t[t.QUALITY_INSPECTION=2]="QUALITY_INSPECTION",t[t.PRE_ANNOTATION=3]="PRE_ANNOTATION",t[t.MANUAL_CORRECTION=4]="MANUAL_CORRECTION"}(It||(It={}));var wt,Pt,Ct,Dt,At,Rt,St;!function(t){t[t.Backward=0]="Backward",t[t.Forward=1]="Forward",t[t.JumpSkip=2]="JumpSkip",t[t.None=3]="None"}(wt||(wt={})),function(t){t[t.Start=0]="Start",t[t.Stop=1]="Stop",t[t.Wait=2]="Wait",t[t.Move=3]="Move"}(Pt||(Pt={})),function(t){t[t.Point=0]="Point",t[t.Line=1]="Line",t[t.Plane=2]="Plane"}(Ct||(Ct={})),function(t){t[t.ascend=0]="ascend",t[t.descend=1]="descend"}(Dt||(Dt={})),function(t){t[t.Intelligence=0]="Intelligence",t[t.Linear=1]="Linear"}(At||(At={})),function(t){t.Zh="zh_CN",t.US="en_US"}(Rt||(Rt={})),function(t){t[t.Clockwise=0]="Clockwise",t[t.Anticlockwise=1]="Anticlockwise"}(St||(St={}));var Tt={offsetX:-10,offsetY:-10},Zt={shadowColor:"rgba(0,0,0,0.6)",shadowOffsetX:0,shadowOffsetY:2,shadowBlur:4},Mt={x:8,y:26},Ot=(Object.freeze({__proto__:null,headerHeight:61,tipsHeight:40,footerHeight:40,sidebarWidth:240,get EStepType(){return It},ANNOTATION_MAX_SIZE:1e3,get EPageOperator(){return wt},get EDragStatus(){return Pt},get EDragTarget(){return Ct},get ESortDirection(){return Dt},get EGrowthMode(){return At},get ELang(){return Rt},get ERotateDirection(){return St},DEFAULT_TEXT_OFFSET:Tt,DEFAULT_TEXT_SHADOW:Zt,TEXT_ATTRIBUTE_OFFSET:Mt}),Object.defineProperty),Et=Object.defineProperties,Nt=Object.getOwnPropertyDescriptors,Ht=Object.getOwnPropertySymbols,Bt=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable,zt=function(t,e,i){return e in t?Ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},Ft=function(t,e){for(var i in e||(e={}))Bt.call(e,i)&&zt(t,i,e[i]);if(Ht){var n,r=S(Ht(e));try{for(r.s();!(n=r.n()).done;){i=n.value;_t.call(e,i)&&zt(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},jt=function(t,e){return Et(t,Nt(e))},Ut=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"composeResult",value:function(t,e,i,n,r){try{var o=JSON.parse(t),s=Dn.getCurrentStepInfo(e,n),a=s.dataSourceStep,l="step_".concat(s.step);if(Object.assign(o,r),o[l]){var u=o[l];return u.result?(u.result=i,JSON.stringify(o)):JSON.stringify(jt(Ft({},o),(0,x.Z)({},l,jt(Ft({},o[l]),{result:i}))))}return JSON.stringify(jt(Ft({},o),(0,x.Z)({},l,{dataSourceStep:a,toolName:s.tool,result:i})))}catch(o){return t}}},{key:"changeCoordinateByRotate",value:function(t,e,i){var n=t.x,r=t.y,o=t.width,s=t.height,a=Wn.changeCoordinateByRotate({x:n,y:r},e,i);switch(e%360){case 90:return jt(Ft({},t),{x:a.x-s,y:a.y,width:s,height:o});case 180:return jt(Ft({},t),{x:a.x-o,y:a.y-s});case 270:return jt(Ft({},t),{x:a.x,y:a.y-o,width:s,height:o});default:return t}}},{key:"translateRect2Points",value:function(t){var e=t.x,i=t.y,n=t.width,r=t.height;return[{x:e,y:i},{x:e+n,y:i},{x:e+n,y:i+r},{x:e,y:i+r}]}},{key:"translatePoints2Rect",value:function(t,e){if(4===t.length){var i=t[0],n=i.x,r=i.y,o=t[1].x-t[0].x,s=t[2].y-t[1].y;return jt(Ft({},e),{x:n,y:r,width:o,height:s})}}},{key:"getRectPointList",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return[{x:t.x*e,y:t.y*e},{x:(t.x+t.width)*e,y:t.y*e},{x:(t.x+t.width)*e,y:(t.y+t.height)*e},{x:t.x*e,y:(t.y+t.height)*e}]}},{key:"getRectEdgeList",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=this.getRectPointList(t,e),n=i.length;return i.map((function(t,e){return{begin:t,end:i[(e+1)%n]}}))}},{key:"isInRect",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t.x>=e.x*n-i&&t.x<=(e.x+e.width)*n+i&&t.y>=e.y*n-i&&t.y<=(e.y+e.height)*n+i}},{key:"getRectUnderZoom",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=t.x,n=t.y,r=t.width,o=t.height;return jt(Ft({},t),{x:i*e,y:n*e,width:r*e,height:o*e})}},{key:"isRectNotInPolygon",value:function(t,e){return this.getRectPointList(t).some((function(t){return!yt(t,e)}))}}]),t}();function Vt(){var t,e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:62,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(n=n||r.length,i)for(t=0;t<i;t++)o[t]=r[0|Math.random()*n];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",t=0;t<36;t++)o[t]||(e=0|16*Math.random(),o[t]=r[19===t?3&e|8:e]);return o.join("")}var Wt,Kt=Object.defineProperty,Xt=Object.getOwnPropertySymbols,Gt=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable,Jt=function(t,e,i){return e in t?Kt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},qt=function(t,e){for(var i in e||(e={}))Gt.call(e,i)&&Jt(t,i,e[i]);if(Xt){var n,r=S(Xt(e));try{for(r.s();!(n=r.n()).done;){i=n.value;Yt.call(e,i)&&Jt(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},Qt=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"getTagKeyName",value:function(t,e){var i,n;if(e)return null!=(n=null==(i=e.find((function(e){return e.value===t})))?void 0:i.key)?n:""}},{key:"getTagName",value:function(t,e){var i=(0,p.Z)(t,2),n=i[0],r=void 0===n?"":n,o=i[1],s=void 0===o?"":o;if(e){var a,l=S(e);try{for(l.s();!(a=l.n()).done;){var u=a.value;if(u.value===r){if(!u.subSelected)return console.error("标签解析错误",r,s),"";var c,h=S(u.subSelected);try{for(h.s();!(c=h.n()).done;){var d=c.value;if(d.value===s)return d.key}}catch(g){h.e(g)}finally{h.f()}}}}catch(g){l.e(g)}finally{l.f()}}}},{key:"getTagNameList",value:function(t,e){var i=this;return Object.keys(t).length<=0?[]:Object.entries(t).reduce((function(t,n){var r=(0,p.Z)(n,2),o=r[0],s=r[1];if(s&&s.length>0){var a=s.split(";"),l={keyName:i.getTagKeyName(o,e),value:a.map((function(t){return i.getTagName([o,t],e)}))};return[].concat((0,b.Z)(t),[l])}return t}),[]).filter((function(t){return t}))}},{key:"getTagnameListWithoutConfig",value:function(t){return Object.keys(t).length<=0?[]:Object.entries(t).reduce((function(t,e){var i=(0,p.Z)(e,2),n={keyName:i[0],value:i[1].split(";")};return[].concat((0,b.Z)(t),[n])}),[]).filter((function(t){return t}))}},{key:"judgeResultIsInInputList",value:function(t,e,i){return!!(t&&e&&i)&&i.filter((function(i){if(i.value===t&&i.subSelected){var n=null==e?void 0:e.split(";");return(null==i?void 0:i.subSelected.filter((function(t){return n.indexOf(t.value)>-1})).length)>0}return!1})).length>0}},{key:"getDefaultResultByConfig",value:function(t){return t.reduce((function(t,e){return e.subSelected&&e.subSelected.forEach((function(i){var n;if(i.isDefault){var r=null!=(n=t[e.value])?n:"",o=[];r.length>0&&(o=r.split(";")),o.push(i.value),t[e.value]=o.join(";")}})),t}),{})}},{key:"getDefaultTagResult",value:function(t,e){var i=this.getDefaultResultByConfig(t);return e.length>0?e.map((function(t){return{id:Vt(),sourceID:t.id,result:qt({},i)}})):[{id:Vt(),sourceID:"",result:qt({},i)}]}}]),t}(),$t='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#ccc"/></g></g></svg>',te='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#f33"/></g></g></svg>',ee=$t,ie="rgba(204, 204, 204, 1)",ne=[ie,"rgba(153, 51, 255, 1)","rgba(51, 254, 51, 1)","rgba(255, 51, 255, 1)","rgba(204, 255, 51, 1)","rgba(51, 153, 255, 1)","rgba(255, 153, 51, 1)","rgba(51, 255, 238, 1)","rgba(255, 221, 51, 1)"],re=[$t,'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#800cf9"/></g></g></svg>','<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#01ff30"/></g></g></svg>','<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#ff88f7"/></g></g></svg>','<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#ffe232"/></g></g></svg>','<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#994217"/></g></g></svg>','<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#0282fa"/></g></g></svg>','<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#ff2323"/></g></g></svg>','<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#00ffea"/></g></g></svg>'],oe={1:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#1f0bf9"/></g></g></svg>',3:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#3fe"/></g></g></svg>',5:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#33fe33"/></g></g></svg>',7:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#fdff37"/></g></g></svg>',9:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16"><defs><clipPath id="a"><path d="M0,0H16V-16H0Z" fill="none"/></clipPath><clipPath id="b"><path d="M13.75-2.937H2.25a.5.5,0,0,0-.5.5v.563a.125.125,0,0,0,.125.125h12.25a.125.125,0,0,0,.125-.125v-.562A.5.5,0,0,0,13.75-2.937ZM4.027-4.25a.632.632,0,0,0,.094-.008l2.628-.461a.153.153,0,0,0,.083-.044l6.623-6.623a.156.156,0,0,0,0-.22l-2.6-2.6a.155.155,0,0,0-.111-.045.155.155,0,0,0-.111.045L4.012-7.581a.159.159,0,0,0-.044.083L3.508-4.87a.524.524,0,0,0,.147.466.529.529,0,0,0,.372.155Z" fill="none"/></clipPath></defs><g transform="translate(0 16)"><g clip-path="url(#a)"><path d="M-5-21H21V5H-5Z" fill="rgba(0,0,0,0)"/></g><g clip-path="url(#b)"><path d="M-3.25-19.25h22.5V3.25H-3.25Z" fill="#f70efa"/></g></g></svg>'},se=(s={},(0,x.Z)(s,_.lc,"rgba(153, 51, 255, 1)"),(0,x.Z)(s,_.rc,"rgba(51, 153, 255, 1)"),(0,x.Z)(s,_.clc,"rgba(46, 230, 46, 1)"),(0,x.Z)(s,_.crc,"rgba(255, 51, 51, 1)"),s);Object.freeze({__proto__:null,HEADER_HEIGHT:61,TAB_HEIGHT:80,SEARCH_HEIGHT:62,PADDING:20,TABLE_ROW_HEIGHT:55,PAGINATION_HEIGHT:55,TIPS_HEIGHT:40,FOOTER_HEIGHT:80,SIDERBAR_WIDTH:240,EDIT_STEP_WIDTH:320,THEME_COLOR:"rgba(102, 111, 255, 1)",NULL_COLOR:ie,COLORS_ARRAY:ne,ICON_ARRAY:re,BASE_ICON:oe,INVALID_COLOR:"rgba(255, 51, 51, 1)",NULL_ICON:ee,INVALID_ICON:te,FILTER_TOOL_COLOR:se});!function(t){t.NoRotateNotice="noRotateNotice",t.RectErrorSizeNotice="rectErrorSizeNotice",t.TextCheckNumberErrorNotice="textCheckNumberErrorNotice",t.TextCheckEnglishErrorNotice="textCheckEnglishErrorNotice",t.TextCheckCustomErrorNotice="textCheckCustomErrorNotice",t.UpperLimitErrorNotice="UpperLimitErrorNotice",t.LowerLimitErrorNotice="LowerLimitErrorNotice",t.InvalidImage="InvalidImage",t.DisableDelete="DisableDelete",t.ClearPartialData="ClearPartialData",t.MarkerFinish="MarkerFinish",t.LowerLimitPoint="LowerLimitPoint",t.NoRotateInDependence="noRotateInDependence",t.UnableToReannotation="unableToReannotation",t.ForbiddenCreationOutsideBoundary="ForbiddenCreationOutsideBoundary",t.SuccessfulEdgeAdsorption="SuccessfulEdgeAdsorption"}(Wt||(Wt={}));var ae=(a={},(0,x.Z)(a,Wt.NoRotateNotice,"This Image contains data and cannot be rotated"),(0,x.Z)(a,Wt.RectErrorSizeNotice,"The drawing frame size is smaller than the minimum drawing size"),(0,x.Z)(a,Wt.TextCheckNumberErrorNotice,"Please enter in number-only format"),(0,x.Z)(a,Wt.TextCheckEnglishErrorNotice,"Please enter in English only format"),(0,x.Z)(a,Wt.TextCheckCustomErrorNotice,"Please enter in the required format"),(0,x.Z)(a,Wt.UpperLimitErrorNotice,"The number of vertices is not more than"),(0,x.Z)(a,Wt.LowerLimitErrorNotice,"The number of vertices is not less than"),(0,x.Z)(a,Wt.InvalidImage,"Invalid image, please skip this image"),(0,x.Z)(a,Wt.DisableDelete,"Disable delete"),(0,x.Z)(a,Wt.ClearPartialData,"Clear partial data"),(0,x.Z)(a,Wt.MarkerFinish,"ListAnnotation is finished"),(0,x.Z)(a,Wt.LowerLimitPoint,"The maximum number of points has been reached"),(0,x.Z)(a,Wt.NoRotateInDependence,"Disallow rotation in dependent cases"),(0,x.Z)(a,Wt.UnableToReannotation,"Unabled to reannotation"),(0,x.Z)(a,Wt.ForbiddenCreationOutsideBoundary,"Fobid creation outside boundary"),(0,x.Z)(a,Wt.SuccessfulEdgeAdsorption,"Successful edge adsorption"),a),le=(l={},(0,x.Z)(l,Wt.NoRotateNotice,"本图含有数据，无法进行旋转"),(0,x.Z)(l,Wt.RectErrorSizeNotice,"绘制框尺寸小于最小绘制尺寸"),(0,x.Z)(l,Wt.TextCheckNumberErrorNotice,"请按仅数字的格式输入"),(0,x.Z)(l,Wt.TextCheckEnglishErrorNotice,"请按仅英文的格式输入"),(0,x.Z)(l,Wt.TextCheckCustomErrorNotice,"请按要求的格式输入"),(0,x.Z)(l,Wt.UpperLimitErrorNotice,"顶点数不多于"),(0,x.Z)(l,Wt.LowerLimitErrorNotice,"顶点数不少于"),(0,x.Z)(l,Wt.InvalidImage,"无效图片，请跳过此图"),(0,x.Z)(l,Wt.DisableDelete,"该数据禁止删除"),(0,x.Z)(l,Wt.ClearPartialData,"存在部分数据无法清除"),(0,x.Z)(l,Wt.MarkerFinish,"列表标注已完成"),(0,x.Z)(l,Wt.LowerLimitPoint,"已到达标点数量上限"),(0,x.Z)(l,Wt.NoRotateInDependence,"依赖情况下无法进行旋转"),(0,x.Z)(l,Wt.UnableToReannotation,"无法进行续标操作"),(0,x.Z)(l,Wt.ForbiddenCreationOutsideBoundary,"边界外禁止创建"),(0,x.Z)(l,Wt.SuccessfulEdgeAdsorption,"边缘吸附成功"),l),ue=(0,y.Z)((function t(){(0,f.Z)(this,t)}));ue.getMessagesByLocale=function(t,e){switch(e){case Rt.US:return ae[t];case Rt.Zh:default:return le[t]}};var ce=Object.defineProperty,he=Object.defineProperties,de=Object.getOwnPropertyDescriptors,ge=Object.getOwnPropertySymbols,ve=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable,ye=function(t,e,i){return e in t?ce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},pe=function(t,e){for(var i in e||(e={}))ve.call(e,i)&&ye(t,i,e[i]);if(ge){var n,r=S(ge(e));try{for(r.s();!(n=r.n()).done;){i=n.value;fe.call(e,i)&&ye(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},be=function(t,e){return he(t,de(e))},xe=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"getAttributeIcon",value:function(t,e){var i,n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=e.findIndex((function(e){return e.value===t})),s=null!=(i=re[o%re.length])?i:ee;if(r||(s=te),s="","undefined"!=typeof Image)return(n=new Image).src=s,n}},{key:"checkString",value:function(t,e){var i="";switch(t){case Y.Order:case Y.NumberOnly:i="^[0-9]+$";break;case Y.EnglishOnly:i="^[A-Za-z]+$";break;case Y.CustomFormat:i=e}return i}},{key:"checkTextAttibute",value:function(t,e){if(void 0===t||""===t)return!0;try{return new RegExp(e).test(t)}catch(i){return!1}}},{key:"getAttributeShowText",value:function(t){var e,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{var r=n.findIndex((function(e){return e.value===t}));return null!=(i=null==(e=n[r])?void 0:e.key)?i:t}catch(r){return t}}},{key:"getAttributeIndex",value:function(t,e){try{var i=e.findIndex((function(e){return e.value===t}));return i>=8?i%8:i}catch(i){return-1}}},{key:"getAttributeColor",value:function(t,e){try{var i=this.getAttributeIndex(t,e);return-1===i?ie:ne[i%ne.length]}catch(i){return ie}}},{key:"getTextAttribute",value:function(t,e){try{if(e===Y.Order){var i=t.map((function(t){return parseInt(t.textAttribute,10)})).filter((function(t){return(0,I.isNumber)(t)&&t<Number.MAX_SAFE_INTEGER&&t>=0}));return i.sort((function(t,e){return t-e})),"".concat((i.pop()||0)+1)}return""}catch(i){return""}}},{key:"textChange",value:function(t,e,i){return i.map((function(i){return i.id===e?be(pe({},i),{textAttribute:t}):i}))}},{key:"getErrorNotice",value:function(t,e){switch(t){case Y.Order:case Y.NumberOnly:return ue.getMessagesByLocale(Wt.TextCheckNumberErrorNotice,e);case Y.EnglishOnly:return ue.getMessagesByLocale(Wt.TextCheckEnglishErrorNotice,e);case Y.CustomFormat:return ue.getMessagesByLocale(Wt.TextCheckCustomErrorNotice,e);default:return""}}},{key:"textAttributeValidate",value:function(t,e,i){try{return new RegExp(this.checkString(t,e)).test(i)}catch(n){}}},{key:"checkTextAttribute",value:function(t,e,i,n){var r=this,o=!1;return i.forEach((function(i){void 0===(null==i?void 0:i.textAttribute)||""===(null==i?void 0:i.textAttribute)||(!n||i.id===n)&&!r.textAttributeValidate(t,e,i.textAttribute)&&(o=!0)})),!!o}},{key:"changeTextAttributeInLog",value:function(t,e){return null==t?void 0:t.map((function(t){return null==t?void 0:t.map((function(t){if((null==e?void 0:e.findIndex((function(e){return(null==e?void 0:e.id)===(null==t?void 0:t.id)})))>-1){var i=null==e?void 0:e.find((function(e){return(null==e?void 0:e.id)===(null==t?void 0:t.id)}));return be(pe({},t),{textAttribute:null==i?void 0:i.textAttribute})}return t}))}))}},{key:"getTextIconSvg",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;if(!0===i){var r=(null==e?void 0:e.findIndex((function(e){return(null==e?void 0:e.value)===t})))%ne.length+1;return re[r]}return n}},{key:"getAttributeByKeycode",value:function(t,e){var i,n;return Lt.isInRange(t,[48,57])&&(n=t-48),Lt.isInRange(t,[96,105])&&(n=t-96),0===n?"":n?null==(i=e[n-1])?void 0:i.value:void 0}}]),t}(),me=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"deg2rad",value:function(t){return t*Math.PI/180}},{key:"rad2deg",value:function(t){return 180*t/Math.PI}}]),t}(),ke=Object.defineProperty,Le=Object.defineProperties,Ie=Object.getOwnPropertyDescriptors,we=Object.getOwnPropertySymbols,Pe=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable,De=function(t,e,i){return e in t?ke(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},Ae=function(t,e){for(var i in e||(e={}))Pe.call(e,i)&&De(t,i,e[i]);if(we){var n,r=S(we(e));try{for(r.s();!(n=r.n()).done;){i=n.value;Ce.call(e,i)&&De(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},Re=function(t,e){return Le(t,Ie(e))},Se={x:0,y:0},Te="",Ze=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"drawLine",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.getContext("2d"),o=n.color,s=void 0===o?Te:o,a=n.thickness,l=void 0===a?1:a,u=n.lineCap,c=void 0===u?"round":u;r.save(),r.strokeStyle=s,r.lineWidth=l,r.lineCap=c,r.beginPath(),r.moveTo(e.x,e.y),r.lineTo(i.x+1,i.y+1),r.stroke(),r.restore()}},{key:"drawRect",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.getContext("2d"),r=i.color,o=void 0===r?Te:r,s=i.thickness,a=void 0===s?1:s,l=i.lineCap,u=void 0===l?"round":l,c=i.hiddenText,h=void 0!==c&&c,d=i.lineDash;if(n.save(),n.strokeStyle=o,n.lineWidth=a,n.lineCap=u,Array.isArray(d)&&n.setLineDash(d),n.fillStyle=o,n.strokeRect(e.x,e.y,e.width,e.height),!1===h){var g="";if(e.attribute&&(g="".concat(g,"  ").concat(e.attribute)),this.drawText(t,{x:e.x,y:e.y-5},g),e.textAttribute){var v=7*"".concat(~~e.width," * ").concat(~~e.height).length,f=0,y=Math.max(20,e.width-v);this.drawText(t,{x:e.x,y:e.y+e.height+20+f},e.textAttribute,{textMaxWidth:y})}}n.restore()}},{key:"drawRectWithFill",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.getContext("2d"),r=i.color,o=void 0===r?Te:r;n.save(),n.fillStyle=o,n.fillRect(e.x,e.y,e.width,e.height),n.restore()}},{key:"drawTagByDom",value:function(t,e,i){var n=t;if((null==e?void 0:e.length)>0){var r=document.createElement("div");return r.innerHTML=e,r.setAttribute("id",i),null==n||n.appendChild(r),r}}},{key:"drawTag",value:function(t,e){var i,n,r=null==t?void 0:t.parentNode;if("undefined"!=typeof window&&(n=window.self.document.getElementById("tagToolTag")),n&&r&&r.contains(n)&&(null==r||r.removeChild(n)),(null==e?void 0:e.length)>0){var o=document.createElement("div");return o.innerHTML=null!=(i=e.reduce((function(t,e){return"".concat(t).concat(e.keyName,": ").concat(e.value.join(" 、 "),"\n")}),""))?i:"",o.setAttribute("id","tagToolTag"),null==r||r.appendChild(o),o}}},{key:"drawLineWithPointList",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(e.length<2)){var r=t.getContext("2d"),o=n.color,s=void 0===o?Te:o,a=n.thickness,l=void 0===a?1:a,u=n.lineCap,c=void 0===u?"round":u,h=n.lineType,d=void 0===h?j.Line:h,g=n.lineDash,v=n.hoverEdgeIndex;r.save(),r.strokeStyle=s,r.lineWidth=l,r.lineCap=c,Array.isArray(g)?r.setLineDash(g):r.setLineDash([]),d===j.Curve?(void 0!==v&&v>-1&&e.push(e[0]),e=En.createSmoothCurvePointsFromPointList((0,b.Z)(e),it),void 0!==v&&v>-1&&(e=e.slice(17*v,17*(v+1)))):void 0!==v&&v>-1&&(e=(e=[].concat((0,b.Z)(e),[e[0]])).slice(v,v+2));var f=[];r.beginPath(),r.moveTo(e[0].x,e[0].y);for(var y=0;y<e.length-1;y++)e[y].specialEdge&&f.push({i1:y,i2:y+1}),r.lineTo(e[y+1].x,e[y+1].y);r.stroke(),r.save(),r.lineWidth=.8*l,r.lineCap="butt",r.strokeStyle="white",r.setLineDash([3,3]),f.forEach((function(t){var i=e[t.i1],n=e[t.i2];r.beginPath(),r.moveTo(i.x,i.y),r.lineTo(n.x,n.y),r.stroke()})),r.restore();var p=4,x=2;return e.forEach((function(e){e.specialPoint&&(i.drawSpecialPoint(t,e,p+x,s),i.drawSpecialPoint(t,e,p,"white"))})),r.restore(),e}}},{key:"drawCircle",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.getContext("2d"),o=n.startAngleDeg,s=void 0===o?0:o,a=n.endAngleDeg,l=void 0===a?360:a,u=n.thickness,c=void 0===u?1:u,h=n.color,d=void 0===h?Te:h,g=n.fill,v=void 0===g?Te:g,f=me.deg2rad(s),y=me.deg2rad(l);r.save(),r.beginPath(),r.strokeStyle=d,r.fillStyle=v,r.lineWidth=c,r.arc(e.x,e.y,i,f,y,!1),r.stroke(),v&&r.fill(),r.closePath(),r.restore()}},{key:"drawCircleWithFill",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.getContext("2d"),o=n.color,s=void 0===o?Te:o;r.save();var a=me.deg2rad(0),l=me.deg2rad(360);r.fillStyle=s,r.beginPath(),r.arc(e.x,e.y,i,a,l,!1),r.fill(),r.restore()}},{key:"drawSpecialPoint",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,n=arguments.length>3?arguments[3]:void 0,r=t.getContext("2d"),o=e.x,s=e.y;r.save(),r.beginPath(),r.fillStyle=n;var a=1.5*i,l=a*Math.sqrt(3)/2,u=a/2;r.moveTo(o,s-a),r.lineTo(o-l,s+u),r.lineTo(o+l,s+u),r.closePath(),r.fill(),r.restore()}},{key:"drawPolygon",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.isClose,r=void 0!==n&&n,o=i.lineType,s=void 0===o?j.Line:o;return!0===r&&(e=[].concat((0,b.Z)(e),[e[0]])),s===j.Curve&&(e=En.createSmoothCurvePointsFromPointList((0,b.Z)(e))),this.drawLineWithPointList(t,e,Re(Ae({},i),{lineType:j.Line})),e}},{key:"drawPolygonWithFill",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(e.length<2)){var n=t.getContext("2d"),r=i.color,o=void 0===r?Te:r,s=i.lineType,a=void 0===s?j.Line:s;n.save(),n.fillStyle=o,n.beginPath(),a===j.Curve&&(e=En.createSmoothCurvePointsFromPointList([].concat((0,b.Z)(e),[e[0]])));var l=e,u=(0,v.Z)(l),c=u[0],h=u.slice(1);return n.moveTo(c.x,c.y),h.forEach((function(t){n.lineTo(t.x,t.y)})),n.fill(),n.restore(),e}}},{key:"drawPolygonWithFillAndLine",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.strokeColor,r=i.fillColor,o=i.thickness,s=i.lineCap,a=i.isClose,l=i.lineType,u=this.drawPolygon(t,e,{color:n,thickness:o,lineCap:s,isClose:a,lineType:l});return this.drawPolygonWithFill(t,e,{color:r,lineType:l}),u}},{key:"drawPolygonWithKeyPoint",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.pointColor,o=void 0===r?"white":r,s=n.strokeColor,a=this.drawPolygon(t,e,n);return a.forEach((function(e){i.drawCircleWithFill(t,e,4,{color:s}),i.drawCircleWithFill(t,e,3,{color:o})})),a}},{key:"drawSelectedPolygonWithFillAndLine",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.pointColor,o=void 0===r?"white":r,s=n.strokeColor,a=this.drawPolygonWithFillAndLine(t,e,n);return a.forEach((function(e){i.drawCircleWithFill(t,e,4,{color:s}),i.drawCircleWithFill(t,e,3,{color:o})})),a}},{key:"drawText",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(i&&e){var r=t.getContext("2d"),o=n.color,s=void 0===o?Te:o,a=n.font,l=void 0===a?Q:a,u=n.shadowColor,c=void 0===u?"":u,h=n.shadowBlur,d=void 0===h?0:h,g=n.shadowOffsetX,v=void 0===g?0:g,f=n.shadowOffsetY,y=void 0===f?0:f,p=n.textMaxWidth,b=void 0===p?164:p,x=n.offsetX,m=void 0===x?0:x,k=n.offsetY,L=void 0===k?0:k,I=n.textAlign,w=void 0===I?"start":I,P=n.lineHeight;r.save(),r.textAlign=w,r.fillStyle=null!=s?s:"white",r.font=l,r.shadowColor=c,r.shadowOffsetX=v,r.shadowOffsetY=y,r.shadowBlur=d,this.wrapText(t,"".concat(i),e.x+m,e.y+L,b,P),r.restore()}}},{key:"wrapText",value:function(t,e,i,n,r,o){if("string"==typeof e&&"number"==typeof i&&"number"==typeof n){var s=t.getContext("2d");void 0===r&&(r=t&&t.width||300),void 0===o&&"undefined"!=typeof window&&(o=t&&parseInt(window.getComputedStyle(t).lineHeight,10)||parseInt(window.getComputedStyle(document.body).lineHeight,10));for(var a=e.split("\n"),l=0;l<a.length;l++){for(var u=a[l].split(""),c="",h=0;h<u.length;h++){var d=c+u[h];r||(r=300),s.measureText(d).width>r&&h>0?(s.fillText(c,i,n),c=u[h],n+=o):c=d}s.fillText(c,i,n),n+=o}}}},{key:"drawArrow",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=n.color,o=void 0===r?Te:r,s=n.thickness,a=void 0===s?1:s,l=n.lineCap,u=void 0===l?"round":l,c=n.theta,h=void 0===c?30:c,d=n.headLen,g=void 0===d?10:d,v=180*Math.atan2(e.y-i.y,e.x-i.x)/Math.PI,f=(v+h)*Math.PI/180,y=(v-h)*Math.PI/180,p=g*Math.cos(f),b=g*Math.sin(f),x=g*Math.cos(y),m=g*Math.sin(y);t.save(),t.strokeStyle=o,t.lineWidth=a,t.lineCap=u,t.beginPath(),t.moveTo(i.x+p,i.y+b),t.lineTo(i.x,i.y),t.lineTo(i.x+x,i.y+m),t.stroke(),t.restore()}},{key:"drawArrowByCanvas",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.getContext("2d");this.drawArrow(r,e,i,n)}}]),t}();Ze.drawImg=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.getContext("2d"),r=i.zoom,o=void 0===r?1:r,s=i.currentPos,a=void 0===s?Se:s,l=i.rotate,u=void 0===l?0:l,c=i.imgAttribute;switch(n.save(),u){case 0:default:n.translate(a.x,a.y);break;case 90:n.translate(a.x+e.height*o,a.y),n.rotate(90*Math.PI/180);break;case 180:n.translate(a.x+e.width*o,a.y+e.height*o),n.rotate(Math.PI);break;case 270:n.translate(a.x,a.y+e.width*o),n.rotate(270*Math.PI/180)}if(c){var h=c.contrast,d=c.saturation,g=c.brightness;n.filter="saturate(".concat(d+100,"%) contrast(").concat(h+100,"%) brightness(").concat(g+100,"%)")}n.drawImage(e,0,0,e.width*o,e.height*o),n.restore()};var Me=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"getStrokeAndFill",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.isSelected,r=void 0!==n&&n,o=i.isHover,s=void 0!==o&&o;return r?{stroke:e?t.validSelected.stroke:t.invalidSelected.stroke,fill:e?t.validSelected.fill:t.invalidSelected.fill}:s?{stroke:e?t.validHover.stroke:t.invalidHover.stroke,fill:e?t.validHover.fill:t.invalidHover.fill}:{stroke:e?t.valid.stroke:t.invalid.stroke,fill:e?t.valid.fill:t.invalid.fill}}},{key:"getStyle2String",value:function(t){if(t)return Object.entries(t).reduce((function(t,e){return"".concat(t," ").concat(e[0],": ").concat(e[1],";")}),"")}}]),t}(),Oe=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"getMousePositionOnCanvasFromEvent",value:function(t,e){if(e&&t){var i=e.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}}return null}},{key:"getClientRect",value:function(t){if(t){var e=t.getBoundingClientRect();return{x:e.left,y:e.top,width:e.width,height:e.height}}return null}},{key:"getSize",value:function(t){if(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height}}return null}},{key:"inViewPort",value:function(t,e){return!!t&&(Lt.isInRange(t.x,[e.left,e.right])&&Lt.isInRange(t.y,[e.top,e.bottom]))}}]),t}();Oe.getViewPort=function(t,e,i){var n=t.width,r=t.height,o=e.x,s=(0-e.y)/i,a=(0-o)/i;return{top:s,bottom:s+r/i,left:a,right:a+n/i}},Oe.getPixelRatio=function(t){if(!t||!window)return 1;var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=1;return"undefined"!=typeof window&&(i=(window.devicePixelRatio||1)/e),i};var Ee,Ne,He={showConfirm:!1,skipWhileNoDependencies:!1,drawOutsideTarget:!1,copyBackwardResult:!1,minWidth:1,minHeight:1,isShowOrder:!1,filterData:["valid","invalid"],attributeConfigurable:!1,attributeList:[],textConfigurable:!1,textCheckType:0,customFormat:""},Be={showConfirm:!1,skipWhileNoDependencies:!1,inputList:[{key:"类别1",value:"class1",isMulti:!1,subSelected:[{key:"选项1",value:"option1",isDefault:!1},{key:"选项2",value:"option1-2",isDefault:!1}]},{key:"类别2",value:"class-AH",isMulti:!0,subSelected:[{key:"选项2-1",value:"option2-1",isDefault:!1},{key:"选项2-2",value:"option2-2",isDefault:!1},{key:"选项2-3",value:"option2-3",isDefault:!1}]},{key:"类别3",value:"class-0P",isMulti:!1,subSelected:[{key:"选项3-1",value:"option3-1",isMulti:!1},{key:"选项3-2",value:"option3-2",isDefault:!1},{key:"选项3-3",value:"option3-3",isDefault:!1}]}]},_e={lineType:0,lineColor:0,edgeAdsorption:!1,outOfTarget:!0,copyBackwardResult:!1,isShowOrder:!1,attributeConfigurable:!1,attributeList:[{key:"类别1",value:"类别1"},{key:"类别ao",value:"class-ao"},{key:"类别M1",value:"class-M1"},{key:"类别Cm",value:"class-Cm"},{key:"类别c3",value:"class-c3"},{key:"类别a0",value:"class-a0"},{key:"类别u7",value:"class-u7"},{key:"类别Zb",value:"class-Zb"},{key:"类别zi",value:"class-zi"}],textConfigurable:!1,textCheckType:2,customFormat:"",showConfirm:!1,lowerLimitPointNum:2,upperLimitPointNum:"",preReferenceStep:0,skipWhileNoDependencies:!1,filterData:["valid","invalid"]},ze={showConfirm:!1,skipWhileNoDependencies:!1,enableTextRecognition:!1,recognitionMode:"general",configList:[{label:"文本",key:"text",required:!1,default:"",maxLength:1e3}],filterData:["valid","invalid"]},Fe={lineType:0,lineColor:0,lowerLimitPointNum:3,edgeAdsorption:!1,drawOutsideTarget:!1,copyBackwardResult:!1,isShowOrder:!1,attributeConfigurable:!1,attributeList:[],textConfigurable:!0,textCheckType:0,customFormat:""},je=function(t){return"lineTool"===t?_e:"rectTool"===t?He:"tagTool"===t?Be:"textTool"===t?ze:"polygonTool"===t?Fe:He},Ue={toolColor:{1:{valid:{stroke:"rgba(0,0,255,0.50)",fill:"rgba(0,0,255,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.80)"},validSelected:{stroke:"rgba(0,15,255,1.00)",fill:"rgba(0,15,255,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,0.60)",fill:"rgba(255,0,0,0.24)"},validHover:{stroke:"rgba(0,15,255,0.80)",fill:"rgba(0,15,255,0.64)"},invalidHover:{stroke:"rgba(255,0,0,0.50)",fill:"rgba(255,0,0,0.40)"}},3:{valid:{stroke:"rgba(0,255,255,0.50)",fill:"rgba(0,255,255,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.80)"},validSelected:{stroke:"rgba(0,212,255,1.00)",fill:"rgba(0,212,255,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,0.60)",fill:"rgba(255,0,0,0.24)"},validHover:{stroke:"rgba(0,212,255,0.80)",fill:"rgba(0,212,255,0.64)"},invalidHover:{stroke:"rgba(255,0,0,0.50)",fill:"rgba(255,0,0,0.40)"}},5:{valid:{stroke:"rgba(0,255,0,0.50)",fill:"rgba(0,255,0,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.80)"},validSelected:{stroke:"rgba(149,255,1.00)",fill:"rgba(149,255,0,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,0.60)",fill:"rgba(255,0,0,0.24)"},validHover:{stroke:"rgba(149,255,0,0.80)",fill:"rgba(149,255,0,0.64)"},invalidHover:{stroke:"rgba(255,0,0,0.50)",fill:"rgba(255,0,0,0.40)"}},7:{valid:{stroke:"rgba(255,255,0,0.50)",fill:"rgba(255,255,0,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.80)"},validSelected:{stroke:"rgba(255,230,102,1.00)",fill:"rgba(255,213,0,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,0.60)",fill:"rgba(255,0,0,0.24)"},validHover:{stroke:"rgba(255,230,102,0.80)",fill:"rgba(255,230,102,0.64)"},invalidHover:{stroke:"rgba(255,0,0,0.50)",fill:"rgba(255,0,0,0.40)"}},9:{valid:{stroke:"rgba(255,0,255,0.50)",fill:"rgba(255,0,255,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.80)"},validSelected:{stroke:"rgba(230,102,255,1.00)",fill:"rgba(213,0,255,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,0.60)",fill:"rgba(255,0,0,0.24)"},validHover:{stroke:"rgba(230,102,255,0.80)",fill:"rgba(230,102,255,0.64)"},invalidHover:{stroke:"rgba(255,0,0,0.50)",fill:"rgba(255,0,0,0.40)"}}},attributeColor:[{valid:{stroke:"rgba(204,204,204,1.00)",fill:"rgba(204,204,204,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.40)"},validSelected:{stroke:"rgba(204,204,204,1.00)",fill:"rgba(204,204,204,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"},validHover:{stroke:"rgba(204,204,204,1.00)",fill:"rgba(204,204,204,0.80)"},invalidHover:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"}},{valid:{stroke:"rgba(153,51,255,1.00)",fill:"rgba(153,51,255,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.40)"},validSelected:{stroke:"rgba(153,51,255,1.00)",fill:"rgba(153,51,255,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"},validHover:{stroke:"rgba(153,51,255,1.00)",fill:"rgba(153,51,255,0.80)"},invalidHover:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"}},{valid:{stroke:"rgba(51,254,51,1.00)",fill:"rgba(51,254,51,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.40)"},validSelected:{stroke:"rgba(51,254,51,1.00)",fill:"rgba(51,254,51,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"},validHover:{stroke:"rgba(51,254,51,1.00)",fill:"rgba(51,254,51,0.80)"},invalidHover:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"}},{valid:{stroke:"rgba(255,51,255,1.00)",fill:"rgba(255,51,255,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.40)"},validSelected:{stroke:"rgba(255,51,255,1.00)",fill:"rgba(255,51,255,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"},validHover:{stroke:"rgba(255,51,255,1.00)",fill:"rgba(255,51,255,0.80)"},invalidHover:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"}},{valid:{stroke:"rgba(204,255,51,1.00)",fill:"rgba(204,255,51,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.40)"},validSelected:{stroke:"rgba(204,255,51,1.00)",fill:"rgba(204,255,51,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"},validHover:{stroke:"rgba(204,255,51,1.00)",fill:"rgba(204,255,51,0.80)"},invalidHover:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"}},{valid:{stroke:"rgba(51,153,255,1.00)",fill:"rgba(51,153,255,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.40)"},validSelected:{stroke:"rgba(51,153,255,1.00)",fill:"rgba(51,153,255,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"},validHover:{stroke:"rgba(51,153,255,1.00)",fill:"rgba(51,153,255,0.80)"},invalidHover:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"}},{valid:{stroke:"rgba(255,153,51,1.00)",fill:"rgba(255,153,51,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.40)"},validSelected:{stroke:"rgba(255,153,51,1.00)",fill:"rgba(255,153,51,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"},validHover:{stroke:"rgba(255,153,51,1.00)",fill:"rgba(255,153,51,0.80)"},invalidHover:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"}},{valid:{stroke:"rgba(51,255,238,1.00)",fill:"rgba(51,255,238,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.40)"},validSelected:{stroke:"rgba(51,255,238,1.00)",fill:"rgba(51,255,238,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"},validHover:{stroke:"rgba(51,255,238,1.00)",fill:"rgba(51,255,238,0.80)"},invalidHover:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"}},{valid:{stroke:"rgba(255,221,51,1.00)",fill:"rgba(255,221,51,0.40)"},invalid:{stroke:"rgba(255,153,102,1.00)",fill:"rgba(255,153,102,0.40)"},validSelected:{stroke:"rgba(255,221,51,1.00)",fill:"rgba(255,221,51,0.80)"},invalidSelected:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"},validHover:{stroke:"rgba(255,221,51,1.00)",fill:"rgba(255,221,51,0.80)"},invalidHover:{stroke:"rgba(255,0,0,1.00)",fill:"rgba(255,0,0,0.80)"}}],lineColor:{1:"rgba(102, 111, 255, 1 )",3:"rgba(102, 230, 255, 1)",5:"rgba(191, 255, 102, 1)",7:"rgba(255, 230, 102, 1)",9:"rgba(230, 102, 255, 1)"},attributeLineColor:["rgba(204, 204, 204, 1)","rgba(153, 51, 255, 1)","rgba(51, 254, 51, 1)","rgba(255, 51, 255, 1)","rgba(204, 255, 51, 1)","rgba(51, 153, 255, 1)","rgba(255, 153, 51, 1)","rgba(51, 255, 238, 1)","rgba(255, 221, 51, 1)"],color:1,width:2,opacity:9},Ve=Object.defineProperty,We=Object.defineProperties,Ke=Object.getOwnPropertyDescriptors,Xe=Object.getOwnPropertySymbols,Ge=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable,Je=function(t,e,i){return e in t?Ve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},qe=function(t,e){for(var i in e||(e={}))Ge.call(e,i)&&Je(t,i,e[i]);if(Xe){var n,r=S(Xe(e));try{for(r.s();!(n=r.n()).done;){i=n.value;Ye.call(e,i)&&Je(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},Qe=function(t,e){return We(t,Ke(e))};!function(t){t[t.Create=0]="Create",t[t.Active=1]="Active",t[t.Edit=1]="Edit",t[t.None=2]="None"}(Ee||(Ee={})),function(t){t.ActiveArea="#B3B8FF"}(Ne||(Ne={}));var $e,ti=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"isInLine",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,r=Lt.getFootOfPerpendicular(t,e,i),o=r.length;return o<n}}]),t}(),ei=ti;ei.setSpecialEdgeStyle=function(t){t.lineCap="butt",t.setLineDash([10,10])},ei.setReferenceCtx=function(t){t.lineCap="butt",t.setLineDash([6])},ei.calcOptimalIntersection=function(t,e,i,n,r){var o,s,a=1/0;return t.find((function(i,n){if(0!==n){var r=ti.isInLine(e.pointA,i,t[n-1]),o=ti.isInLine(e.pointB,i,t[n-1]);return r&&o}}))?{point:i}:(t.forEach((function(l,u){if(0!==u){var c={pointA:t[u-1],pointB:l},h=ti.lineIntersection(e,c);if(h&&e){var d=h.onLine2,g=h.onLine1,v=h.x,f=h.y,y=ti.calcDistance(i,h);if(ti.isOnLine(e.pointB.x,e.pointB.y,l.x,l.y,t[u-1].x,t[u-1].y)){if(ti.calcDistance(i,h)<n/r){var p=e.pointB,b=Lt.getFootOfPerpendicular(p,c.pointA,c.pointB,!0),x=b.footPoint,m=b.length;if(void 0!==m){var k=ti.calcDistance(c.pointA,x),L=ti.calcDistance(c.pointB,x);s={point:x,minDistance:m},m===1/0&&(s.point=k>L?c.pointB:c.pointA)}}return}y<a&&d&&g&&(a=y,o={x:v,y:f})}}})),o?{point:o,minDistance:a}:s||void 0)},ei.lineIntersection=function(t,e){var i=!1,n=!1,r=ti.getAxisDiff(t),o=ti.getAxisDiff(e),s=o.y*r.x-o.x*r.y;if(0===s)return!1;var a=t.pointA.y-e.pointA.y,l=t.pointA.x-e.pointA.x,u=(e.pointB.x-e.pointA.x)*a-(e.pointB.y-e.pointA.y)*l,c=(t.pointB.x-t.pointA.x)*a-(t.pointB.y-t.pointA.y)*l;return(a=u/s)>0&&a<1&&(i=!0),(l=c/s)>0&&l<1&&(n=!0),{x:t.pointA.x+a*(t.pointB.x-t.pointA.x),y:t.pointA.y+a*(t.pointB.y-t.pointA.y),onLine1:i,onLine2:n}},ei.getAxisDiff=function(t){return{x:t.pointB.x-t.pointA.x,y:t.pointB.y-t.pointA.y}},ei.calcDistance=function(t,e){return Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2))},ei.drawCurveLine=function(t,e,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=ft(e,16);t.save(),t.lineCap="round",t.lineJoin="round",t.strokeStyle=i.color,n&&(t.lineWidth=i.lineWidth),r&&ti.setReferenceCtx(t),e.forEach((function(e,i){var n=null==e?void 0:e.specialEdge,r=s.splice(0,17);t.save(),t.beginPath(),o===i&&(t.lineWidth=4),r.forEach((function(e,i){var r=e.x,o=e.y,s=i>0?"lineTo":"moveTo";n&&ti.setSpecialEdgeStyle(t),t[s](r,o)})),t.stroke(),t.restore()})),t.restore()},ei.calcTwoPointDistance=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},ei.pointOverTarget=function(t,e,i,n,r,o,s,a,l,u){var c=t;if(!e)return t;if(i===E.Polygon){var h=ti.getPolygonPointList(n,r);if(0===h.length||En.isInPolygon(t,h))return c;var d=h.concat(h[0]).map((function(t){return l(t)})),g=l(e),v={pointA:g,pointB:l(t)},f=ti.calcOptimalIntersection(d,v,g,s,a);if(!f)return e;var y=u(null==f?void 0:f.point);return c.x=y.x,c.y=y.y,c}if(i===E.Rect){var p=n.x,b=n.y,x=n.width,m=n.height;return c.x=Lt.withinRange(c.x,[p,p+x]),c.y=Lt.withinRange(c.y,[b,b+m]),c}return c.x=Lt.withinRange(c.x,[0,o.width]),c.y=Lt.withinRange(c.y,[0,o.height]),c},ei.getPolygonPointList=function(t,e){var i=t.pointList;return e.lineType===j.Line?i:En.createSmoothCurvePoints(i.reduce((function(t,e){return[].concat((0,b.Z)(t),[e.x,e.y])}),[]),.5,!0,20)},ei.isOnLine=function(t,e,i,n,r,o){return Math.abs((n-e)/(i-t)*(r-t)+e-o)<1e-6&&r>=t&&r<=i},ei.inArea=function(t,e){var i=t.top,n=t.left,r=t.right,o=t.bottom,s=e.x,a=e.y;return a>=i&&a<=o&&s>=n&&s<=r},ei.getVHPoint=function(t,e,i,n){var r=ti.getAngle(t,i);return Math.abs(r)<45?Qe(qe({},e),{y:n.y}):Qe(qe({},e),{x:n.x})},ei.getAngle=function(t,e){var i=e.x-t.x,n=e.y-t.y;return 360*Math.atan(n/i)/(2*Math.PI)},function(t){t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.L=76]="L",t[t.R=82]="R",t[t.Z=90]="Z",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.S=83]="S",t[t.Q=81]="Q",t[t.Delete=46]="Delete",t[t.F11=122]="F11",t[t.Space=32]="Space",t[t.Esc=27]="Esc",t[t.Left=37]="Left",t[t.Up=38]="Up",t[t.Right=39]="Right",t[t.Down=40]="Down",t[t.Enter=13]="Enter",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Shift=16]="Shift",t[t.Tab=9]="Tab",t[t.BackSpace=8]="BackSpace"}($e||($e={}));var ii=$e,ni=Object.freeze({__proto__:null,default:ii}),ri=function(){function t(e){var i=this;(0,f.Z)(this,t),this.record=[],this.recordIndex=-1,this.minRecordIndex=-1,this.emitHistoryChanged=function(){i.historyChanged&&("ActionsHistory"===i.constructor.name||i.record.length>0)&&i.historyChanged(i.undoEnabled,i.redoEnabled)},this.historyChanged=e}return(0,y.Z)(t,[{key:"undoEnabled",get:function(){return this.recordIndex>this.minRecordIndex}},{key:"redoEnabled",get:function(){return this.recordIndex<this.record.length-1}},{key:"pushHistory",value:function(t){if(this.recordIndex!==this.record.length-1){var e=this.record.slice(0,Math.min(this.recordIndex+1,this.record.length));this.record=e}this.record.push(w().cloneDeepWith(t)),this.recordIndex+=1,this.emitHistoryChanged()}},{key:"updateHistory",value:function(t){this.record[this.recordIndex]=w().cloneDeep(t)}},{key:"applyAttribute",value:function(t,e,i){t&&this.record.forEach((function(n){var r=n.find((function(e){return e.id===t}));r&&(r[e]=i)}))}},{key:"undo",value:function(){if(this.undoEnabled)return this.recordIndex-=1,this.emitHistoryChanged(),w().cloneDeep(this.record[this.recordIndex])||[]}},{key:"redo",value:function(){if(this.redoEnabled)return this.recordIndex+=1,this.emitHistoryChanged(),w().cloneDeep(this.record[this.recordIndex])}},{key:"init",value:function(){this.record=[[]],this.recordIndex=0,this.emitHistoryChanged()}},{key:"empty",value:function(){this.record=[],this.recordIndex=-1,this.emitHistoryChanged()}},{key:"initRecord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.length>0||e;this.record=i?[w().cloneDeep(t)]:[],this.minRecordIndex=i?0:-1,this.recordIndex=0}}]),t}(),oi=function(){function t(e,i){var n=this;(0,f.Z)(this,t),this.rcTime=0,this.mouseDownTime=0,this.onMouseDown=function(){n.mouseDownTime=(new Date).getTime()},this.dom=e,this.isDoubleClick=!1,this.delay=i}return(0,y.Z)(t,[{key:"getRcTime",value:function(){return this.rcTime}},{key:"getCoord",value:function(t){return{x:t.clientX,y:t.clientY}}},{key:"removeEvent",value:function(){!this.dom||(this.dom.removeEventListener("mouseup",this.mouseUp),this.dom.removeEventListener("mousemove",this.mouseMove),this.dom.removeEventListener("dblclick",this.dblclick),this.dom.removeEventListener("mousedown",this.onMouseDown))}},{key:"addEvent",value:function(t,e,i,n){var r=this;!this.dom||(this.removeEvent(),this.mouseUp=function(e){var o=(new Date).getTime(),s=!n||n(e);if(o-r.mouseDownTime>r.delay||!0!==s)t(e);else{if(2===e.button){if(0!==r.rcTime)return o-r.rcTime<r.delay&&(i(e),clearTimeout(r.setTimeFun),r.cacheFunction=void 0),void(r.rcTime=0);setTimeout((function(){r.rcTime=0}),r.delay),r.rcTime=o}r.setTimeFun&&clearTimeout(r.setTimeFun),r.clickCoord=r.getCoord(e),r.cacheFunction=function(){return t(e)},r.setTimeFun=setTimeout((function(){r.isDoubleClick?r.isDoubleClick=!1:(r.cacheFunction(),r.clickCoord=void 0)}),r.delay)}},this.mouseMove=function(t){var e=r.getCoord(t);r.clickCoord&&!Wn.getIsInScope(e,r.clickCoord,10)&&(r.cacheFunction&&r.cacheFunction(),r.clickCoord=void 0,r.cacheFunction=null,clearTimeout(r.setTimeFun))},this.dblclick=function(t){r.isDoubleClick=!0,r.clickCoord=void 0,e(t)},this.dom.addEventListener("mouseup",this.mouseUp),this.dom.addEventListener("mousemove",this.mouseMove),this.dom.addEventListener("dblclick",this.dblclick),this.dom.addEventListener("mousedown",this.onMouseDown))}},{key:"clearRightDblClick",value:function(){this.rcTime=0}}]),t}(),si=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"getInitImgPos",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(90===i||270===i)&&(e={width:e.height,height:e.width});var o=t.width*n/e.width,s=t.height*n/e.height,a=r?1:Math.min(o,s),l={x:(t.width-e.width*a)/2,y:(t.height-e.height*a)/2},u=e.width*a,c=e.height*a;return r&&(a=1),{zoom:a,currentPos:l,imgInfo:{width:u,height:c}}}},{key:"getBasicRecPos",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.9,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(e&&t){var s=e.x,a=e.y,l=e.height,u=e.width,c=i.height/l;u/l>i.width/i.height&&(c=i.width/u);var h=o?1:c*n*r,d={x:i.width/2,y:i.height/2},g={x:(s+u/2)*h,y:(a+l/2)*h};return{currentPos:{x:d.x-g.x,y:d.y-g.y},innerZoom:h}}return!1}}]),t}(),ai=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"renderInvalidPage",value:function(t,e,i){var n=document.createElement("div");return n.setAttribute("style","\n        position: absolute;\n        left: 0px;\n        top: 0px;\n        width: ".concat(e.width,"px;\n        height: ").concat(e.height,"px;\n        background: rgba(255, 87, 34, 1);\n        overflow: hidden;\n        color: white;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        font-size: 30px;\n        opacity: 0.7;\n        z-index: 30;\n      ")),n.innerHTML=ue.getMessagesByLocale(Wt.InvalidImage,i),t.appendChild(n),n}}]),t}(),li=[1,5,10,20,30,50,80,100].concat(Array.from({length:9}).map((function(t,e){return 100*(e+2)}))),ui=(0,y.Z)((function t(){(0,f.Z)(this,t)}));ui.zoomChanged=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:At.Linear;if(i===At.Intelligence){var n,r=Math.max.apply(Math,(0,b.Z)(li)),o=Math.min.apply(Math,(0,b.Z)(li)),s=li.slice(0,li.length).findIndex((function(e,i){return t>=e&&(t<li[i+1]||e===r)}));if(-1===s)n=t>=o&&t<=r?e?r:o:e?o:t;else{var a=e?s+1:s-(li.includes(t)?1:0);n=li[Lt.withinRange(a,[0,li.length-1])]}return n}var l=e?2:.5;return t*l},ui.wheelChangePos=function(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=r.zoom,s=void 0===o?1:o,a=r.innerZoom,l=void 0===a?1:a,u=r.basicZoom,c=void 0===u?1:u,h=r.zoomMax,d=void 0===h?1e3:h,g=r.rotate,v=void 0===g?0:g,f=n.x,y=n.y,p=parseFloat((s+.1).toFixed(1))/5;if(t&&e){var b=t.width,x=t.height;[90,270].includes(v)&&(b=t.height,x=t.width);var m=b*l,k=x*l,L=e.x-f,I=e.y-y,w=L/m,P=I/k,C=s+i*p,D=b*(C=Lt.withinRange(C,[c,d]))*w,A=x*C*P,R=f+(L-D),S=y+(I-A);return{zoom:C,currentPos:{x:R,y:S},imgInfo:{width:b*C,height:x*C},ratio:p}}return null};var ci,hi=function(){function t(){(0,f.Z)(this,t),this._events=new Map}return(0,y.Z)(t,[{key:"on",value:function(t,e){var i=this._events.get(t)||[];i.some((function(t){return t===e}))||this._events.set(t,i.concat(e))}},{key:"singleOn",value:function(t,e){this._events.set(t,[e])}},{key:"emit",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var r=this._events.get(t);r&&r.forEach((function(t){t&&t.apply(void 0,i)}))}},{key:"unbind",value:function(t,e){var i=this._events.get(t);i&&this._events.set(t,i.filter((function(t){return t!==e})))}},{key:"unbindAll",value:function(t){this._events.delete(t)}}]),t}(),di=Object.defineProperty,gi=Object.defineProperties,vi=Object.getOwnPropertyDescriptors,fi=Object.getOwnPropertySymbols,yi=Object.prototype.hasOwnProperty,pi=Object.prototype.propertyIsEnumerable,bi=function(t,e,i){return e in t?di(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},xi=function(t,e){for(var i in e||(e={}))yi.call(e,i)&&bi(t,i,e[i]);if(fi){var n,r=S(fi(e));try{for(r.s();!(n=r.n()).done;){i=n.value;pi.call(e,i)&&bi(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},mi=function(t,e){return gi(t,vi(e))},ki=function(t,e,i){return new Promise((function(n,r){var o=function(t){try{a(i.next(t))}catch(e){r(e)}},s=function(t){try{a(i.throw(t))}catch(e){r(e)}},a=function(t){return t.done?n(t.value):Promise.resolve(t.value).then(o,s)};a((i=i.apply(t,e)).next())}))},Li={min:.2,max:1e3,ratio:.4},Ii=function(t){(0,h.Z)(i,t);var e=R(i);function i(t){var n,r,o,s,a,l,u,h,d,g;return(0,f.Z)(this,i),(n=e.call(this)).isDrag=!1,n.isSpaceKey=!1,n.innerZoom=1,n.basicZoom=.01,n.isSpaceClick=!1,n.isDragStart=!1,n.startTime=0,n.initImgPos=function(){return ki((0,c.Z)(n),null,k().mark((function t(){var e,i,n,r,o,s,a,l,u,c;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.imgNode&&0!==this.imgNode.width){t.next=2;break}return t.abrupt("return");case 2:return n=null==(e=this._imgAttribute)?void 0:e.zoomRatio,r=null==(i=this._imgAttribute)?void 0:i.isOriginalSize,o=si.getInitImgPos(this.size,{width:this.imgNode.width,height:this.imgNode.height},this.rotate,n,r),s=o.currentPos,a=o.imgInfo,l=o.zoom,t.next=10,C().getItem("coordinate");case 10:if(u=t.sent,this.setCurrentPos(u||s),this.currentPosStorage=u||s,c=0,!r){t.next=18;break}return t.next=16,C().setItem("zoom",1,(function(){}));case 16:t.next=21;break;case 18:return t.next=20,C().getItem("zoom");case 20:c=t.sent;case 21:this.imgInfo=a,this.setZoom(c||l),this.innerZoom=c||l,this.renderReady=!0,this.render(),this.renderBasicCanvas(),this.emit("dependRender"),this.emit("renderZoom",l);case 29:case"end":return t.stop()}}),t,this)})))},n.getCurrentPos=function(t){var e=(0,c.Z)(n),i=e._firstClickCoordinate,r=e.currentPosStorage;try{var o;return o=i&&r?{y:r.y+t.y-i.y,x:r.x+t.x-i.x}:{x:0,y:0}}catch(o){return console.error(o),{x:0,y:0}}},n.wheelChangePos=function(t,e,i){var r=(0,c.Z)(n),o=r.currentPos,s=r.imgNode;if(s){if(n.zoom!==n.basicZoom||-1!==e){var a=ui.wheelChangePos(s,t,e,o,{zoom:i||n.zoom,innerZoom:n.innerZoom,basicZoom:n.basicZoom,zoomMax:Li.max,rotate:n.rotate});if(a){var l=a.currentPos,u=a.ratio,h=a.zoom,d=a.imgInfo;C().setItem("coordinate",l,(function(){})),C().setItem("zoom",h,(function(){})),n.innerZoom=h,n.setZoom(h),n.setCurrentPos(l),n.currentPosStorage=l,n.imgInfo=d,Li.ratio=u,n.emit("renderZoom",h,o)}}}else console.error("unable to load image")},n.zoomChanged=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:At.Linear,i=ui.zoomChanged(n.zoom,t,e);n.wheelChangePos(n.getGetCenterCoordinate(),i>n.zoom?1:-1,i),n.render(),n.renderBasicCanvas()},n.drawImg=function(){!n.imgNode||Ze.drawImg(n.basicCanvas,n.imgNode,{zoom:n.zoom,currentPos:n.currentPos,rotate:n.rotate,imgAttribute:n._imgAttribute})},n.saveDataEvent=new CustomEvent("saveLabelResultToImg",{}),n.renderReady=!1,n.container=t.container,n.showDefaultCursor=t.showDefaultCursor||!1,n.basicCanvas||n.initCanvas(t.size),n.imgNode=t.imgNode,n.isImgError=!t.imgNode,n.basicImgInfo={width:null!=(o=null==(r=t.imgNode)?void 0:r.width)?o:0,height:null!=(a=null==(s=t.imgNode)?void 0:s.height)?a:0,valid:!0,rotate:0},n.forbidOperation=null!=(l=t.forbidOperation)&&l,n.forbidBasicResultRender=null!=(u=t.forbidBasicResultRender)&&u,n.size=t.size,n.currentPos={x:0,y:0},n.zoom=1,n.coord={x:-1,y:-1},n.currentPosStorage={x:0,y:0},n.isShowCursor=!1,n.style={strokeColor:ne[4],fillColor:ne[4],strokeWidth:2*(null==window?void 0:window.devicePixelRatio),opacity:1},n.attributeLockList=[],n.history=new ri,n.style=null!=(h=t.style)?h:{},n._imgAttribute=null!=(d=t.imgAttribute)?d:{},n.isHidden=!1,n.dragStatus=Pt.Wait,n.defaultAttribute=null!=(g=null==t?void 0:t.defaultAttribute)?g:"无属性",n.forbidCursorLine=!!t.forbidCursorLine,n.lang=Rt.Zh,n.onMouseDown=n.onMouseDown.bind((0,c.Z)(n)),n.onMouseMove=n.onMouseMove.bind((0,c.Z)(n)),n.onMouseLeave=n.onMouseLeave.bind((0,c.Z)(n)),n.onMouseUp=n.onMouseUp.bind((0,c.Z)(n)),n.onKeyDown=n.onKeyDown.bind((0,c.Z)(n)),n.onKeyUp=n.onKeyUp.bind((0,c.Z)(n)),n.onWheel=n.onWheel.bind((0,c.Z)(n)),n.onLeftDblClick=n.onLeftDblClick.bind((0,c.Z)(n)),n.onRightDblClick=n.onRightDblClick.bind((0,c.Z)(n)),n.onClick=n.onClick.bind((0,c.Z)(n)),n.clearImgDrag=n.clearImgDrag.bind((0,c.Z)(n)),n.dblClickListener=new oi(n.container,200),n.coordUtils=new Kn((0,c.Z)(n)),n.coordUtils.setBasicImgInfo(n.basicImgInfo),n}return(0,y.Z)(i,[{key:"onContextmenu",value:function(t){t.preventDefault()}},{key:"ctx",get:function(){var t;return this._ctx||(null==(t=this.canvas)?void 0:t.getContext("2d"))}},{key:"basicCtx",get:function(){var t;return null==(t=this.basicCanvas)?void 0:t.getContext("2d")}},{key:"rotate",get:function(){var t,e;return null!=(e=null==(t=this.basicImgInfo)?void 0:t.rotate)?e:0}},{key:"valid",get:function(){var t,e;return null==(e=null==(t=this.basicImgInfo)?void 0:t.valid)||e}},{key:"baseIcon",get:function(){return oe[this.style.color]}},{key:"defaultCursor",get:function(){return this.showDefaultCursor?"default":"none"}},{key:"dataList",get:function(){return[]}},{key:"setPrevResultList",value:function(t){this.prevResultList=t}},{key:"hasMarkerConfig",get:function(){return!0===this.config.markerConfigurable&&this.config.markerList&&this.config.markerList.length>0}},{key:"setZoom",value:function(t){this.zoom=t,this.coordUtils.setZoomAndCurrentPos(this.zoom,this.currentPos)}},{key:"setCurrentPos",value:function(t){this.currentPos=t,this.coordUtils.setZoomAndCurrentPos(this.zoom,this.currentPos)}},{key:"setReferenceData",value:function(t){this.referenceData=t}},{key:"updatePosition",value:function(t){var e=t.zoom,i=t.currentPos;this.setZoom(e),this.setCurrentPos(i),this.currentPosStorage=i,this.innerZoom=e,this.renderBasicCanvas(),this.render()}},{key:"setLang",value:function(t){this.lang=t}},{key:"setShowDefaultCursor",value:function(t){this.showDefaultCursor=t,this.container.style.cursor=this.defaultCursor}},{key:"forbidMouseOperation",get:function(){return this.forbidOperation||!1===this.valid}},{key:"pixelRatio",get:function(){var t;return Oe.getPixelRatio(null==(t=this.canvas)?void 0:t.getContext("2d"))}},{key:"init",value:function(){return ki(this,null,k().mark((function t(){return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.eventUnbinding(),t.next=3,this.initPosition();case 3:this.eventBinding();case 4:case"end":return t.stop()}}),t,this)})))}},{key:"destroy",value:function(){this.destroyCanvas(),this.eventUnbinding()}},{key:"initCanvas",value:function(t){var e,i,n=this.pixelRatio,r=this.container.querySelectorAll("canvas");if(r&&r.length>0)this.canvas=r[1],this.basicCanvas=r[0],this.clearExtraDom(this.container);else{var o=document.createElement("canvas");o.width=t.width*n,o.height=t.height*n,o.style.width="".concat(t.width,"px"),o.style.height="".concat(t.height,"px"),o.style.left="0",o.style.top="0",o.style.zIndex="0";var s=document.createElement("canvas");s.style.position="absolute",s.style.left="0",s.style.top="0",s.style.zIndex="10",s.style.width="".concat(t.width,"px"),s.style.height="".concat(t.height,"px"),s.width=t.width*n,s.height=t.height*n,this.canvas=s,this.basicCanvas=o,this.container.appendChild(o),this.container.appendChild(s)}this.container.style.cursor=this.defaultCursor,null==(e=this.ctx)||e.scale(n,n),null==(i=this.basicCtx)||i.scale(n,n)}},{key:"clearExtraDom",value:function(t){var e=t.childNodes;if(e&&e.length>0)for(var i=0;i<e.length;i++)"CANVAS"!==e[i].nodeName&&t.removeChild(e[i])}},{key:"destroyCanvas",value:function(){this.canvas&&this.container.contains(this.canvas)&&this.container.removeChild(this.canvas),this.basicCanvas&&this.container.contains(this.basicCanvas)&&this.container.removeChild(this.basicCanvas),this.clearInvalidPage(),this.clearImgDrag()}},{key:"setStyle",value:function(t){this.style=t,this.render()}},{key:"setImgNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.imgNode=t,this.setBasicImgInfo(xi({width:t.width,height:t.height,valid:!0,rotate:0},e)),!0===this.isImgError&&(this.isImgError=!1,this.emit("changeAnnotationShow")),"boolean"==typeof e.valid&&this.setValid(e.valid),this.initImgPos()}},{key:"setErrorImg",value:function(){var t=this.isImgError;this.isImgError=!0,this.imgNode=void 0,this.setBasicImgInfo({width:0,height:0,valid:!0,rotate:0}),!1===t&&this.emit("changeAnnotationShow")}},{key:"setBasicImgInfo",value:function(t){this.basicImgInfo=t,this.coordUtils.setBasicImgInfo(t)}},{key:"setForbidOperation",value:function(t){this.forbidOperation=t,this.render()}},{key:"setForbidCursorLine",value:function(t){this.forbidCursorLine=t,this.render()}},{key:"setIsHidden",value:function(t){this.isHidden=t,this.emit("hiddenChange")}},{key:"setIsShowOrder",value:function(t){this.config.isShowOrder=t,this.render()}},{key:"getCoordinate",value:function(t){var e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}},{key:"getCoordinateUnderZoom",value:function(t){var e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.left-this.currentPos.x,y:t.clientY-e.top-this.currentPos.y}}},{key:"getGetCenterCoordinate",value:function(){return{x:this.size.width/2,y:this.size.height/2}}},{key:"initPosition",value:function(){return ki(this,null,k().mark((function t(){var e,i,n,r,o,s,a,l,u;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.basicResult||!this.imgInfo){t.next=13;break}if(e=this.basicResult,i=this.size,n=this.imgNode,r=this._imgAttribute,o=this.imgInfo,s=this.dependToolName,!(e&&n&&s)){t.next=11;break}a=e,t.t0=s,t.next=t.t0===E.Polygon||t.t0===E.Line?7:9;break;case 7:return e.pointList&&(l=Lt.calcViewportBoundaries(e.pointList),a={x:l.left,y:l.top,width:l.right-l.left,height:l.bottom-l.top}),t.abrupt("break",9);case 9:(u=si.getBasicRecPos(n,a,i,void 0,null==r?void 0:r.zoomRatio,null==r?void 0:r.isOriginalSize))&&(this.setCurrentPos(u.currentPos),this.currentPosStorage=this.currentPos,this.imgInfo=mi(xi({},o),{width:o.width/this.innerZoom*u.innerZoom,height:o.height/this.innerZoom*u.innerZoom}),this.innerZoom=u.innerZoom,this.setZoom(u.innerZoom),this.render(),this.renderBasicCanvas());case 11:t.next=15;break;case 13:return t.next=15,this.initImgPos();case 15:case"end":return t.stop()}}),t,this)})))}},{key:"undo",value:function(){this.history.undo()}},{key:"redo",value:function(){this.history.redo()}},{key:"clearCanvas",value:function(){var t;null==(t=this.ctx)||t.clearRect(0,0,this.size.width,this.size.height)}},{key:"clearBasicCanvas",value:function(){var t;null==(t=this.basicCtx)||t.clearRect(0,0,this.size.width,this.size.height)}},{key:"eventBinding",value:function(){this.dblClickListener.addEvent((function(){}),this.onLeftDblClick,this.onRightDblClick),this.container.addEventListener("mousedown",this.onMouseDown),this.container.addEventListener("mousemove",this.onMouseMove),this.container.addEventListener("mouseup",this.onMouseUp),this.container.addEventListener("mouseleave",this.onMouseLeave),this.container.addEventListener("click",this.onClick),this.container.addEventListener("wheel",this.onWheel),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),"undefined"!=typeof window&&window.parent.document.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"eventUnbinding",value:function(){this.container.removeEventListener("mousedown",this.onMouseDown),this.container.removeEventListener("mousemove",this.onMouseMove),this.container.removeEventListener("mouseup",this.onMouseUp),this.container.removeEventListener("mouseleave",this.onMouseLeave),this.container.removeEventListener("wheel",this.onWheel),this.container.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),"undefined"!=typeof window&&window.parent.document.removeEventListener("contextmenu",this.onContextmenu,!1),this.dblClickListener.removeEvent()}},{key:"clearImgDrag",value:function(){this.isDrag=!1,this.isDragStart=!1,this.isSpaceClick=!1,this.startTime=0,this.container.style.cursor=this.defaultCursor,this.forbidCursorLine=!1}},{key:"onMouseDown",value:function(t){if(!this.canvas||this.isImgError)return!0;var e=this.getCoordinate(t);(this.isSpaceKey&&0===t.button||2===t.button)&&(t.stopPropagation(),this._firstClickCoordinate=e,this.currentPosStorage=this.currentPos,this.isSpaceClick=!0,this.isDragStart=!0,this.startTime=(new Date).getTime())}},{key:"onMouseMove",value:function(t){if(!this.canvas||this.isImgError)return!0;var e=this.getCoordinate(t);this.isShowCursor&&(this.coord=e);try{if(!e||!(0,I.isNumber)(null==e?void 0:e.x)||!(0,I.isNumber)(null==e?void 0:e.y))throw new Error("coord error");if(this.coord=e,(this.isSpaceClick||this.isDragStart)&&this._firstClickCoordinate){var i=this.getCurrentPos(e);this.setCurrentPos(i),this.isDrag=!0,this.container.style.cursor="grabbing",this.forbidCursorLine=!0,this.renderBasicCanvas(),this.emit("dependRender"),this.emit("dragMove",{currentPos:i,zoom:this.zoom})}this.render()}catch(i){console.error(i)}}},{key:"onMouseUp",value:function(t){if(!this.canvas||this.isImgError)return!0;if(this.container.style.cursor=this.defaultCursor,this.forbidCursorLine=!1,this.isDrag=!1,this.isDragStart=!1,this.isSpaceClick=!1,0!==this.startTime&&this._firstClickCoordinate){var e=(new Date).getTime(),i=this.getCoordinate(t);if(C().setItem("coordinate",this.getCurrentPos(i),(function(){})),e-this.startTime>1e3||!0===this.isSpaceKey||ei.calcTwoPointDistance(i,this._firstClickCoordinate)>10)return t.stopPropagation(),this.startTime=0,this.render(),!0}this.startTime=0,this.render()}},{key:"onMouseLeave",value:function(){this.clearImgDrag()}},{key:"onClick",value:function(t){}},{key:"onLeftDblClick",value:function(t){}},{key:"onRightDblClick",value:function(t){this.clearImgDrag()}},{key:"onKeyDown",value:function(t){switch(t.keyCode===ii.Alt&&t.preventDefault(),t.keyCode){case ii.Space:this.isSpaceKey=!0;break;case ii.Z:if(t.ctrlKey)return t.shiftKey?this.redo():this.undo(),!1}return!0}},{key:"onKeyUp",value:function(t){if(t.keyCode===ii.Space)this.isSpaceKey=!1}},{key:"onWheel",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.imgNode&&this.coord){t.preventDefault(),t.stopPropagation();var i=this.getCoordinate(t),n=t.deltaY||t.wheelDelta,r=0;n>0&&this.zoom>Li.min&&(r=-1),n<0&&this.zoom<Li.max&&(r=1),this.wheelChangePos(i,r),this.emit("dependRender"),e&&this.render(),this.renderBasicCanvas()}}},{key:"renderCursorLine",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return null!=(e=t.style.lineColor[0])?e:""}();if(this.ctx&&!this.forbidCursorLine){var i=this.coord,n=i.x,r=i.y;Ze.drawLine(this.canvas,{x:0,y:r},{x:1e4,y:r},{color:e}),Ze.drawLine(this.canvas,{x:n,y:0},{x:n,y:1e4},{color:e}),Ze.drawCircleWithFill(this.canvas,{x:n,y:r},1,{color:"white"})}}},{key:"setSize",value:function(t){var e;this.size=t,this.container.contains(this.canvas)&&(this.destroyCanvas(),this.initCanvas(t),this.eventUnbinding(),this.init(),!1===(null==(e=this.basicImgInfo)?void 0:e.valid)&&this.renderInvalidPage())}},{key:"setImgAttribute",value:function(t){var e=this._imgAttribute;this._imgAttribute=t,(null==e?void 0:e.zoomRatio)===t.zoomRatio&&e.isOriginalSize===t.isOriginalSize?(this.renderBasicCanvas(),this.render()):this.initImgPos()}},{key:"clearResult",value:function(t){}},{key:"setValid",value:function(t){this.basicImgInfo.valid=t,!1===t?(this.renderInvalidPage(),this.clearResult(!1)):this.clearInvalidPage()}},{key:"setRotate",value:function(t){this.basicImgInfo.rotate=t}},{key:"setBasicResult",value:function(t){this.basicResult=t,this.coordUtils.setBasicResult(t),this.initPosition(),this.emit("dependRender")}},{key:"setDependName",value:function(t,e){this.dependToolName=t,this.coordUtils.setDependInfo(t,e)}},{key:"setAttributeLockList",value:function(t){this.attributeLockList=t,this.render()}},{key:"setConfig",value:function(t){this.config=Dn.jsonParser(t)}},{key:"setDataInjectionAtCreation",value:function(t){this.dataInjectionAtCreation=t}},{key:"setRenderEnhance",value:function(t){this.renderEnhance=t}},{key:"updateRotate",value:function(){if(this.dependToolName)return this.emit("messageInfo",ue.getMessagesByLocale(Wt.NoRotateInDependence,this.lang)),!1;if(this.dataList.length>0)return this.emit("messageInfo",ue.getMessagesByLocale(Wt.NoRotateNotice,this.lang)),!1;var t=Lt.getRotate(this.basicImgInfo.rotate);this.basicImgInfo.rotate=t,this.initImgPos(),this.emit("updateResult")}},{key:"getColor",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.config;if(!0===(null==i?void 0:i.attributeConfigurable)&&this.style.attributeColor){var n=xe.getAttributeIndex(e,null!=(t=i.attributeList)?t:[])+1;return this.style.attributeColor[n]}var r=this.style,o=r.color,s=r.toolColor;return s?s[o]:Ue.toolColor[1]}},{key:"getLineColor",value:function(){var t,e,i,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!0===(null==(t=this.config)?void 0:t.attributeConfigurable)){var r=xe.getAttributeIndex(n,null!=(i=null==(e=this.config)?void 0:e.attributeList)?i:[])+1;return this.style.attributeLineColor?this.style.attributeLineColor[r]:""}var o=this.style,s=o.color,a=o.lineColor;return s&&a?a[s]:""}},{key:"clearInvalidPage",value:function(){this._invalidDOM&&this.container&&this.container.contains(this._invalidDOM)&&(this.container.removeChild(this._invalidDOM),this._invalidDOM=void 0)}},{key:"renderInvalidPage",value:function(){!this.container||this._invalidDOM||(this._invalidDOM=ai.renderInvalidPage(this.container,this.size,this.lang))}},{key:"renderOtherAnnotation",value:function(){var t,e,i,n,r,o,s,a,l=this,u=null!=(e=null==(t=this.style)?void 0:t.width)?e:2;if(this.prevResultList&&(null==(i=this.prevResultList)?void 0:i.length)>0)for(var c=0;c<this.prevResultList.length;c++){var h=this.prevResultList[c];switch(h.toolName){case E.Rect:h.result&&h.result.length>0&&h.result.forEach((function(t){if(t.isVisible){var e=l.getColor(t.attribute),i=t.valid?null==e?void 0:e.valid.stroke:null==e?void 0:e.invalid.stroke;Ze.drawRect(l.canvas,Wn.changeRectByZoom(t,l.zoom,l.currentPos),{color:i,thickness:u})}}));break;case E.Polygon:h.result.forEach((function(t){if(t.isVisible){var e=l.getColor(t.attribute),i=Wn.changePointListByZoom(t.pointList||[],l.zoom,l.currentPos);Ze.drawPolygonWithFillAndLine(l.canvas,Wn.changePointListByZoom(t.pointList,l.zoom,l.currentPos),{fillColor:t.valid?null==e?void 0:e.valid.fill:null==e?void 0:e.invalid.fill,strokeColor:t.valid?null==e?void 0:e.valid.stroke:null==e?void 0:e.invalid.stroke,isClose:!0,thickness:u}),Ze.drawText(l.canvas,i[0],t.attribute,xi({color:t.valid?null==e?void 0:e.valid.stroke:null==e?void 0:e.invalid.stroke},Tt))}}));break;case E.Line:h.result.forEach((function(t){if(t.isVisible){var e=l.getColor(t.attribute),i=Wn.changePointListByZoom(t.pointList||[],l.zoom,l.currentPos);Ze.drawLineWithPointList(l.canvas,Wn.changePointListByZoom(t.pointList,l.zoom,l.currentPos),{color:t.valid?null==e?void 0:e.valid.stroke:null==e?void 0:e.invalid.stroke,thickness:u}),Ze.drawText(l.canvas,i[0],t.attribute,xi({color:t.valid?null==e?void 0:e.valid.stroke:null==e?void 0:e.invalid.stroke},Tt))}}));break;case E.Point:h.result&&h.result.length>0&&h.result.forEach((function(t){if(t.isVisible){var e=l.style.width,i=void 0===e?2:e,n=Wn.changePointByZoom(t,l.zoom,l.currentPos),r=Wn.changeRectByZoom(t,l.zoom,l.currentPos),o=l.getColor(t.attribute);Ze.drawCircle(l.canvas,r,i,{startAngleDeg:0,endAngleDeg:360,thickness:1,color:t.valid?null==o?void 0:o.valid.stroke:null==o?void 0:o.invalid.stroke,fill:"transparent"}),Ze.drawText(l.canvas,{x:n.x+i/2+4,y:n.y-i-4},t.attribute,{textAlign:"center",color:t.valid?null==o?void 0:o.valid.stroke:null==o?void 0:o.invalid.stroke})}}));break;case E.Tag:if(h.result&&h.result.length>0){if(!((null==(n=h.result)?void 0:n.length)>0))return;var d=document.createElement("div"),g=Qt.getTagNameList(null!=(r=null==h?void 0:h.result[0].result)?r:{},this.config.tagConfigList);d.innerHTML=null!=(o=g.reduce((function(t,e){return"".concat(t).concat(e.keyName,": ").concat(e.value.join(" 、 "),"\n")}),""))?o:"",d.setAttribute("id","tagToolTag"),d.setAttribute("style","\n                  position: absolute;\n                  top: 0;\n                  right: 0;\n                  z-index: 5;\n                  padding: 0 20px;\n                  font-size: 15px;\n                  color: white;\n                  text-align: right;\n                  line-height: 32px;\n                  white-space: pre;\n                  background: rgba(102, 111, 255, 1);\n                  opacity: 0.6;\n                  clear: both;\n                "),null==(a=null==(s=this.canvas)?void 0:s.parentNode)||a.appendChild(d)}break;default:console.log(h.toolName),console.log(h)}}}},{key:"renderBasicCanvas",value:function(){!this.basicCanvas||(this.clearBasicCanvas(),this.drawImg())}},{key:"render",value:function(){!this.canvas||!this.ctx||!this.imgNode||!this.renderReady||(this.clearCanvas(),this.renderOtherAnnotation())}},{key:"changeStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultAttribute;this.emit("changeStyle",{attribute:t})}}]),i}(hi),wi=Object.defineProperty,Pi=Object.getOwnPropertySymbols,Ci=Object.prototype.hasOwnProperty,Di=Object.prototype.propertyIsEnumerable,Ai=function(t,e,i){return e in t?wi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},Ri=function(t,e){for(var i in e||(e={}))Ci.call(e,i)&&Ai(t,i,e[i]);if(Pi){var n,r=S(Pi(e));try{for(r.s();!(n=r.n()).done;){i=n.value;Di.call(e,i)&&Ai(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},Si=8,Ti=26,Zi=function(t){(0,h.Z)(i,t);var e=R(i);function i(t){var n;return(0,f.Z)(this,i),(n=e.call(this,t)).getHoverRectID=function(t){var e,i,r=n.getCoordinateUnderZoom(t),o=null!=(i=null==(e=n.resultList.find((function(t){return t.toolName===E.Rect})))?void 0:e.result)?i:[];if(o.length>0){var s=o.filter((function(t){return Ut.isInRect(r,t,2,n.zoom)}));if(0===s.length)return"";if(1===s.length)return s[0].id;if(s.length>1)return s.map((function(t){return{size:t.width*t.height,id:t.id}})).sort((function(t,e){return t.size-e.size}))[0].id}return""},n.resultList=[],n.hoverID=[],n.fillID=[],n.render=n.render.bind((0,c.Z)(n)),n.drawPolygon=n.drawPolygon.bind((0,c.Z)(n)),n.drawRect=n.drawRect.bind((0,c.Z)(n)),n.drawTag=n.drawTag.bind((0,c.Z)(n)),n.setShowDefaultCursor(!0),n.forbidOperation=!0,n}return(0,y.Z)(i,[{key:"onMouseDown",value:function(t){var e,n;if((0,u.Z)((0,g.Z)(i.prototype),"onMouseDown",this).call(this,t)||this.forbidMouseOperation||!this.imgInfo)return!0;var r=this.mouseHoverID,o=null!=(n=null==(e=this.resultList.find((function(t){return t.toolName===E.Rect})))?void 0:e.result)?n:[];if(0===t.button){var s=[r],a=!0;r&&o.find((function(t){return t.id===r&&(null==t?void 0:t.isSelected)}))&&(a=!1),r||(s=o.map((function(t){return t.id})),a=!1),this.emit("setSelectedID",s,a),this.render()}}},{key:"updateRotate",value:function(){}},{key:"onMouseMove",value:function(t){if(!(0,u.Z)((0,g.Z)(i.prototype),"onMouseMove",this).call(this,t)&&!this.forbidMouseOperation&&this.imgInfo){var e=this.mouseHoverID,n=this.getHoverRectID(t);if(e!==n){this.mouseHoverID=n;var r=[n];n||(r=[]),this.emit("setHoverID",r),this.render()}}}},{key:"setResult",value:function(t){this.resultList=(0,I.cloneDeep)(t),this.render()}},{key:"drawPolygon",value:function(t,e){var i=this;null==t||t.forEach((function(t){var n,r,o,s,a,l=i.getColor(t.attribute,e),u=Me.getStrokeAndFill(l,t.valid),c=null!=(r=null==(n=i.style)?void 0:n.width)?r:2;i.hoverID.includes(t.id)?(c=4,Ze.drawPolygonWithFillAndLine(i.canvas,Wn.changePointListByZoom(t.pointList,i.zoom,i.currentPos),{fillColor:u.fill,strokeColor:u.stroke,pointColor:"white",thickness:c,lineCap:"round",isClose:!0,lineType:null==e?void 0:e.lineType})):Ze.drawPolygon(i.canvas,Wn.changePointListByZoom(t.pointList,i.zoom,i.currentPos),{color:u.fill,lineType:null==(o=i.config)?void 0:o.lineType,thickness:c,isClose:!0});var h="".concat(null!=(a=xe.getAttributeShowText(t.attribute,null!=(s=null==e?void 0:e.attributeList)?s:[]))?a:"");(null==e?void 0:e.isShowOrder)&&(null==t?void 0:t.order)>0&&(h="".concat(t.order," ").concat(h)),Ze.drawText(i.canvas,Wn.changePointByZoom(t.pointList[0],i.zoom,i.currentPos),h,Ri({color:u.stroke},Tt));var d=Wn.changePointListByZoom(t.pointList||[],i.zoom,i.currentPos),g=d[d.length-1];Ze.drawText(i.canvas,{x:g.x+Si,y:g.y+Ti},null==t?void 0:t.textAttribute,Ri({color:u.stroke},Tt))}))}},{key:"drawRect",value:function(t,e){var i=this;null==t||t.forEach((function(t){var n=1;i.hoverID.includes(t.id)&&(n=3);var r=i.getColor(t.attribute,e),o=Wn.changeRectByZoom(t,i.zoom,i.currentPos);Ze.drawRect(i.canvas,o,{color:(null==t?void 0:t.valid)?r.valid.stroke:r.invalid.stroke,thickness:n}),i.fillID.includes(t.id)&&Ze.drawRectWithFill(i.canvas,o,{color:(null==t?void 0:t.valid)?r.valid.fill:r.invalid.fill})}))}},{key:"drawTag",value:function(t,e){var i=t.reduce((function(t,i){return[].concat((0,b.Z)(t),(0,b.Z)((null==e?void 0:e.inputList)?Qt.getTagNameList(i.result,e.inputList):Qt.getTagnameListWithoutConfig(i.result)))}),[]);Ze.drawTag(this.canvas,i)}},{key:"setHoverID",value:function(t){this.hoverID=t,this.render()}},{key:"setFillID",value:function(t){this.fillID=t,this.render()}},{key:"render",value:function(){var t,e=this;(0,u.Z)((0,g.Z)(i.prototype),"render",this).call(this),null==(t=this.resultList)||t.forEach((function(t){switch(null==t?void 0:t.toolName){case E.Rect:e.drawRect(t.result,Dn.jsonParser(t.config));break;case E.Polygon:e.drawPolygon(t.result,Dn.jsonParser(t.config));break;case E.Tag:e.drawTag(t.result,Dn.jsonParser(t.config))}}))}},{key:"exportData",value:function(){return[[],{}]}}]),i}(Ii),Mi=function(){function t(e){var i=this;(0,f.Z)(this,t),this.textKeyDown=function(t){if(t.stopPropagation(),t.keyCode===ii.Enter)i.submitTextarea(),i.appendToContainer()};var n=e.container,r=e.icon,o=e.color,s=e.getCurrentSelectedData,a=e.updateSelectedTextAttribute,l=e.width||164;this.container=n,this.getCurrentSelectedData=s,this.updateSelectedTextAttribute=a,this._textAttributeDOM=this.initTextAttributeDOM(),this._iconDOM=this.initIconDOM(r),this._textDOM=this.initTextDOM(l,16),this._textareaDOM=this.initTextareaDOM(l,o),this.appendToContainer()}return(0,y.Z)(t,[{key:"isExit",get:function(){return!!this._textAttributeDOM&&this.container.contains(this._textAttributeDOM)}},{key:"isExitTextareaDOM",get:function(){return!!this._textareaDOM&&this.container.contains(this._textareaDOM)}},{key:"updateIcon",value:function(t){this._iconDOM&&(this._iconDOM.innerHTML=t)}},{key:"appendToContainer",value:function(){!this._textAttributeDOM||!this._textDOM||!this._iconDOM||(this.container.appendChild(this._textAttributeDOM),this._textAttributeDOM.appendChild(this._textDOM),this._textAttributeDOM.appendChild(this._iconDOM))}},{key:"initTextAttributeDOM",value:function(){var t=document.createElement("div");return t.setAttribute("id","textArea"),t}},{key:"initTextDOM",value:function(t,e){var i=document.createElement("span");return i.setAttribute("style","\n        width: ".concat(Math.max(t,30),"px;\n        line-height: ").concat(e,"px;\n        word-break: break-all;\n        white-space: pre-line;\n        font-style: italic;\n      ")),i}},{key:"initIconDOM",value:function(t){var e=this,i=document.createElement("div");return i.setAttribute("id","annotation_text"),i.innerHTML=t,i.addEventListener("mouseup",(function(t){t.stopPropagation(),e.renderTextarea()})),i.addEventListener("mousedown",(function(t){t.stopPropagation()})),i.addEventListener("contextmenu",(function(t){t.stopPropagation()})),i.setAttribute("style","\n        position: absolute;\n        left: -20px;\n        top: 4px;\n        cursor: pointer;\n        z-index: 10\n      "),i}},{key:"initTextareaDOM",value:function(t,e){var i=document.createElement("textarea");return i.addEventListener("click",(function(t){t.stopPropagation()})),i.addEventListener("mouseup",(function(t){t.stopPropagation()})),i.setAttribute("style","\n      background-color: transparent;\n      border-radius: 5px;\n      border-color: ".concat(e,";\n      outline: none;\n      resize: none;\n      width: ").concat(Math.max(t,30),"px;\n      ")),i.setAttribute("maxLength","".concat(q)),i}},{key:"removeTextDOM",value:function(){!this._textAttributeDOM||this._textDOM&&this._textAttributeDOM.removeChild(this._textDOM)}},{key:"removeIconDOM",value:function(){!this._textAttributeDOM||this._iconDOM&&this._textAttributeDOM.removeChild(this._iconDOM)}},{key:"removeTextareaDOM",value:function(){var t,e;this._textareaDOM&&this._textAttributeDOM&&(null==(t=this._textAttributeDOM)?void 0:t.contains(this._textareaDOM))&&(null==(e=this._textAttributeDOM)||e.removeChild(this._textareaDOM))}},{key:"submitTextarea",value:function(){var t;this._textareaDOM&&(this.updateSelectedTextAttribute(null==(t=this._textareaDOM)?void 0:t.value),this.removeTextareaDOM(),this.clearTextAttribute())}},{key:"clearTextAttribute",value:function(){this._textAttributeDOM&&this.container.contains(this._textAttributeDOM)&&this.container.removeChild(this._textAttributeDOM)}},{key:"renderTextarea",value:function(){if(this._textAttributeDOM&&this._textareaDOM){var t=this.getCurrentSelectedData();if(t){var e=t.width,i=void 0===e?164:e,n=t.textAttribute,r=t.color;this._textareaDOM.value="".concat(n),this._textareaDOM.setAttribute("style","\n      background-color: rgba(0,0,0,0.4);\n      border-radius: 5px;\n      border-color: ".concat(r,";\n      outline: none;\n      resize: none;\n      font-style: italic;\n      font-weight: 900;\n      text-shadow: 0px 2px 4px rgba(0, 0, 0, 0.6);\n      width: ").concat(Math.max(i,30),"px;\n      ")),this._textareaDOM.setAttribute("maxLength","".concat(q)),this._textAttributeDOM.appendChild(this._textareaDOM),this.removeIconDOM(),this.removeTextDOM(),this._textareaDOM.focus(),this._textareaDOM.addEventListener("keydown",this.textKeyDown)}}}},{key:"update",value:function(t,e){var i,n=e.left,r=e.top,o=e.color,s=e.width,a=void 0===s?164:s,l=Math.max(a,30);null==(i=this._textAttributeDOM)||i.setAttribute("style","\n        position: absolute; \n        width: ".concat(l,"px;\n        font-size: 14px; \n        left:").concat(n,"px; \n        top: ").concat(r,"px; \n        color: ").concat(o,";\n      ")),this._textDOM&&(this._textDOM.innerHTML="".concat(t)),this._textareaDOM&&(this._textareaDOM.style.width="".concat(l,"px"),this._textareaDOM.style.borderColor="".concat(o))}},{key:"changeSelected",value:function(){this.isExitTextareaDOM&&this.submitTextarea()}}]),t}(),Oi=Object.defineProperty,Ei=Object.defineProperties,Ni=Object.getOwnPropertyDescriptors,Hi=Object.getOwnPropertySymbols,Bi=Object.prototype.hasOwnProperty,_i=Object.prototype.propertyIsEnumerable,zi=function(t,e,i){return e in t?Oi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},Fi=function(t,e){for(var i in e||(e={}))Bi.call(e,i)&&zi(t,i,e[i]);if(Hi){var n,r=S(Hi(e));try{for(r.s();!(n=r.n()).done;){i=n.value;_i.call(e,i)&&zi(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},ji=function(t,e){return Ei(t,Ni(e))},Ui=function(t){(0,h.Z)(i,t);var e=R(i);function i(t){var n;return(0,f.Z)(this,i),(n=e.call(this,t)).isAllowDouble=function(t){var e=(0,c.Z)(n).selectedID,i=n.getHoverID(t);return!(!e||e!==i)},n.textChange=function(t){!1===n.config.textConfigurable||!n.selectedID||(n.setPolygonList(xe.textChange(t,n.selectedID,n.polygonList)),n.emit("selectedChange"),n.render())},n.config=Dn.jsonParser(t.config),n.drawingPointList=[],n.polygonList=[],n.hoverPointIndex=-1,n.hoverEdgeIndex=-1,n.drawingHistory=new ri,n.isCtrl=!1,n.isAlt=!1,n.isCombined=!1,n.pattern=$.Normal,n.getCurrentSelectedData=n.getCurrentSelectedData.bind((0,c.Z)(n)),n.updateSelectedTextAttribute=n.updateSelectedTextAttribute.bind((0,c.Z)(n)),n}return(0,y.Z)(i,[{key:"eventBinding",value:function(){(0,u.Z)((0,g.Z)(i.prototype),"eventBinding",this).call(this),this.container.removeEventListener("mouseup",this.onMouseUp),this.container.addEventListener("mouseup",this.dragMouseUp),this.dblClickListener.addEvent(this.onMouseUp,this.onLeftDblClick,this.onRightDblClick,this.isAllowDouble)}},{key:"eventUnbinding",value:function(){(0,u.Z)((0,g.Z)(i.prototype),"eventUnbinding",this).call(this),this.container.removeEventListener("mouseup",this.dragMouseUp)}},{key:"destroy",value:function(){(0,u.Z)((0,g.Z)(i.prototype),"destroy",this).call(this),this._textAttributInstance&&this._textAttributInstance.clearTextAttribute()}},{key:"selectedPolygon",get:function(){return En.getPolygonByID(this.polygonList,this.selectedID)}},{key:"polygonListUnderZoom",get:function(){var t=this;return this.polygonList.map((function(e){return ji(Fi({},e),{pointList:Wn.changePointListByZoom(e.pointList,t.zoom)})}))}},{key:"selectedText",get:function(){var t;return null==(t=this.selectedPolygon)?void 0:t.textAttribute}},{key:"dataList",get:function(){return this.polygonList}},{key:"setPattern",value:function(t){var e;(null==(e=this.drawingPointList)?void 0:e.length)>0||(this.pattern=t)}},{key:"currentShowList",get:function(){var t=[],e=Dn.getRenderResultList(this.polygonList,Dn.getSourceID(this.basicResult),this.attributeLockList,this.selectedID),i=(0,p.Z)(e,2),n=i[0],r=i[1];return t=n,this.isHidden&&(t=[]),r&&t.push(r),t}},{key:"currentPageResult",get:function(){var t=Dn.getRenderResultList(this.polygonList,Dn.getSourceID(this.basicResult),[]);return(0,p.Z)(t,1)[0]}},{key:"setResult",value:function(t){this.clearActiveStatus(),this.setPolygonList(t),this.render()}},{key:"setPolygonDataByID",value:function(t,e){return this.polygonList.map((function(i){return i.id===e?Fi(Fi({},i),t):i}))}},{key:"rotatePolygon",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:St.Clockwise,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectedID;if(i){var n=En.getPolygonByID(this.polygonList,i);if(n){var r=En.updatePolygonByRotate(e,t,null==n?void 0:n.pointList);this.setPolygonList(this.setPolygonDataByID({pointList:r},i)),this.render()}}}},{key:"addPointInDrawing",value:function(t){if(this.imgInfo){var e=this.config,i=e.upperLimitPointNum,n=e.edgeAdsorption;if(i&&this.drawingPointList.length>=i)this.emit("messageInfo","".concat(ue.getMessagesByLocale(Wt.UpperLimitErrorNotice,this.lang)).concat(i));else{this.setSelectedID("");var r=this.getCoordinateUnderZoom(t),o=Wn.changeDrawOutsideTarget(r,{x:0,y:0},this.imgInfo,this.config.drawOutsideTarget,this.basicResult,this.zoom);if(0!==Wn.returnClosePointIndex(o,Wn.changePointListByZoom(this.drawingPointList,this.zoom))){var s=En.getClosestPoint(o,this.polygonListUnderZoom,this.config.lineType,nt).dropFoot,a=Wn.changePointByZoom(s&&!1===t.altKey&&n?s:o,1/this.zoom);if(this.pattern===$.Rect&&2===this.drawingPointList.length){var l=Lt.getRectangleByRightAngle(a,this.drawingPointList);return this.drawingPointList=l,!1===this.config.drawOutsideTarget&&this.imgInfo&&this.isPolygonOutSide(this.drawingPointList)?(this.emit("messageInfo","".concat(ue.getMessagesByLocale(Wt.ForbiddenCreationOutsideBoundary,this.lang))),void(this.drawingPointList=[])):void this.addDrawingPointToPolygonList(!0)}this.drawingPointList.push(a),1===this.drawingPointList.length?this.drawingHistory.initRecord(this.drawingPointList):this.drawingHistory.pushHistory(this.drawingPointList)}else this.addDrawingPointToPolygonList()}}}},{key:"clearResult",value:function(){this.setPolygonList([]),this.setSelectedID(void 0),this.render()}},{key:"clearPolygonDrag",value:function(){this.drawingPointList=[],this.dragInfo=void 0,this.dragInfo=void 0,this.dragStatus=Pt.Wait,this.hoverEdgeIndex=-1,this.hoverPointIndex=-1,this.hoverID=""}},{key:"clearActiveStatus",value:function(){this.clearPolygonDrag(),this.setSelectedID(void 0)}},{key:"setPolygonList",value:function(t){var e=this.polygonList.length;this.polygonList=t,e!==t.length&&this.emit("updatePageNumber")}},{key:"setSelectedID",value:function(t){var e,i,n=this.selectedID;t!==n&&n&&(null==(e=this._textAttributInstance)||e.changeSelected()),t||null==(i=this._textAttributInstance)||i.clearTextAttribute(),this.selectedID=t,this.render(),this.emit("selectedChange")}},{key:"setDefaultAttribute",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.defaultAttribute;if(this.defaultAttribute=t,e!==t){this.changeStyle(t),this.emit("changeAttributeSidebar");var i=this.selectedID;if(i&&(this.selectedPolygon&&(this.selectedPolygon.attribute=t),this.history.pushHistory(this.polygonList),this.render()),this._textAttributInstance){if(this.attributeLockList.length>0&&!this.attributeLockList.includes(t))return void this._textAttributInstance.clearTextAttribute();this._textAttributInstance.updateIcon(this.getTextIconSvg(t))}}}},{key:"setStyle",value:function(t){var e;(0,u.Z)((0,g.Z)(i.prototype),"setStyle",this).call(this,t),this._textAttributInstance&&!1===this.config.attributeConfigurable&&(null==(e=this._textAttributInstance)||e.updateIcon(this.getTextIconSvg()))}},{key:"setPolygonValidAndRender",value:function(t){if(t){var e=this.polygonList.map((function(e){return e.id===t?ji(Fi({},e),{valid:!e.valid}):e}));this.setPolygonList(e),this.history.pushHistory(this.polygonList),this.render(),this.emit("updateResult")}}},{key:"addDrawingPointToPolygonList",value:function(t){var e=this,i=this.config.lowerLimitPointNum,n=void 0===i?3:i;if(n<3&&(n=3),this.drawingPointList.length<n)return this.drawingPointList=[],void(this.editPolygonID="");var r=Dn.getSourceID(this.basicResult),o=(0,b.Z)(this.polygonList);if(this.editPolygonID){var s=o.find((function(t){return t.id===e.editPolygonID}));if(!s)return;s.pointList=this.drawingPointList,this.editPolygonID=""}else{var a=Vt(8,62),l={id:a,sourceID:r,valid:!this.isCtrl,isVisible:!0,textAttribute:"",pointList:this.drawingPointList,attribute:this.defaultAttribute,order:Dn.getMaxOrder(o.filter((function(t){return Dn.isSameSourceID(t.sourceID,r)})))+1};if(this.config.textConfigurable){var u;u=xe.getTextAttribute(this.polygonList.filter((function(t){return Dn.isSameSourceID(t.sourceID,r)})),this.config.textCheckType),l=ji(Fi({},l),{textAttribute:u})}this.pattern===$.Rect&&!0===t&&(l=ji(Fi({},l),{isRect:!0})),o.push(l),this.setSelectedIdAfterAddingDrawing(a)}this.setPolygonList(o),this.isCtrl=!1,this.drawingPointList=[],this.history.pushHistory(o)}},{key:"setSelectedIdAfterAddingDrawing",value:function(t){0!==this.drawingPointList.length&&(this.config.textConfigurable?this.setSelectedID(t):this.setSelectedID())}},{key:"getHoverID",value:function(t){var e,i=this,n=this.getCoordinateUnderZoom(t),r=this.currentShowList.map((function(t){return ji(Fi({},t),{pointList:Wn.changePointListByZoom(t.pointList,i.zoom)})}));return En.getHoverPolygonID(n,r,10,null==(e=this.config)?void 0:e.lineType)}},{key:"getHoverEdgeIndex",value:function(t){var e;if(!this.selectedID)return-1;var i=this.selectedPolygon;if(!i)return-1;var n=this.getCoordinateUnderZoom(t),r=Wn.changePointListByZoom(i.pointList,this.zoom);return En.getHoverEdgeIndex(n,r,null==(e=this.config)?void 0:e.lineType)}},{key:"getHoverPointIndex",value:function(t){if(!this.selectedID)return-1;var e=this.selectedPolygon;if(!e)return-1;var i=this.getCoordinateUnderZoom(t),n=Wn.changePointListByZoom(e.pointList,this.zoom);return Wn.returnClosePointIndex(i,n)}},{key:"deletePolygon",value:function(t){var e;!t||(this.setPolygonList(this.polygonList.filter((function(e){return e.id!==t}))),this.history.pushHistory(this.polygonList),null==(e=this._textAttributInstance)||e.clearTextAttribute(),this.emit("selectedChange"),this.render())}},{key:"deletePolygonPoint",value:function(t){if(this.selectedID){var e=this.selectedPolygon;if(e){var i=this.config.lowerLimitPointNum;i<3&&(i=3),e.pointList.length<=i?this.emit("messageInfo","".concat(ue.getMessagesByLocale(Wt.LowerLimitErrorNotice,this.lang)).concat(i)):(null==e||e.pointList.splice(t,1),this.history.pushHistory(this.polygonList),this.render())}}}},{key:"spaceKeydown",value:function(){var t,e,i;if(this.selectedID){if(!0===(null==(t=this.selectedPolygon)?void 0:t.isRect))return void this.emit("messageInfo","".concat(ue.getMessagesByLocale(Wt.UnableToReannotation,this.lang)));this.editPolygonID=this.selectedID,this.drawingPointList=null!=(i=null==(e=this.selectedPolygon)?void 0:e.pointList)?i:[],this.drawingHistory.empty(),this.drawingHistory.initRecord(this.drawingPointList),this.hoverID="",this.setSelectedID(""),this.render()}}},{key:"onTabKeyDown",value:function(t){if(t.preventDefault(),!(this.drawingPointList.length>0)){var e=Dt.ascend;t.shiftKey&&(e=Dt.descend);var i=Dn.getRenderResultList(this.polygonList,Dn.getSourceID(this.basicResult),this.attributeLockList,this.selectedID),n=(0,p.Z)(i,2),r=n[0],o=n[1],s=(0,b.Z)(r);o&&(s=[].concat((0,b.Z)(s),[o]));var a=Oe.getViewPort(this.canvas,this.currentPos,this.zoom),l=s.map((function(t){var e,i,n,r;return ji(Fi({},t),{x:null!=(i=null==(e=t.pointList[0])?void 0:e.x)?i:0,y:null!=(r=null==(n=t.pointList[0])?void 0:n.y)?r:0})})).filter((function(t){return Oe.inViewPort({x:t.x,y:t.y},a)})),u=Dn.getNextSelectedRectID(l,e,this.selectedID);if(u){this.setSelectedID(u.id);var c=this.selectedPolygon;c&&this.setDefaultAttribute(c.attribute)}this.render()}}},{key:"onKeyDown",value:function(t){if(Dn.hotkeyFilter(t)&&!1!==(0,u.Z)((0,g.Z)(i.prototype),"onKeyDown",this).call(this,t)){var e=t.keyCode;switch(e){case ii.Space:this.spaceKeydown();break;case ii.Esc:this.drawingPointList=[],this.editPolygonID="";break;case ii.F:this.selectedID&&this.setPolygonValidAndRender(this.selectedID);break;case ii.Z:if(t.altKey)return void this.onCombinedExecute();this.setIsHidden(!this.isHidden),this.render();break;case ii.Delete:this.deletePolygon(this.selectedID),this.render();break;case ii.Ctrl:this.isCtrl=!0;break;case ii.Alt:!1===this.isAlt&&(t.preventDefault(),this.isAlt=!0,this.render());break;case ii.Tab:this.onTabKeyDown(t);break;case ii.X:t.altKey&&this.segment();break;default:if(this.config.attributeConfigurable){var n=xe.getAttributeByKeycode(e,this.config.attributeList);void 0!==n&&this.setDefaultAttribute(n)}}}}},{key:"onKeyUp",value:function(t){switch((0,u.Z)((0,g.Z)(i.prototype),"onKeyUp",this).call(this,t),t.keyCode){case ii.Ctrl:this.isCtrl=!1;break;case ii.Alt:var e=this.isAlt;this.isAlt=!1,!0===e&&this.render()}}},{key:"rightMouseUp",value:function(){this.drawingPointList.length>0&&this.addDrawingPointToPolygonList(),this.setSelectedID(this.hoverID);var t=this.selectedPolygon;t&&this.setDefaultAttribute(t.attribute)}},{key:"onLeftDblClick",value:function(t){if(this.hoverEdgeIndex>-1){var e=this.getCoordinateUnderZoom(t),i=this.selectedPolygon;if(!i)return;var n=En.getClosestPoint(e,this.polygonListUnderZoom,this.config.lineType,nt).dropFoot;if(!n)return;var r=this.config.upperLimitPointNum;if(r&&i.pointList.length>=r)return this.emit("messageInfo","".concat(ue.getMessagesByLocale(Wt.UpperLimitErrorNotice,this.lang)).concat(r)),void this.clearPolygonDrag();null==i||i.pointList.splice(this.hoverEdgeIndex+1,0,Wn.changePointByZoom(n,1/this.zoom)),this.setPolygonDataByID(i,this.selectedID),this.history.pushHistory(this.polygonList),this.hoverPointIndex=-1,this.hoverEdgeIndex=-1,this.render()}this.dragInfo=void 0}},{key:"onRightDblClick",value:function(t){this.dragInfo=void 0,this.clearImgDrag();var e=this.getHoverID(t),i=this.getHoverPointIndex(t);if(this.hoverPointIndex>-1&&this.hoverPointIndex===i)return this.deletePolygonPoint(i),this.dragInfo=void 0,this.hoverPointIndex=-1,void this.render();this.hoverID===this.selectedID&&this.deletePolygon(e),this.render()}},{key:"onMouseDown",value:function(t){if(!(0,u.Z)((0,g.Z)(i.prototype),"onMouseDown",this).call(this,t)&&!this.forbidMouseOperation&&!0!==t.ctrlKey){var e=this.selectedPolygon;if(e&&0===t.button&&this.getHoverID(t)===this.selectedID){var n=e.pointList,r=this.getCoordinateUnderZoom(t),o=[0],s=Ct.Plane;this.dragStatus=Pt.Start;var a=this.getHoverPointIndex(t),l=this.getHoverEdgeIndex(t);return a>-1?(s=Ct.Point,o=[a]):l>-1&&this.hoverEdgeIndex>-1&&(s=Ct.Line,o=[l,(l+1)%n.length]),this.dragInfo={dragStartCoord:r,dragTarget:s,initPointList:n,changePointIndex:o},!0}}}},{key:"segment",value:function(){var t,e=this;if(this.selectedID&&(null==(t=this.config)?void 0:t.lineType)===j.Line){var i=En.getPolygonPointList(this.selectedID,this.currentShowList),n=this.currentShowList.filter((function(t){return t.id!==e.selectedID}));if(0!==n.length&&0!==i.length){var r=En.getWrapPolygonIndex(i,n),o=(0,b.Z)(this.polygonList);if(-1===r){var s=En.segmentPolygonByPolygon(i,n);if(!s)return;var a=s.shift();if(!a)return;var l="",u=!0,c=Dn.getSourceID(this.basicResult),h="";o=this.polygonList.map((function(t){var i,n;return t.id===e.selectedID?(l=t.attribute,u=null==(i=null==t?void 0:t.valid)||i,h=null!=(n=null==t?void 0:t.textAttribute)?n:"",ji(Fi({},t),{pointList:a})):t})),s.length>0&&s.forEach((function(t,i){o.push({sourceID:c,id:Vt(8,62),pointList:t,valid:u,isVisible:!0,order:Dn.getMaxOrder(e.currentShowList)+1+i,attribute:l,textAttribute:h})}))}else o[r].pointList=En.clipPolygonFromWrapPolygon(i,o[r].pointList),o=o.filter((function(t){return t.id!==e.selectedID}));this.setPolygonList(o),this.history.pushHistory(o),this.render()}}}},{key:"onCombinedExecute",value:function(){this.selectedID?this.isCombined=!this.isCombined:this.emit("messageInfo",D.a.t("PolygonsToBeCombinedNeedToBeSelected"))}},{key:"combine",value:function(t){var e,i=this,n=this.getHoverID(t);if(n&&this.selectedID&&this.selectedID!==n)if((null==(e=this.config)?void 0:e.lineType)===j.Line){var r=this.polygonList.find((function(t){return t.id===i.selectedID})),o=this.currentShowList.find((function(t){return t.id===n}));if(o&&r){var s=En.combinePolygonWithPolygon(r,o);if(s){var a=s.newPolygon,l=s.unionList;if(1===l.length&&a){var u=this.polygonList.filter((function(t){return!l.includes(t.id)})).map((function(t){return t.id===i.selectedID?a:t}));this.setPolygonList(u),this.history.pushHistory(u),this.render(),this.emit("messageInfo",D.a.t("CombineSuccess"))}else this.emit("messageInfo",D.a.t("CombiningFailedNotify"));this.isCombined=!1}}}else this.emit("messageInfo",D.a.t("CurveModeDoesNotSupportCutting"))}},{key:"isPolygonOutSide",value:function(t){var e=this;if(this.dependToolName&&this.basicCanvas&&this.basicResult){var i=!1;switch(this.dependToolName){case E.Rect:i=t.filter((function(t){return!Ut.isInRect(t,e.basicResult)})).length>0;break;case E.Polygon:i=En.isPointListOutSidePolygon(t,this.basicResult.pointList,this.config.lineType)}return i}if(!this.imgInfo)return!1;var n=Lt.calcViewportBoundaries(Wn.changePointListByZoom(t,this.zoom)),r=n.left,o=n.top,s=n.right,a=n.bottom,l=1e-5;return r<0||o<0||s>this.imgInfo.width+l||a>this.imgInfo.height+l}},{key:"onDragMove",value:function(t){var e=this;if(this.dragInfo&&this.selectedID){var i=this.selectedPolygon,n=null==i?void 0:i.pointList;if(n){var r=this.dragInfo,o=r.initPointList,s=r.dragStartCoord,a=r.dragTarget,l=r.changePointIndex,u=this.getCoordinateUnderZoom(t),c={x:(u.x-s.x)/this.zoom,y:(u.y-s.y)/this.zoom};if(this.pattern===$.Rect&&!0===(null==i?void 0:i.isRect)&&l&&[Ct.Line].includes(a)){var h=Lt.getArrayIndex(l[0]-2,4),d=Lt.getArrayIndex(l[0]-1,4),g=[o[h],o[d]];c=Lt.getRectPerpendicularOffset(s,u,g)}switch(this.dragStatus=Pt.Move,a){case Ct.Plane:n=n.map((function(t,e){return ji(Fi({},t),{x:o[e].x+c.x,y:o[e].y+c.y})}));break;case Ct.Point:case Ct.Line:n=n.map((function(t,e){return l&&l.includes(e)?ji(Fi({},t),{x:o[e].x+c.x,y:o[e].y+c.y}):t}))}if(this.pattern===$.Rect&&!0===(null==i?void 0:i.isRect)&&a===Ct.Point&&l&&(n=Lt.getPointListFromPointOffset(o,l[0],c)),!1!==this.config.drawOutsideTarget||!this.imgInfo||!this.isPolygonOutSide(n)){var v=this.polygonList.map((function(t){if(t.id===e.selectedID){var i=ji(Fi({},t),{pointList:n});return!0===t.isRect&&e.pattern===$.Normal&&Object.assign(i,{isRect:!1}),i}return t}));this.setPolygonList(v),this.render()}}}}},{key:"onMouseMove",value:function(t){if(!(0,u.Z)((0,g.Z)(i.prototype),"onMouseMove",this).call(this,t)&&!this.forbidMouseOperation&&this.imgInfo)if(this.selectedID&&this.dragInfo)this.onDragMove(t);else{var e=-1,n=-1;if(this.selectedID&&(this.hoverEdgeIndex=-1,this.hoverPointIndex=-1,(e=this.getHoverPointIndex(t))>-1?this.hoverPointIndex=e:(n=this.getHoverEdgeIndex(t),this.hoverEdgeIndex=n)),!(this.drawingPointList.length>0)){var r=this.getHoverID(t);this.hoverID!==r&&(this.hoverID=r,this.render())}}}},{key:"leftMouseUp",value:function(t){var e=this.getHoverID(t);0===this.drawingPointList.length&&!0===t.ctrlKey&&e?this.setPolygonValidAndRender(e):this.addPointInDrawing(t)}},{key:"onMouseUp",value:function(t){if(this.isCombined)switch(t.button){case 0:this.combine(t);break;case 2:this.isCombined=!1;break;default:return}else if(!(0,u.Z)((0,g.Z)(i.prototype),"onMouseUp",this).call(this,t)&&!this.forbidMouseOperation&&this.imgInfo){if(this.dragInfo&&this.dragStatus===Pt.Move)return this.dragInfo=void 0,this.dragStatus=Pt.Wait,this.history.pushHistory(this.polygonList),void this.emit("updateResult");switch(t.button){case 0:this.leftMouseUp(t);break;case 2:this.rightMouseUp()}this.render()}}},{key:"dragMouseUp",value:function(){this.dragStatus===Pt.Start&&(this.dragInfo=void 0,this.dragStatus=Pt.Wait)}},{key:"exportData",value:function(){return[this.polygonList,this.basicImgInfo]}},{key:"getTextIconSvg",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return xe.getTextIconSvg(t,this.config.attributeList,this.config.attributeConfigurable,this.baseIcon)}},{key:"getCurrentSelectedData",value:function(){var t=this.selectedPolygon;if(t){var e=this.getColor(t.attribute),i=t.valid?null==e?void 0:e.valid.stroke:null==e?void 0:e.invalid.stroke;return{width:164,textAttribute:t.textAttribute,color:i}}}},{key:"updateSelectedTextAttribute",value:function(t){if(this._textAttributInstance&&t&&this.selectedID){var e=t;!1===xe.textAttributeValidate(this.config.textCheckType,"",e)&&(this.emit("messageError",xe.getErrorNotice(this.config.textCheckType,this.lang)),e=""),this.setPolygonList(xe.textChange(e,this.selectedID,this.polygonList)),this.emit("updateTextAttribute"),this.render()}}},{key:"renderTextAttribute",value:function(){var t,e=this.selectedPolygon;if(this.ctx&&!1!==this.config.textConfigurable&&e){var i=e.pointList,n=e.attribute,r=e.valid,o=e.textAttribute,s=i[i.length-1],a=s.x,l=s.y,u=Wn.getOffsetCoordinate({x:a,y:l},this.currentPos,this.zoom),c=this.getColor(n),h=r?null==c?void 0:c.valid.stroke:null==c?void 0:c.invalid.stroke;this._textAttributInstance||(this._textAttributInstance=new Mi({width:164,container:this.container,icon:this.getTextIconSvg(n),color:h,getCurrentSelectedData:this.getCurrentSelectedData,updateSelectedTextAttribute:this.updateSelectedTextAttribute})),this._textAttributInstance&&!(null==(t=this._textAttributInstance)?void 0:t.isExit)&&this._textAttributInstance.appendToContainer(),this._textAttributInstance.update("".concat(o),{left:u.x,top:u.y,color:h,width:164})}}},{key:"renderPolygon",value:function(){var t,e,i,n,r,o,s,a,l,u=this;if(this.container.dispatchEvent(this.saveDataEvent),!1===this.isHidden&&(null==(t=this.polygonList)||t.forEach((function(t){var e,i,n,r,o;if(![u.selectedID,u.editPolygonID].includes(t.id)&&t.isVisible){var s=t.textAttribute,a=t.attribute,l=u.getColor(a),c=Me.getStrokeAndFill(l,t.valid),h=Wn.changePointListByZoom(t.pointList||[],u.zoom,u.currentPos);Ze.drawPolygonWithFillAndLine(u.canvas,h,{fillColor:c.fill,strokeColor:c.stroke,pointColor:"white",thickness:null!=(i=null==(e=u.style)?void 0:e.width)?i:2,lineCap:"round",isClose:!0,lineType:null==(n=u.config)?void 0:n.lineType});var d="".concat(null!=(r=xe.getAttributeShowText(a,u.config.attributeList))?r:"");(null==(o=u.config)?void 0:o.isShowOrder)&&(null==t?void 0:t.order)>0&&(d="".concat(t.order," ").concat(d)),Ze.drawText(u.canvas,h[0],d,Fi({color:c.stroke},Tt));var g=h[h.length-1];g&&g.x&&Ze.drawText(u.canvas,{x:g.x+Mt.x,y:g.y+Mt.y},s,Fi({color:c.stroke},Tt))}}))),this.hoverID&&this.hoverID!==this.editPolygonID){var c=this.polygonList.find((function(t){return t.id===u.hoverID&&t.id!==u.selectedID}));if(c){var h="",d=this.getColor(c.attribute);h=c.valid?d.validHover.fill:Me.getStrokeAndFill(d,!1,{isHover:!0}).fill,Ze.drawPolygonWithFill(this.canvas,Wn.changePointListByZoom(c.pointList,this.zoom,this.currentPos),{color:h,lineType:null==(e=this.config)?void 0:e.lineType})}}if(this.selectedID){var g=this.selectedPolygon;if(g){var v=this.getColor(g.attribute),f=Me.getStrokeAndFill(v,g.valid,{isSelected:!0});Ze.drawSelectedPolygonWithFillAndLine(this.canvas,Wn.changePointListByZoom(g.pointList,this.zoom,this.currentPos),{fillColor:f.fill,strokeColor:f.stroke,pointColor:"white",thickness:2,lineCap:"round",isClose:!0,lineType:null==(i=this.config)?void 0:i.lineType});var y="".concat(null!=(n=xe.getAttributeShowText(g.attribute,this.config.attributeList))?n:"");(null==(r=this.config)?void 0:r.isShowOrder)&&(null==g?void 0:g.order)>0&&(y="".concat(g.order," ").concat(y)),Ze.drawText(this.canvas,Wn.changePointByZoom(g.pointList[0],this.zoom,this.currentPos),y,Fi({color:f.stroke},Tt)),this.renderTextAttribute()}}var p=this.getColor(this.defaultAttribute),x=Me.getStrokeAndFill(p,!this.isCtrl);if((null==(o=this.drawingPointList)?void 0:o.length)>0){var m=(0,b.Z)(this.drawingPointList),k=Wn.getOriginCoordinateWithOffsetCoordinate(this.coord,this.zoom,this.currentPos);if(this.pattern===$.Rect&&2===m.length)m=Lt.getRectangleByRightAngle(k,m);else{if((null==(s=this.config)?void 0:s.edgeAdsorption)&&!1===this.isAlt){var L=En.getClosestPoint(k,this.polygonList,null==(a=this.config)?void 0:a.lineType,nt/this.zoom).dropFoot;L&&(k=L)}m.push(k)}Ze.drawSelectedPolygonWithFillAndLine(this.canvas,Wn.changePointListByZoom(m,this.zoom,this.currentPos),{fillColor:x.fill,strokeColor:x.stroke,pointColor:"white",thickness:2,lineCap:"round",isClose:!1,lineType:this.config.lineType})}if(this.hoverPointIndex>-1&&this.selectedID){var I=this.selectedPolygon;if(!I)return;var w=Me.getStrokeAndFill(p,I.valid,{isSelected:!0}),P=null==I?void 0:I.pointList[this.hoverPointIndex];if(P){var C=Wn.changePointByZoom(P,this.zoom,this.currentPos),D=C.x,A=C.y;Ze.drawCircleWithFill(this.canvas,{x:D,y:A},5,{color:w.fill})}}if(this.hoverEdgeIndex>-1&&this.selectedID){var R=this.selectedPolygon;if(!R)return;var S=Me.getStrokeAndFill(p,R.valid,{isSelected:!0});Ze.drawLineWithPointList(this.canvas,Wn.changePointListByZoom(R.pointList,this.zoom,this.currentPos),{color:S.stroke,thickness:10,hoverEdgeIndex:this.hoverEdgeIndex,lineType:null==(l=this.config)?void 0:l.lineType})}}},{key:"render",value:function(){!this.ctx||!this.renderReady||((0,u.Z)((0,g.Z)(i.prototype),"render",this).call(this),this.renderPolygon(),this.renderCursorLine(this.getLineColor(this.defaultAttribute)))}},{key:"renderCursorLine",value:function(t){if((0,u.Z)((0,g.Z)(i.prototype),"renderCursorLine",this).call(this,t),this.isCombined){var e=this.coord,n=e.x,r=e.y,o=10;Ze.drawRectWithFill(this.canvas,{x:n+o,y:r-40-1,width:186,height:32},{color:"black"}),Ze.drawText(this.canvas,{x:n,y:r},D.a.t("ClickAnotherPolygon"),{textAlign:"center",color:"white",offsetX:103,offsetY:-21}),Ze.drawRect(this.canvas,{x:n-o,y:r-o,width:20,height:20},{lineDash:[6],color:"white"})}}},{key:"undo",value:function(){if(this.drawingPointList.length>0){var t=this.drawingHistory.undo();if(!t)return;return this.drawingPointList=t,void this.render()}var e=this.history.undo();e&&(e.length!==this.polygonList.length&&this.setSelectedID(""),this.setPolygonList(e),this.render())}},{key:"redo",value:function(){if(this.drawingPointList.length>0){var t=this.drawingHistory.redo();if(!t)return;return this.drawingPointList=t,void this.render()}var e=this.history.redo();e&&(e.length!==this.polygonList.length&&this.setSelectedID(""),this.setPolygonList(e),this.render())}}]),i}(Ii),Vi=function(t){(0,h.Z)(i,t);var e=R(i);function i(t){var n;return(0,f.Z)(this,i),(n=e.call(this,t)).getInitResultList=function(t,e){return 0!==t&&void 0!==t&&0===e.length?[]:Qt.getDefaultTagResult(n.config.inputList,e)},n.setLabel=function(t,e){var i,r;if(!(n.isImgError||!n.basicResult&&n.dependToolName)){var o=n.config.inputList;if(o[t]){var s=o[t].subSelected;if(t<o.length&&o[t].subSelected&&s&&e<s.length){var a=o[t].value,l=null==(i=s[e])?void 0:i.value,u=null==(r=o[t])?void 0:r.isMulti,c=n.tagResult.filter((function(t){var e="".concat(t.sourceID);return Dn.isSameSourceID(e,n.sourceID)}))[0];if(c){var h=0,d=c.result;for(var g in 0===c.sourceID&&(c.sourceID="0"),c.result)if(g===o[t].value){if(h++,!0===u){var v=d[g].split(";").filter((function(t){return""!==t})),f=v.indexOf(l);-1===f?v.push(l):v.splice(f,1),l=v.join(";")}""===l?1===Object.keys(d).length?n.tagResult=n.tagResult.filter((function(t){var e="".concat(t.sourceID);return Dn.isDifferSourceID(e,n.sourceID)})):Object.keys(d).length>1&&delete d[g]:d[g]=l}0===h&&Object.assign(c.result,(0,x.Z)({},a,l))}else n.tagResult=[{sourceID:n.sourceID,id:Vt(8,62),result:(0,x.Z)({},a,l)}];n.render()}}}},n.clearResult=function(){var t=arguments.length>1?arguments[1]:void 0;n.tagResult=t?n.tagResult.map((function(e){return(null==e?void 0:e.result[t])&&delete e.result[t],e})):[],n.render()},n.config=t.config,n.tagResult=[],n.labelSelectedList=[],n.setShowDefaultCursor(!0),n}return(0,y.Z)(i,[{key:"destroy",value:function(){this.clearTag(),(0,u.Z)((0,g.Z)(i.prototype),"destroy",this).call(this)}},{key:"setResult",value:function(t){this.tagResult=t,this.render()}},{key:"currentPageResult",get:function(){return[this.currentTagResult]}},{key:"currentTagResult",get:function(){var t,e=this;return null!=(t=this.tagResult.filter((function(t){var i="".concat(t.sourceID);return Dn.isSameSourceID(i,e.sourceID)}))[0])?t:{}}},{key:"sourceID",get:function(){return Dn.getSourceID(this.basicResult)}},{key:"onKeyDown",value:function(t){var e=this;if(Dn.hotkeyFilter(t)){var i=t.keyCode;if(i&&(i<=57&&i>=49||i<=105&&i>=97)){if(i-=i>57?97:49,1===this.config.inputList.length)return this.labelSelectedList=[0,i],this.setLabel(0,i),void setTimeout((function(){e.labelSelectedList=[],e.render()}),500);1===this.labelSelectedList.length?(this.labelSelectedList=[this.labelSelectedList[0],i],this.setLabel(this.labelSelectedList[0],i),setTimeout((function(){e.labelSelectedList=[],e.render()}),500)):(this.labelSelectedList=[i],this.emit("expend"))}}}},{key:"clearTag",value:function(){var t,e=null==(t=this.canvas)?void 0:t.parentNode,i=window.self.document.getElementById("tagToolTag");i&&e&&e.contains(i)&&(null==e||e.removeChild(i))}},{key:"renderTag",value:function(){var t,e,i,n,r,o;if(this.clearTag(),(null==(t=this.tagResult)?void 0:t.length)>0){var s=document.createElement("div"),a=Qt.getTagNameList(null!=(i=null==(e=this.tagResult[0])?void 0:e.result)?i:{},this.config.inputList);s.innerHTML=null!=(n=a.reduce((function(t,e){return"".concat(t).concat(e.keyName,": ").concat(e.value.join(" 、 "),"\n")}),""))?n:"",s.setAttribute("id","tagToolTag"),s.setAttribute("style","\n        position: absolute;\n        top: 0;\n        right: 0;\n        z-index: 5;\n      \n        padding: 0 20px;\n      \n        font-size: 15px;\n        color: white;\n        text-align: right;\n        line-height: 32px;\n        white-space: pre;\n      \n        background: rgba(102, 111, 255, 1);\n        opacity: 0.6;\n        clear: both;\n      "),null==(o=null==(r=this.canvas)?void 0:r.parentNode)||o.appendChild(s)}}},{key:"render",value:function(){this.renderTag(),(0,u.Z)((0,g.Z)(i.prototype),"render",this).call(this),this.emit("render")}},{key:"exportData",value:function(){var t=this.tagResult;return this.isImgError&&(t=[]),[t,this.basicImgInfo]}}]),i}(Ii),Wi=Object.defineProperty,Ki=Object.defineProperties,Xi=Object.getOwnPropertyDescriptors,Gi=Object.getOwnPropertySymbols,Yi=Object.prototype.hasOwnProperty,Ji=Object.prototype.propertyIsEnumerable,qi=function(t,e,i){return e in t?Wi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},Qi=function(t,e){for(var i in e||(e={}))Yi.call(e,i)&&qi(t,i,e[i]);if(Gi){var n,r=S(Gi(e));try{for(r.s();!(n=r.n()).done;){i=n.value;Ji.call(e,i)&&qi(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},$i=function(t,e){return Ki(t,Xi(e))};!function(t){t[t.Create=0]="Create",t[t.Active=1]="Active",t[t.None=2]="None"}(ci||(ci={}));var tn=16,en=0,nn=20,rn=function(t){(0,h.Z)(i,t);var e=R(i);function i(t){var n,r,o,s;return(0,f.Z)(this,i),(s=e.call(this,t)).drawActivatedLine=function(t,e,i){var n=w().cloneDeep(s.activeLine);if(n&&0!==n.length){var r,o=s.isActiveLineValid(),a=s.selectedID?s.lineList.find((function(t){return t.id===s.selectedID})):void 0;r=a?a.order:s.nextOrder();var l=s.getLineColorByAttribute({attribute:s.defaultAttribute,valid:!!o});n.map((function(t){return Object.assign(t,s.coordUtils.getRenderCoord(t))})),s.updateActiveArea(),s.drawLine(n,t,l,!0,!0),s.drawLineNumber(n[0],r,l,"",s.defaultAttribute,o),t&&s.isCreate&&s.arc(t,3,l),s.cursor&&!s.selectedPoint&&!i&&!s.isShift&&s.arc(s.cursor,5,l)}},s.drawHoverPoint=function(t){if(!s.isMousedown&&t&&s.isLineSelected){var e,i=s.getPointList(s.activeLine),n=s.activeLine.find((function(e){return ei.calcDistance(s.coordUtils.getRenderCoord(e),t)<=5}));!n&&s.activeLine&&(e=s.findNearestPoint(i,t)),s.hoverPointID=n?n.id:void 0,s.cursor=n||null==e?void 0:e.point}},s.lineList=[],s.activeLine=[],s.coordsInsideActiveArea=!1,s.hoverLineSegmentIndex=-1,s.isShift=!1,s.isReference=!1,s.drawCurveLine=function(t,e,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=ft(e,tn);t.save(),t.lineCap="round",t.lineJoin="round",t.strokeStyle=i.color,n&&(t.lineWidth=i.lineWidth),r&&ei.setReferenceCtx(t),e.forEach((function(e,i){var n=e.specialEdge,r=s.splice(0,17);t.save(),t.beginPath(),o===i&&(t.lineWidth=4),r.forEach((function(e,i){var r=e.x,o=e.y,s=i>0?"lineTo":"moveTo";n&&ei.setSpecialEdgeStyle(t),t[s](r,o)})),t.stroke(),t.restore()})),t.restore()},s.drawLine=function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=e?t.concat(e):t,a={color:i,lineWidth:r?1:s.lineStyle.lineWidth};s.isCurve?ei.drawCurveLine(s.ctx,o,a,!n,s.isReference,r?s.hoverLineSegmentIndex:-1):s.drawStraightLine(o,a,r),n&&t.forEach((function(t){var e,n,r=t.id,o=r&&[s.hoverPointID,null==(e=s.selectedPoint)?void 0:e.id].includes(r)?5:3;s.arc(t,o,i),[s.hoverPointID,null==(n=s.selectedPoint)?void 0:n.id].includes(r)||s.arc(t,2,"white")}))},s.drawStraightLine=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=(0,c.Z)(s),r=n.ctx;r&&(r.save(),r.lineCap="round",r.lineJoin="round",r.strokeStyle=e.color,r.lineWidth=e.lineWidth,s.isReference&&ei.setReferenceCtx(r),t.forEach((function(e,n){if(r.beginPath(),n>0){var o=t[n-1];r.save(),(null==o?void 0:o.specialEdge)&&ei.setSpecialEdgeStyle(r),i&&s.hoverLineSegmentIndex+1===n&&(r.lineWidth=4),r.moveTo(o.x,o.y),r.lineTo(e.x,e.y),r.stroke(),r.restore()}})),r.restore())},s.drawLines=function(){try{var t=w().cloneDeep(s.attributeFilteredLines);if(s.isHidden)return;s.container.dispatchEvent(s.saveDataEvent),t.forEach((function(t){if(t.id!==s.selectedID&&t.pointList&&t.isVisible){t.pointList.map((function(t){return Object.assign(t,s.coordUtils.getRenderCoord(t))}));var e=t.order,i=t.label,n=e,r=t&&s.getLineColorByAttribute(t);s.drawLine(t.pointList,void 0,r,!1),s.drawLineNumber(t.pointList[0],n,r,i,t.attribute,t.valid),t.id!==s.textEditingID&&s.drawLineTextAttribute(t.pointList[1],r,null==t?void 0:t.textAttribute)}}))}catch(t){console.error(t,"线条工具数据解析错误"),s.lineList=[],s.clearCanvas()}},s.render=function(t){!s.renderReady||((0,u.Z)((n=(0,c.Z)(s),(0,g.Z)(i.prototype)),"render",n).call(n),s.drawLines(),s.drawActivatedLine(t,void 0,!0),s.renderTextAttribute(),s.renderCursorLine(s.getLineColor(s.defaultAttribute)))},s.moveLineInPolygon=function(t,e){var i;if(!Array.isArray(s.activeLine))return!1;(null==(i=s.activeLine)?void 0:i.every((function(i){return s.isInBasicPolygon({x:i.x+t,y:i.y+e})})))&&(s.lineDragging=!0,s.moveActiveArea(t,e))},s.moveLineInRectRange=function(t,e,i,n){if(void 0!==s.activeArea){var r=s.activeArea,o=r.top,a=r.left,l=r.right,u=r.bottom,c=[a,l].map((function(e){return w().isNumber(e)?e+t:0})),h=[o,u].map((function(t){return w().isNumber(t)?t+e:0})),d=a>=0&&l&&Lt.isInRange(c,i),g=o>=0&&u&&Lt.isInRange(h,n),v=d?t:0,f=g?e:0;s.lineDragging=!0,s.moveActiveArea(v,f)}},s.onRightClick=function(t){if(s.cursor=void 0,s.isCreate){if(s.isLinePointsNotEnough())return;s.stopLineCreating(!0)}else s.setActiveArea(s.getCoordinate(t),!0),s.emit("contextmenu")},s.updateSelectedAttributeAfterHistoryChanged=function(){if(s.selectedID){var t=s.lineList.find((function(t){return t.id===s.selectedID})),e=null==t?void 0:t.attribute;"string"==typeof e&&(s.defaultAttribute=e,s.updateAttribute(e),s.render())}},s.onLeftClick=function(t){var e=s.getCoordinate(t),i=(0,c.Z)(s).lineDragging;if(s.lineDragging=!1,!s.isSpaceKey)if(s.isNone&&t.ctrlKey){var n=s.findHoverLine(e);n&&s.setInvalidLine(n.id)}else if(!s.isLinePointsExceed()){var r=s.getNextPoint(t,e);if(s.isCreate||s.isNone)s.setCreatStatusAndAddPoint(r);else if(s.isActive){if(i)return;if(s.isMouseCoordOutsideActiveArea())return s.setNoneStatus(!1),void s.setCreatStatusAndAddPoint(r);if(t.shiftKey)return void s.updateLineSegmentSpecial(e);if(s.coordsInsideActiveArea&&t.ctrlKey)return void s.setInvalidLine(s.selectedID);s.addLinePointToActiveLine()}}},s.onDblclick=function(){},s.onKeyUp=function(t){if((0,u.Z)((r=(0,c.Z)(s),(0,g.Z)(i.prototype)),"onKeyUp",r).call(r,t),s.isShift=!1,s.hoverLineSegmentIndex=-1,t.keyCode!==ii.Esc){if(s.isActive){if(t.keyCode===ii.Delete)return void s.deleteLine();if(t.keyCode===ii.F)return void s.setInvalidLine(s.selectedID);if(t.keyCode===ii.Space)return void s.continueToEdit()}s.keyboardEventWhileLineCreating(t)}else s.stopLineCreating(!1)},s.onRightDblClick=function(t){(0,u.Z)((o=(0,c.Z)(s),(0,g.Z)(i.prototype)),"onRightDblClick",o).call(o,t);var e=s.getCoordinate(t);if(s.isActive){var n=s.findHoveredPoint(e);if(n)return void s.deleteSelectedLinePoint(n.id);s.deleteSelectedLine(e)}},s.setReference=function(t){s.isReference=t},s.pointsWithinRange=function(t){return!(s.lowerLimitPointNum&&t<s.lowerLimitPointNum||s.upperLimitPointNum&&t>s.upperLimitPointNum)},s.setLineList=function(t){var e=t.length!==s.lineListLen;s.lineList=t,e&&s.emit("updatePageNumber")},s.textChange=function(t){!1===s.config.textConfigurable||!s.selectedID||(s.updateSelectedTextAttribute(t),s.emit("selectedChange"))},s.status=2,s.isMousedown=!1,s.lineDragging=!1,s.isLineValid=!0,s.setConfig(t.config),s.prevAxis={x:0,y:0},s.textEditingID="",s.updateSelectedTextAttribute=s.updateSelectedTextAttribute.bind((0,c.Z)(s)),s.getCurrentSelectedData=s.getCurrentSelectedData.bind((0,c.Z)(s)),s.actionsHistory=new ri,s.dependToolConfig={lineType:j.Line},s}return(0,y.Z)(i,[{key:"isLineSelected",get:function(){return this.selectedID&&this.activeLine}},{key:"selectedLinePoints",get:function(){return this.activeLine?this.getPointList(this.activeLine):[]}},{key:"isCreate",get:function(){return 0===this.status}},{key:"isActive",get:function(){return 1===this.status}},{key:"isNone",get:function(){return 2===this.status}},{key:"isCurve",get:function(){return this.config.lineType===j.Curve}},{key:"isMultipleColor",get:function(){return this.config.lineColor===U.MultiColor}},{key:"imageSize",get:function(){return this.rotate%180==0?this.basicImgInfo:{width:this.basicImgInfo.height,height:this.basicImgInfo.width}}},{key:"lineListLen",get:function(){return this.lineList.length}},{key:"edgeAdsorptionEnabled",get:function(){return this.edgeAdsorption&&!this.isCurve&&this.lineListLen>0}},{key:"attributeConfigurable",get:function(){return this.config.attributeConfigurable}},{key:"isTextConfigurable",get:function(){return this.config.textConfigurable}},{key:"isDependPolygon",get:function(){return this.dependToolName===E.Polygon}},{key:"isDependRect",get:function(){return this.dependToolName===E.Rect}},{key:"isCurrentAttributeLocked",get:function(){return this.attributeLockList.includes(this.defaultAttribute)}},{key:"attributeFilteredLines",get:function(){var t=this;return this.attributeLockList.length>0?this.lineList.filter((function(e){return t.attributeLockList.includes((null==e?void 0:e.attribute)||"")})):this.lineList}},{key:"enableOutOfTarget",get:function(){return this.config.enableOutOfTarget}},{key:"showOrder",get:function(){return this.config.showOrder}},{key:"edgeAdsorption",get:function(){return this.config.edgeAdsorption}},{key:"attributeList",get:function(){return this.config.attributeList}},{key:"lowerLimitPointNum",get:function(){return this.config.lowerLimitPointNum}},{key:"upperLimitPointNum",get:function(){return this.config.upperLimitPointNum}},{key:"textCheckType",get:function(){return this.config.textCheckType}},{key:"customFormat",get:function(){return this.config.customFormat}},{key:"dataList",get:function(){return this.lineList}},{key:"hasActiveLine",get:function(){return this.activeLine&&this.activeLine.length>0}},{key:"viewPortLines",get:function(){var t=Oe.getViewPort(this.canvas,this.currentPos,this.zoom);return this.isHidden?[]:this.attributeFilteredLines.filter((function(e){var i;return null==(i=null==e?void 0:e.pointList)?void 0:i.some((function(e){return Oe.inViewPort(e,t)}))}))}},{key:"lineStyle",get:function(){return{lineWidth:this.style.width,color:this.getLineColor(this.defaultAttribute),opacity:this.style.opacity}}},{key:"selectedText",get:function(){var t,e,i=this;return null!=(e=null==(t=this.lineList.find((function(t){return t.id===i.selectedID})))?void 0:t.textAttribute)?e:""}},{key:"currentPageResult",get:function(){return this.lineList}},{key:"updateStatus",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t!==this.status){if(e){var i="";this.textCheckType===Y.Order&&this.isTextConfigurable&&(i=xe.getTextAttribute(this.lineList,this.textCheckType)),this.emit("updateText",i)}this.status=t,this.lineStatusChanged()}}},{key:"isInBasicPolygon",value:function(t){var e,i;return yt(t,(null==(e=this.basicResult)?void 0:e.pointList)||[],null==(i=this.dependToolConfig)?void 0:i.lineType)}},{key:"getPolygonPointList",value:function(){if(!this.basicResult)return[];var t=this.basicResult.pointList;return this.dependToolConfig.lineType===j.Curve?vt(t.reduce((function(t,e){return[].concat((0,b.Z)(t),[e.x,e.y])}),[]),.5,!0,20):t}},{key:"getNextCoordByRenderCoord",value:function(t){return this.getNextCoordByAbsCoord(this.coordUtils.getAbsCoord(t))}},{key:"getNextCoordByAbsCoord",value:function(t){var e,i=null==(e=this.activeLine)?void 0:e.slice(-1)[0];return i?this.coordUtils.getNextCoordByDependTool(t,i):t}},{key:"pointInLine",value:function(t,e,i){var n=this;return!(t.filter((function(t){return t})).length<2)&&t.some((function(r,o){if(0===o)return!1;var s=n.coordUtils.getRenderCoord(t[o-1]),a=n.coordUtils.getRenderCoord(r);return ei.isInLine(e,s,a,i)}))}},{key:"arc",value:function(t){var e,i,n,r,o,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,l=arguments.length>2?arguments[2]:void 0;if(this.ctx){var u=t.x,c=t.y;null==(e=this.ctx)||e.save(),null==(i=this.ctx)||i.beginPath(),this.ctx.fillStyle=l||this.lineStyle.color,null==(n=this.ctx)||n.arc(u,c,a,0,360),null==(r=this.ctx)||r.closePath(),null==(o=this.ctx)||o.fill(),null==(s=this.ctx)||s.restore()}}},{key:"renderActiveArea",value:function(){if(this.isActive&&this.activeArea&&this.ctx){var t=this.activeArea,e=t.top,i=t.left,n=t.right,r=t.bottom,o=this.coordUtils.getRenderCoord({x:i,y:e}),s=o.x,a=o.y;this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="#B3B8FF",this.ctx.rect(s,a,(n-i)*this.zoom,(r-e)*this.zoom),this.ctx.stroke(),this.ctx.restore()}}},{key:"addLinePoint",value:function(t){var e,i,n,r;this.arc(t),null==(e=this.activeLine)||e.push($i(Qi({},t),{id:Vt()})),1===(null==(i=this.activeLine)?void 0:i.length)?null==(n=this.actionsHistory)||n.initRecord(this.activeLine):null==(r=this.actionsHistory)||r.pushHistory(this.activeLine),this.render()}},{key:"setCreatStatusAndAddPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.updateStatus(0,e),this.addLinePoint(t)}},{key:"isActiveLineValid",value:function(){var t,e=this;return this.selectedID?null==(t=this.lineList.find((function(t){return t.id===e.selectedID})))?void 0:t.valid:this.isLineValid}},{key:"nextOrder",value:function(){return 0===this.lineListLen?1:this.lineList.slice(-1)[0].order+1}},{key:"getLineColorByAttribute",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Me.getStrokeAndFill(this.getColor(t.attribute),t.valid,{isSelected:e}).stroke}},{key:"updateActiveArea",value:function(){this.activeArea=this.getActiveArea(),this.renderActiveArea()}},{key:"getActiveArea",value:function(){return this.hasActiveLine?Lt.calcViewportBoundaries(this.activeLine,this.isCurve,tn,this.zoom):void 0}},{key:"drawLineNumber",value:function(t){var e,i,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4?arguments[4]:void 0,l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if((this.showOrder||this.attributeConfigurable)&&this.ctx){var u=this.showOrder?r.toString():"".concat(s);if(this.attributeConfigurable){var c=a?null!=(n=null==(i=null==(e=this.attributeList)?void 0:e.find((function(t){return t.value===a})))?void 0:i.key)?n:a:"";u=[u,"".concat(!l&&c?"无效":"").concat(c)].filter((function(t){return t})).join("_")}this.drawText(t,u,o)}}},{key:"drawLineTextAttribute",value:function(t,e,i){if(t&&i)return this.drawText(t,i,e,200)}},{key:"drawText",value:function(t,e,i,n){var r,o;this.ctx&&(null==(r=this.ctx)||r.save(),this.ctx.font=Q,this.ctx.fillStyle=i,this.ctx.strokeStyle=i,n?Ze.wrapText(this.canvas,e,t.x-en,t.y-nn,n):this.ctx.fillText(e,t.x-en-10,t.y-nn+10),null==(o=this.ctx)||o.restore())}},{key:"moveActiveArea",value:function(t,e){this.activeArea&&(this.activeArea=Object.assign(this.activeArea,{top:this.activeArea.top+e,bottom:this.activeArea.bottom+e,right:this.activeArea.right+t,left:this.activeArea.left+t})),this.activeLine&&(this.activeLine.map((function(i){return Object.assign(i,{x:i.x+t,y:i.y+e})})),this.updateLines())}},{key:"findHoveredPoint",value:function(t){var e=this;if(this.activeLine)return this.activeLine.find((function(i){var n=e.coordUtils.getRenderCoord(i);return ei.calcDistance(n,t)<=5}))}},{key:"findHoverLine",value:function(t){var e=this;return w().cloneDeep(this.lineList).reverse().find((function(i){var n=i.pointList,r=n?e.getPointList(n):[],o=e.getLineWidthScope();return r.some((function(i,n){if(0===n)return!1;var s=e.coordUtils.getRenderCoord(i),a=e.coordUtils.getRenderCoord(r[n-1]);return ei.isInLine(t,s,a,o)}))}))}},{key:"getAdsorptionPoint",value:function(t){var e,i,n=this;return w().cloneDeep(this.lineList).reverse().forEach((function(r){var o=r.pointList;if(r.id!==n.selectedID&&o&&!((null==o?void 0:o.length)<2)){var s=n.findNearestPoint(o,t);if(s){if(0===s.minDistance)return void(e=s.point);(void 0===i||s.minDistance<i)&&(e=s.point,i=s.minDistance)}}})),e}},{key:"findNearestPoint",value:function(t,e){for(var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7,r=n,o=1;o<=t.length-1;o++){var s=this.coordUtils.getRenderCoord(t[o]),a=this.coordUtils.getRenderCoord(t[o-1]),l=Lt.getFootOfPerpendicular(e,s,a),u=l.length,c=l.footPoint,h=ei.calcTwoPointDistance(s,e),d=ei.calcTwoPointDistance(a,e);if(h<=2*n){i=s,n=0;break}if(d<=2*n){i=a,n=0;break}u<n&&(i=c,n=u)}return i?{point:i,minDistance:r}:void 0}},{key:"getPointList",value:function(t){return this.isCurve?ft(t,tn):t}},{key:"moveSelectedLine",value:function(t){var e=(t.x-this.prevAxis.x)/this.zoom,i=(t.y-this.prevAxis.y)/this.zoom;if(this.enableOutOfTarget)return this.lineDragging=!0,void this.moveActiveArea(e,i);if(this.isDependPolygon)this.moveLineInPolygon(e,i);else{var n=[0,this.imageSize.width],r=[0,this.imageSize.height];if(this.isDependRect){var o=this.basicResult,s=o.x,a=o.y;n=[s,s+o.width],r=[a,a+o.height]}this.moveLineInRectRange(e,i,n,r)}}},{key:"moveSelectPoint",value:function(t){if(this.selectedPoint){var e=t.x-this.prevAxis.x,i=t.y-this.prevAxis.y,n={x:(this.selectedPoint?this.selectedPoint.x:0)+e/this.zoom,y:(this.selectedPoint?this.selectedPoint.y:0)+i/this.zoom};Object.assign(this.selectedPoint,this.getNextCoordByAbsCoord(n)),this.updateLines(),this.render()}}},{key:"getCoordByConfig",value:function(t,e){var i,n=!!t.shiftKey,r=t.altKey;if((null==(i=this.activeLine)?void 0:i.length)>0&&n){var o=this.activeLine.slice(-1)[0];return ei.getVHPoint(o,e,this.coordUtils.getAbsCoord(e),this.coordUtils.getRenderCoord(o))}return this.edgeAdsorptionEnabled&&!r?this.getAdsorptionPoint(e):e}},{key:"getNextPoint",value:function(t,e){var i=this.getCoordByConfig(t,e)||e;return this.enableOutOfTarget?i:this.getNextCoordByRenderCoord(i)}},{key:"lineHover",value:function(){this.render()}},{key:"mouseMoveHandler",value:function(t){var e=this.getCoordinate(t),i=1===t.which;if(this.isCreate)this.hasActiveLine&&this.renderNextPoint(t,e);else{if(this.isNone&&(this.lineHover(),this.edgeAdsorptionEnabled&&!t.altKey)){var n=this.getAdsorptionPoint(e);n&&this.arc(n)}if(this.isActive){if(this.isMousedown&&i){if(this.selectedPoint)return void this.moveSelectPoint(e);if(this.coordsInsideActiveArea)return this.moveSelectedLine(e),void this.drawActivatedLine(void 0,void 0,!0)}this.drawHoverPoint(e),this.render()}}}},{key:"onMouseMove",value:function(t){if(!(0,u.Z)((0,g.Z)(i.prototype),"onMouseMove",this).call(this,t)&&!this.forbidMouseOperation&&this.imgInfo){var e=this.getCoordinate(t);this.mouseMoveHandler(t),this.prevAxis=e}}},{key:"setActiveAreaByPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.coordUtils.getRenderCoord(t),n=this.findHoverLine(i);if(n){var r=this.lineList.findIndex((function(t){return t.id===(null==n?void 0:n.id)})),o=Lt.calcViewportBoundaries((null==n?void 0:n.pointList)||[],this.isCurve,tn,this.zoom),s=this.lineList[r];this.updateStatus(1),this.setActiveLine(s.pointList),this.setSelectedLineID(s.id),this.activeArea=o,this.updateLineAttributes(s)}else e&&this.setNoneStatus();this.render()}},{key:"setActiveArea",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.findHoverLine(t);if(i){var n=this.lineList.findIndex((function(t){return t.id===(null==i?void 0:i.id)})),r=Lt.calcViewportBoundaries((null==i?void 0:i.pointList)||[],this.isCurve,tn,this.zoom),o=this.lineList[n];this.updateStatus(1),this.setActiveLine(o.pointList),this.setSelectedLineID(o.id),this.activeArea=r,this.updateLineAttributes(o)}else e&&this.setNoneStatus();this.render()}},{key:"setActiveLineByID",value:function(t){var e=this.lineList.find((function(e){return e.id===t}));if(e){var i=Lt.calcViewportBoundaries((null==e?void 0:e.pointList)||[],this.isCurve,tn,this.zoom);this.updateStatus(1),this.setActiveLine(e.pointList),this.setSelectedLineID(e.id),this.activeArea=i,this.updateLineAttributes(e)}this.render()}},{key:"setActiveLine",value:function(t){this.activeLine=t?w().cloneDeep(t):void 0}},{key:"historyChanged",value:function(t){var e=this,i="".concat(t,"Enabled");if(this.isCreate){if(this.actionsHistory&&this.actionsHistory[i]){var n=this.actionsHistory&&this.actionsHistory[t]();this.setActiveLine(n),this.render()}}else{if(this.history&&this.history[i]){var r=this.history[t](),o=null==r?void 0:r.find((function(t){return t.id===e.selectedID}));this.lineList=r,this.selectedID&&o?this.setActiveLine(null==o?void 0:o.pointList):this.setNoneStatus(),this.render()}this.emit("dataUpdated",this.dataList)}}},{key:"undo",value:function(){this.historyChanged("undo"),this.updateSelectedAttributeAfterHistoryChanged()}},{key:"redo",value:function(){this.historyChanged("redo"),this.updateSelectedAttributeAfterHistoryChanged()}},{key:"isCoordInsideTarget",value:function(t){if(this.isDependPolygon)return this.isInBasicPolygon(t);if(this.isDependRect){var e=this.basicResult,i=e.x,n=e.y,r=[i,i+e.width],o=[n,n+e.height];return Lt.isInRange(t.x,r)&&Lt.isInRange(t.y,o)}return Lt.isInRange(t.x,[0,this.imageSize.width])&&Lt.isInRange(t.y,[0,this.imageSize.height])}},{key:"getPointInsertIndex",value:function(t,e){var i=this;if(t&&this.activeLine){var n=this.getPointList(this.activeLine);return 2===this.activeLine.length?1:this.activeLine.findIndex((function(r,o){if(o>0){var s=i.activeLine?i.activeLine[o-1]:void 0,a=i.isCurve?n.slice(17*(o-1),17*o):[s,r];return i.pointInLine(a,t,e||i.getLineWidthScope())}return!1}))}return-1}},{key:"getLineWidthScope",value:function(){return this.lineStyle.lineWidth}},{key:"isMouseCoordOutsideActiveArea",value:function(){return!this.coordsInsideActiveArea&&!this.selectedPoint}},{key:"isLinePointsExceed",value:function(){return this.isCreate&&this.activeLine&&this.upperLimitPointNum&&~~this.upperLimitPointNum<=this.activeLine.length}},{key:"isLinePointsNotEnough",value:function(){var t;return this.activeLine&&(null==(t=this.activeLine)?void 0:t.length)<this.lowerLimitPointNum}},{key:"updateLineSegmentSpecial",value:function(t){var e=this.getPointInsertIndex(t,2)-1;if(e>-1){var i=this.activeLine[e];i.specialEdge=!i.specialEdge,this.hoverLineSegmentIndex=-1,this.render()}}},{key:"addLinePointToActiveLine",value:function(){var t,e=this.getPointInsertIndex(this.cursor),i=this.pointsWithinRange(this.activeLine.length+1);this.cursor&&e>-1&&i&&(this.activeLine.splice(e,0,$i(Qi({},this.coordUtils.getAbsCoord(this.cursor)),{id:Vt()})),this.updateLines(),null==(t=this.history)||t.pushHistory(this.lineList),this.render(),this.cursor=void 0)}},{key:"onMouseDown",value:function(t){if(!(0,u.Z)((0,g.Z)(i.prototype),"onMouseDown",this).call(this,t)&&!this.forbidMouseOperation&&this.imgInfo){var e=this.getCoordinate(t);this.isMousedown=!0,this.prevAxis=e,3!==t.which?(this.selectedPoint=this.findHoveredPoint(e),this.coordsInsideActiveArea=!(!this.isActive||!this.activeArea)&&ei.inArea(this.activeArea,this.coordUtils.getAbsCoord(e)),this.lineDragging=!1):this.cursor=void 0}}},{key:"lineHasChanged",value:function(){var t=this,e=this.lineList.find((function(e){return e.id===t.selectedID}));return!!e&&JSON.stringify(e.pointList)!==JSON.stringify(this.activeLine)}},{key:"updateLines",value:function(){var t=this,e=this.lineList.find((function(e){return e.id===t.selectedID}));e&&(e.pointList=w().cloneDeep(this.activeLine),this.emit("dataUpdated",this.lineList))}},{key:"onMouseUp",value:function(t){var e=this,n=function(){e.isMousedown=!1,e.hoverPointID=void 0,e.cursor=void 0,e.selectedPoint=void 0};this.hoverPointID=void 0,(0,u.Z)((0,g.Z)(i.prototype),"onMouseUp",this).call(this,t)||this.forbidMouseOperation||!this.imgInfo||(1===t.which&&this.onLeftClick(t),3===t.which&&this.onRightClick(t)),n()}},{key:"isTextValid",value:function(t){return xe.textAttributeValidate(this.textCheckType,this.customFormat,t)}},{key:"createLineData",value:function(){var t=Vt(),e={pointList:w().cloneDeep(this.activeLine),id:t,valid:this.isLineValid,order:this.nextOrder(),isVisible:!0};return e.attribute=this.defaultAttribute,e}},{key:"stopLineCreating",value:function(){var t,e,i,n,r,o=this,s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=!!this.selectedID||!!this.isTextConfigurable;if(s)if(this.selectedID){var l=this.lineList.find((function(t){return t.id===o.selectedID}));r=this.selectedID,l&&(l.pointList=w().cloneWith(this.activeLine),w().isEqual(l.pointList,null==(t=this.history)?void 0:t.pushHistory(this.lineList))||null==(e=this.history)||e.pushHistory(this.lineList))}else if(this.isCreate&&this.activeLine&&this.activeLine.length>1){var u=this.createLineData();r=u.id,this.setLineList([].concat((0,b.Z)(this.lineList),[u])),null==(i=this.history)||i.pushHistory(this.lineList)}a?this.setActiveStatus(r):this.setNoneStatus(),null==(n=this.actionsHistory)||n.empty(),this.emit("dataUpdated",this.lineList),this.render()}},{key:"setActiveStatus",value:function(t){var e=t?this.lineList.find((function(e){return e.id===t})):void 0;if(e){var i=null==e?void 0:e.pointList;this.updateStatus(1),this.setActiveLine(i),this.setSelectedLineID(t)}else this.setNoneStatus()}},{key:"setNoneStatus",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&this.updateStatus(2),this.activeLine=[],this.setSelectedLineID(void 0),this.activeArea=void 0,this.isLineValid=!0,this.cursor=void 0}},{key:"setKeyDownStatus",value:function(t,e){this.isShift=null!=e?e:t.keyCode===ii.Shift}},{key:"continueToEdit",value:function(){var t;this.updateStatus(0),this.cursor=void 0,null==(t=this.actionsHistory)||t.pushHistory(this.activeLine),this.render()}},{key:"setInvalidLineOnCreating",value:function(t){if((!this.selectedID||t.keyCode===ii.Ctrl)&&this.isCreate){var e=!t.ctrlKey;this.selectedID?this.setInvalidLine(this.selectedID,e,!1):this.isLineValid=e}}},{key:"onKeyDown",value:function(t){if((0,u.Z)((0,g.Z)(i.prototype),"onKeyDown",this).call(this,t),this.setKeyDownStatus(t),t.keyCode===ii.Z&&!t.ctrlKey&&this.toggleIsHide(),t.keyCode===ii.Shift&&this.render(),t.keyCode===ii.Tab)return t.preventDefault(),void this.selectToNextLine(t);if(this.isCreate&&this.keyboardEventWhileLineCreating(t),this.config.attributeConfigurable){var e=xe.getAttributeByKeycode(t.keyCode,this.config.attributeList);void 0!==e&&this.setDefaultAttribute(e)}}},{key:"selectToNextLine",value:function(t){var e=Dn.getNextSelectedRectIDByEvent(this.viewPortLines.map((function(t){var e,i,n,r;return $i(Qi({},t),{x:null!=(i=null==(e=t.pointList[0])?void 0:e.x)?i:0,y:null!=(r=null==(n=t.pointList[0])?void 0:n.y)?r:0})})),t,this.selectedID);e&&this.setActiveLineByID(e.id)}},{key:"keyboardEventWhileLineCreating",value:function(t){!this.isCreate||(t.keyCode===ii.Ctrl&&this.setInvalidLineOnCreating(t),[ii.Shift,ii.Alt].includes(t.keyCode)&&this.renderNextPoint(t,this.prevAxis))}},{key:"renderNextPoint",value:function(t,e){var i=this.coordUtils.getRenderCoord(this.getNextPoint(t,e));this.render(i)}},{key:"deleteSelectedLine",value:function(t){var e=Lt.calcViewportBoundaries(this.activeLine,this.isCurve,tn,this.zoom);ei.inArea(e,this.coordUtils.getAbsCoord(t))&&this.deleteLine()}},{key:"deleteSelectedLinePoint",value:function(t){var e;this.pointsWithinRange(this.activeLine.length-1)&&t&&(this.setActiveLine(this.activeLine.filter((function(e){return e.id!==t}))),this.updateLines(),null==(e=this.history)||e.pushHistory(this.lineList)),this.cursor=void 0,this.render()}},{key:"deleteLine",value:function(){var t,e=this;this.lineList=this.lineList.filter((function(t){return t.id!==e.selectedID})),null==(t=this.history)||t.pushHistory(this.lineList),this.setNoneStatus(),this.emit("dataUpdated",this.lineList),this.render()}},{key:"setInvalidLine",value:function(t,e){var i,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.lineList.find((function(e){return e.id===t}));r&&(r.valid=void 0!==e?e:!r.valid,null==(i=this.history)||i.pushHistory(this.lineList),n&&this.render())}},{key:"empty",value:function(){var t,e;this.lineList=[],this.setNoneStatus(),this.selectedPoint=void 0,null==(t=this.actionsHistory)||t.empty(),null==(e=this.history)||e.init(),this.emit("dataUpdated",this.lineList),this.render()}},{key:"setAttribute",value:function(t){var e;this.attributeConfigurable&&(this.defaultAttribute=t,this.setLineAttribute("attribute",t),this.selectedID&&(null==(e=this.history)||e.pushHistory(this.lineList)))}},{key:"setTextAttribute",value:function(t){var e;this.isTextConfigurable&&(this.setLineAttribute("textAttribute",t),null==(e=this.history)||e.applyAttribute(this.selectedID,"textAttribute",t))}},{key:"setLineAttribute",value:function(t,e,i){var n=i||this.selectedID;if(n){var r=this.lineList.find((function(t){return t.id===n}));r&&(r[t]=e)}this.render()}},{key:"updateAttribute",value:function(t){this.emit("updateAttribute",t)}},{key:"updateLineAttributes",value:function(t){var e;if(this.attributeConfigurable&&t){var i=(null==t?void 0:t.attribute)||"";this.defaultAttribute=i,this.updateAttribute(i)}if(this.isTextConfigurable&&t){var n=(null==t?void 0:t.textAttribute)||"";this.updateTextAttribute(n)}null==(e=this.history)||e.updateHistory(this.lineList)}},{key:"lineStatusChanged",value:function(){this.emit("lineStatusChanged",{status:this.status,selectedLineID:this.selectedID})}},{key:"updateTextAttribute",value:function(t){var e=this;if(this.selectedID){var i=this.lineList.find((function(t){return t.id===e.selectedID}));i&&(i.textAttribute=t)}this.emit("updateText",t)}},{key:"saveData",value:function(){this.stopLineCreating(),this.setNoneStatus(),this.render()}},{key:"setTextEditingID",value:function(t){this.textEditingID=t,this.render()}},{key:"setSelectedLineID",value:function(t){var e,i;if(this.selectedID!==t){var n=this.selectedID;t!==n&&n&&(null==(e=this._textAttributeInstance)||e.changeSelected()),t||null==(i=this._textAttributeInstance)||i.clearTextAttribute(),this.selectedID=t,this.emit("selectedChange")}}},{key:"attributeLockListChange",value:function(t){this.attributeLockList=t,this.render()}},{key:"setResult",value:function(t){this.setNoneStatus(),this.setLineList(t),this.render()}},{key:"setConfig",value:function(t){(0,u.Z)((0,g.Z)(i.prototype),"setConfig",this).call(this,t)}},{key:"toggleIsHide",value:function(){this.setIsHidden(!this.isHidden),this.render()}},{key:"clearCanvas",value:function(){(0,u.Z)((0,g.Z)(i.prototype),"clearCanvas",this).call(this)}},{key:"clearResult",value:function(){this.setResult([]),this.setSelectedLineID(void 0),this.render()}},{key:"exportData",value:function(){return[this.lineList,this.basicImgInfo]}},{key:"setDefaultAttribute",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.attributeConfigurable&&(this.defaultAttribute=e,this.setLineAttribute("attribute",e),this.selectedID&&(null==(t=this.history)||t.pushHistory(this.lineList)),this.emit("changeAttributeSidebar"))}},{key:"getCurrentSelectedData",value:function(){var t,e,i=this,n=this.isActiveLineValid(),r=this.defaultAttribute,o=this.getColor(r);return{color:n?null==o?void 0:o.valid.stroke:null==o?void 0:o.invalid.stroke,textAttribute:null!=(e=null==(t=this.lineList.find((function(t){return t.id===i.selectedID})))?void 0:t.textAttribute)?e:""}}},{key:"renderTextAttribute",value:function(){var t,e,i,n,r=this;if(this.ctx&&this.activeLine&&!((null==(t=this.activeLine)?void 0:t.length)<2)&&!this.isCreate){var o=this.isActiveLineValid(),s=this.defaultAttribute,a=this.activeLine[1],l=a.x,u=a.y,c=this.coordUtils.getRenderCoord({x:l,y:u}),h=this.getColor(s),d=o?null==h?void 0:h.valid.stroke:null==h?void 0:h.invalid.stroke,g=null!=(i=null==(e=this.lineList.find((function(t){return t.id===r.selectedID})))?void 0:e.textAttribute)?i:"";this._textAttributeInstance||(this._textAttributeInstance=new Mi({container:this.container,icon:this.getTextIconSvg(s),color:d,getCurrentSelectedData:this.getCurrentSelectedData,updateSelectedTextAttribute:this.updateSelectedTextAttribute})),this._textAttributeInstance&&!(null==(n=this._textAttributeInstance)?void 0:n.isExit)&&this._textAttributeInstance.appendToContainer(),this._textAttributeInstance.update("".concat(g),{left:c.x,top:c.y,color:d}),this._textAttributeInstance.updateIcon(this.getTextIconSvg(s))}}},{key:"getTextIconSvg",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return xe.getTextIconSvg(t,this.config.attributeList,this.config.attributeConfigurable,this.baseIcon)}},{key:"updateSelectedTextAttribute",value:function(t){if(this._textAttributeInstance&&t&&this.selectedID){var e=t;!xe.textAttributeValidate(this.config.textCheckType,this.customFormat,e)&&(this.emit("messageError",xe.getErrorNotice(this.config.textCheckType,this.lang)),e=""),this.setTextAttribute(e),this.emit("updateTextAttribute"),this.render()}}}]),i}(Ii),on=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"getMarkerShowText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return xe.getAttributeShowText(t,e)}}]),t}(),sn=Object.defineProperty,an=Object.defineProperties,ln=Object.getOwnPropertyDescriptors,un=Object.getOwnPropertySymbols,cn=Object.prototype.hasOwnProperty,hn=Object.prototype.propertyIsEnumerable,dn=Math.pow,gn=function(t,e,i){return e in t?sn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},vn=function(t,e){for(var i in e||(e={}))cn.call(e,i)&&gn(t,i,e[i]);if(un){var n,r=S(un(e));try{for(r.s();!(n=r.n()).done;){i=n.value;hn.call(e,i)&&gn(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},fn=function(t,e){return an(t,ln(e))},yn=function(t){(0,h.Z)(i,t);var e=R(i);function i(t){var n;return(0,f.Z)(this,i),(n=e.call(this,t)).setMarkerIndex=function(t){n.markerIndex=t},n.setMarkerIndexAndSelect=function(t){if(n.config.markerList){n.markerIndex=t;var e=n.config.markerList[t].value,i=n.currentPageResult.find((function(t){return t.label===e}));i&&(n.setSelectedID(i.id),!0===n.config.attributeConfigurable&&n.setDefaultAttribute(i.attribute)),n.emit("markIndexChange")}},n.textChange=function(t){!0!==n.config.textConfigurable||!n.selectedID||(n.setPointList(xe.textChange(t,n.selectedID,n.pointList)),n.emit("selectedChange"),n.render())},n.isMinDistance=function(t){var e=Wn.changePointByZoom(t,n.zoom);return n.pointList.some((function(t){var i=Wn.changePointByZoom(t,n.zoom);return Lt.getLineLength(i,e)<.2}))},n.config=Dn.jsonParser(t.config),n.pointList=[],n.markerIndex=0,n.setStyle(t.style),n.createPoint=n.createPoint.bind((0,c.Z)(n)),n.getCurrentSelectedData=n.getCurrentSelectedData.bind((0,c.Z)(n)),n.updateSelectedTextAttribute=n.updateSelectedTextAttribute.bind((0,c.Z)(n)),n.setSelectedID=n.setSelectedID.bind((0,c.Z)(n)),n}return(0,y.Z)(i,[{key:"dataList",get:function(){return this.pointList}},{key:"drawOutsideTarget",get:function(){var t;return null!=(t=this.config.drawOutsideTarget)?t:this.config.drawPointOut}},{key:"setNextMarker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pointList;if(this.hasMarkerConfig){var e=Dn.getNextMarker(this.getCurrentPageResult(t),this.config.markerList);e&&this.setMarkerIndexAndSelect(e.index)}}},{key:"setResult",value:function(t){this.clearActiveStatus(),this.setPointList(t),this.setNextMarker(t),this.render()}},{key:"setPointList",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.pointList.length;this.pointList=t,i!==t.length&&this.emit("updatePageNumber"),e&&this.emit("updateResult")}},{key:"setConfig",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.config=Dn.jsonParser(t),!0===e&&this.clearResult()}},{key:"clearResult",value:function(){this.setPointList([]),this.setSelectedID(void 0),this.history.pushHistory([]),this.hoverID="",this.render()}},{key:"setDefaultAttribute",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.defaultAttribute;if(this.defaultAttribute=t,e!==t){this.changeStyle(t),this.emit("changeAttributeSidebar");var i=this.selectedID;if(i&&(this.pointList.forEach((function(e){e.id===i&&(e.attribute=t)})),this.history.pushHistory(this.pointList),this.render()),this._textAttributInstance){if(this.attributeLockList.length>0&&!this.attributeLockList.includes(t))return void this._textAttributInstance.clearTextAttribute();this._textAttributInstance.updateIcon(this.getTextIconSvg(t))}}}},{key:"selectedText",get:function(){var t,e=this;return null==(t=this.pointList.find((function(t){return t.id===e.selectedID})))?void 0:t.textAttribute}},{key:"setStyle",value:function(t){var e;(0,u.Z)((0,g.Z)(i.prototype),"setStyle",this).call(this,t),this._textAttributInstance&&!1===this.config.attributeConfigurable&&(null==(e=this._textAttributInstance)||e.updateIcon(this.getTextIconSvg()))}},{key:"setSelectedID",value:function(t){var e,i,n=this.selectedID;t!==n&&n&&(null==(e=this._textAttributInstance)||e.changeSelected()),t||null==(i=this._textAttributInstance)||i.clearTextAttribute(),this.selectedID=t,this.render(),this.emit("selectedChange")}},{key:"getTextIconSvg",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return xe.getTextIconSvg(t,this.config.attributeList,this.config.attributeConfigurable,this.baseIcon)}},{key:"clearActiveStatus",value:function(){this.hoverID=void 0,this.dragStatus=Pt.Wait,this.setSelectedID(void 0)}},{key:"setBasicResult",value:function(t){(0,u.Z)((0,g.Z)(i.prototype),"setBasicResult",this).call(this,t),this.setNextMarker(),this.clearActiveStatus()}},{key:"onMouseDown",value:function(t){if(!(0,u.Z)((0,g.Z)(i.prototype),"onMouseDown",this).call(this,t)&&!this.forbidMouseOperation)return 0!==t.button||this.hoverID?(this.hoverID===this.selectedID&&0===t.button&&(this.dragStatus=Pt.Start),this.render(),!0):(this.createPoint(t),void this.render())}},{key:"onMouseMove",value:function(t){(0,u.Z)((0,g.Z)(i.prototype),"onMouseMove",this).call(this,t)||this.forbidMouseOperation||!this.imgInfo||(this.hoverID=this.getHoverId(),(this.dragStatus===Pt.Start||this.dragStatus===Pt.Move)&&this.onDragMove(t),this.hoverID&&this.render())}},{key:"onMouseUp",value:function(t){if((0,u.Z)((0,g.Z)(i.prototype),"onMouseUp",this).call(this,t)||this.forbidMouseOperation||!this.imgInfo)return!0;2===t.button&&this.rightMouseUp(),this.dragStatus===Pt.Move&&this.history.pushHistory(this.pointList),this.dragStatus=Pt.Wait,this.render()}},{key:"onDragMove",value:function(t){var e,i,n=this;if(this.imgInfo){this.dragStatus=Pt.Move;var r=this.getCoordinateUnderZoom(t),o=Wn.changeDrawOutsideTarget(r,{x:0,y:0},this.imgInfo,this.drawOutsideTarget,this.basicResult,this.zoom),s=this.drawOutsideTarget?Wn.getOriginCoordinateWithOffsetCoordinate(this.coord,this.zoom,this.currentPos):Wn.changePointByZoom(o,1/this.zoom);!1===this.drawOutsideTarget&&this.dependToolName===E.Polygon&&(null==(i=null==(e=this.basicResult)?void 0:e.pointList)?void 0:i.length)>0&&!En.isInPolygon(s,this.basicResult.pointList)||(this.pointList.forEach((function(t){t.id===n.selectedID&&(t.x=s.x,t.y=s.y)})),this.render())}}},{key:"onKeyDown",value:function(t){if(Dn.hotkeyFilter(t)&&!1!==(0,u.Z)((0,g.Z)(i.prototype),"onKeyDown",this).call(this,t)){var e=t.keyCode;switch(e){case ii.Delete:this.deletePoint();break;case ii.Tab:this.onTabKeyDown(t);break;case ii.Z:this.setIsHidden(!this.isHidden),this.render();break;default:if(this.config.attributeConfigurable){var n=xe.getAttributeByKeycode(e,this.config.attributeList);void 0!==n&&this.setDefaultAttribute(n)}}}}},{key:"createPoint",value:function(t){var e,i,n,r;if(this.imgInfo){var o=this.config.upperLimit;if(o&&this.currentPageResult.length>=o)this.emit("messageInfo","".concat(ue.getMessagesByLocale(Wt.LowerLimitPoint,this.lang)));else{var s=Dn.getSourceID(this.basicResult),a=this.getCoordinateUnderZoom(t),l=Wn.getOriginCoordinateWithOffsetCoordinate(this.coord,this.zoom,this.currentPos);if(this.config.edgeAdsorption&&this.referenceData&&[E.Polygon,E.Line].includes(null==(e=this.referenceData)?void 0:e.toolName)){var u=(null==(i=this.referenceData)?void 0:i.toolName)===E.Polygon,c=En.getClosestPoint(l,this.referenceData.result,null!=(r=null==(n=this.referenceData.config)?void 0:n.lineType)?r:j.Line,nt/this.zoom,{isClose:u}),h=c.dropFoot;h&&(l=h),c.hasClosed&&this.emit("messageSuccess","".concat(ue.getMessagesByLocale(Wt.SuccessfulEdgeAdsorption,this.lang)))}if(!1===this.drawOutsideTarget){if(this.dependToolName&&this.basicCanvas){var d=!1;switch(this.dependToolName){case E.Rect:d=!Ut.isInRect(l,this.basicResult);break;case E.Polygon:d=!En.isInPolygon(l,this.basicResult.pointList)}if(d)return}if(a.x<0||a.y<0||a.x>this.imgInfo.width||a.y>this.imgInfo.height)return}if(!this.isMinDistance(l)){var g=fn(vn({},l),{isVisible:!0,attribute:this.defaultAttribute,valid:!t.ctrlKey,id:Vt(8,62),sourceID:s,textAttribute:"",order:Dn.getMaxOrder(this.pointList.filter((function(t){return Dn.isSameSourceID(t.sourceID,s)})))+1});if(this.config.textConfigurable){var v;v=xe.getTextAttribute(this.pointList.filter((function(t){return Dn.isSameSourceID(t.sourceID,s)})),this.config.textCheckType),g=fn(vn({},g),{textAttribute:v})}if(this.hasMarkerConfig){var f=Dn.getNextMarker(this.currentPageResult,this.config.markerList,this.markerIndex);if(!f)return void this.emit("messageInfo",ue.getMessagesByLocale(Wt.MarkerFinish,this.lang));g=fn(vn({},g),{label:f.label}),this.markerIndex=f.index,this.emit("markIndexChange")}this.hoverID=g.id;var y=[].concat((0,b.Z)(this.pointList),[g]);this.setPointList(y),this.history.pushHistory(y),this.setSelectedID(g.id)}}}}},{key:"isInPoint",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.zoom;return(this.style.width+2)/i>=Math.sqrt(dn(t.x-e.x,2)+dn(t.y-e.y,2))}},{key:"getHoverId",value:function(){var t,e=this,i=Wn.getOriginCoordinateWithOffsetCoordinate(this.coord,this.zoom,this.currentPos),n=null==(t=this.pointList)?void 0:t.find((function(t){return e.isInPoint(i,t)}));return null==n?void 0:n.id}},{key:"rightMouseUp",value:function(){var t=this;if(this.selectedID===this.hoverID){var e=this.pointList.filter((function(e){return e.id!==t.selectedID}));return this.setPointList(e),this.history.pushHistory(e),this.setSelectedID(""),void(this.hoverID="")}var i=this.pointList.find((function(e){return e.id===t.hoverID}));if(this.setSelectedID(this.hoverID),this.setDefaultAttribute(null==i?void 0:i.attribute),(null==i?void 0:i.label)&&this.hasMarkerConfig){var n=Dn.getCurrentMarkerIndex(i.label,this.config.markerList);n>=0&&(this.setMarkerIndex(n),this.emit("markIndexChange"))}}},{key:"onTabKeyDown",value:function(t){if(t.preventDefault(),this.dragStatus!==Pt.Move&&this.dragStatus!==Pt.Start){var e=Dt.ascend;t.shiftKey&&(e=Dt.descend);var i=Dn.getRenderResultList(this.pointList,Dn.getSourceID(this.basicResult),this.attributeLockList,this.selectedID),n=(0,p.Z)(i,2),r=n[0],o=n[1],s=(0,b.Z)(r);o&&(s=[].concat((0,b.Z)(s),[o]));var a=Dn.getNextSelectedRectID(s,e,this.selectedID);a&&this.setSelectedID(a.id)}}},{key:"currentPageResult",get:function(){var t=Dn.getRenderResultList(this.pointList,Dn.getSourceID(this.basicResult),[]);return(0,p.Z)(t,1)[0]}},{key:"getCurrentPageResult",value:function(t){var e=Dn.getRenderResultList(t,Dn.getSourceID(this.basicResult),[]);return(0,p.Z)(e,1)[0]}},{key:"exportData",value:function(){return[this.pointList,this.basicImgInfo]}},{key:"deletePoint",value:function(){var t,e=this;this.selectedID&&(this.setPointList(this.pointList.filter((function(t){return t.id!==e.selectedID}))),this.history.pushHistory(this.pointList),null==(t=this._textAttributInstance)||t.clearTextAttribute(),this.emit("selectedChange"),this.render())}},{key:"undoAndRedo",value:function(t){var e,i,n=this;if(this.dragStatus!==Pt.Move&&this.dragStatus!==Pt.Start){var r=null==(i=(e=this.history)[t])?void 0:i.call(e);(null==r?void 0:r.some((function(t){return t.id===n.selectedID})))||this.setSelectedID(""),r&&(this.setPointList(r,!0),this.render())}}},{key:"undo",value:function(){this.undoAndRedo("undo")}},{key:"redo",value:function(){this.undoAndRedo("redo")}},{key:"getCurrentSelectedData",value:function(){var t,e=this;if(this.selectedID){var i=null==(t=this.pointList)?void 0:t.find((function(t){return t.id===e.selectedID})),n=this.getColor(null==i?void 0:i.attribute),r=(null==i?void 0:i.valid)?null==n?void 0:n.valid.stroke:null==n?void 0:n.invalid.stroke;return this.dragStatus=Pt.Wait,{width:200*this.zoom*.6,textAttribute:(null==i?void 0:i.textAttribute)||"",color:r}}}},{key:"updateSelectedTextAttribute",value:function(t){if(this._textAttributInstance&&t&&this.selectedID){var e=t;!1===xe.textAttributeValidate(this.config.textCheckType,"",e)&&(this.emit("messageError",xe.getErrorNotice(this.config.textCheckType,this.lang)),e=""),this.setPointList(xe.textChange(e,this.selectedID,this.pointList)),this.emit("updateTextAttribute"),this.render()}}},{key:"renderTextAttribute",value:function(){var t,e,i=this,n=null==(t=this.pointList)?void 0:t.find((function(t){return t.id===i.selectedID}));if(this.ctx&&!0===this.config.textConfigurable&&n){var r=n.x,o=n.y,s=n.attribute,a=n.valid,l=200*this.zoom*.6,u=Wn.getOffsetCoordinate({x:r,y:o},this.currentPos,this.zoom),c=this.getColor(s),h=a?null==c?void 0:c.valid.stroke:null==c?void 0:c.invalid.stroke;this._textAttributInstance||(this._textAttributInstance=new Mi({width:l,container:this.container,icon:this.getTextIconSvg(s),color:h,getCurrentSelectedData:this.getCurrentSelectedData,updateSelectedTextAttribute:this.updateSelectedTextAttribute})),this._textAttributInstance&&!(null==(e=this._textAttributInstance)?void 0:e.isExit)&&this._textAttributInstance.appendToContainer(),this._textAttributInstance.update("".concat(n.textAttribute),{left:u.x,top:u.y+4,color:h,width:l})}}},{key:"renderPoint",value:function(t){var e,i,n;if(t.isVisible){var r=t.textAttribute,o=void 0===r?"":r,s=t.attribute,a=t.id===this.selectedID,l=this.getColor(s),u=Wn.changePointByZoom(t,this.zoom,this.currentPos),c=this.style,h=c.width,d=void 0===h?2:h,g=c.hiddenText,v=void 0!==g&&g,f=Me.getStrokeAndFill(l,t.valid,{isSelected:a||t.id===this.hoverID});Ze.drawCircle(this.canvas,u,d,{startAngleDeg:0,endAngleDeg:360,thickness:1,color:f.stroke,fill:"transparent"});var y="";((null==(e=this.config)?void 0:e.isShowOrder)||(null==(i=this.config)?void 0:i.showOrder))&&t.order&&(null==t?void 0:t.order)>0&&(y="".concat(t.order)),t.label&&this.hasMarkerConfig&&(y="".concat(Dn.getCurrentMarkerIndex(t.label,this.config.markerList)+1,"_").concat(on.getMarkerShowText(t.label,this.config.markerList))),t.attribute&&(y="".concat(y,"  ").concat(xe.getAttributeShowText(t.attribute,null==(n=this.config)?void 0:n.attributeList))),v||Ze.drawText(this.canvas,{x:u.x+d/2,y:u.y-d-4},y,{textAlign:"center",color:f.stroke}),a?this.renderTextAttribute():v||Ze.drawText(this.canvas,{x:u.x+d,y:u.y+d+24},o,vn({color:f.stroke},Tt))}}},{key:"renderPointList",value:function(){var t=this,e=Dn.getRenderResultList(this.pointList,Dn.getSourceID(this.basicResult),this.attributeLockList,this.selectedID),i=(0,p.Z)(e,2),n=i[0],r=i[1];this.container.dispatchEvent(this.saveDataEvent),this.isHidden||n.forEach((function(e){t.renderPoint(e)})),r&&this.renderPoint(r)}},{key:"renderTop",value:function(){var t,e,i,n=this.getLineColor(this.defaultAttribute);if(this.renderCursorLine(n),this.config.edgeAdsorption&&this.referenceData){var r=Wn.getOriginCoordinateWithOffsetCoordinate(this.coord,this.zoom,this.currentPos),o=(null==(t=this.referenceData)?void 0:t.toolName)===E.Polygon,s=En.getClosestPoint(r,this.referenceData.result,null!=(i=null==(e=this.referenceData.config)?void 0:e.lineType)?i:j.Line,nt/this.zoom,{isClose:o}).dropFoot;s&&r!==s&&r!==s&&(r=s,Ze.drawCircle(this.canvas,Wn.changePointByZoom(r,this.zoom,this.currentPos),5,{color:"white",fill:"white"}),Ze.drawCircle(this.canvas,Wn.changePointByZoom(r,this.zoom,this.currentPos),3,{fill:n,color:n}))}}},{key:"render",value:function(){!this.ctx||!this.renderReady||((0,u.Z)((0,g.Z)(i.prototype),"render",this).call(this),this.renderPointList(),this.renderTop())}}]),i}(Ii),pn=function(t){(0,h.Z)(i,t);var e=R(i);function i(t){var n;return(0,f.Z)(this,i),(n=e.call(this,t)).getSingleResult=function(t){var e={};return n.config.configList.length>0&&n.config.configList.forEach((function(t){var i;e[t.key]=null!=(i=t.default)?i:""})),{value:e,id:Vt(),sourceID:null!=t?t:Dn.getSourceID()}},n.getInitResultList=function(t,e){return t>0?e.map((function(t){return n.getSingleResult(t.id)})):[n.getSingleResult()]},n.textList=[],n.setShowDefaultCursor(!0),n.setConfig(t.config),n.initTextDisplayContainer(),n}return(0,y.Z)(i,[{key:"dataList",get:function(){return this.textList}},{key:"textValueContainerID",get:function(){return"textValueContainer"}},{key:"textValueContainer",get:function(){return document.getElementById(this.textValueContainerID)}},{key:"currentPageResult",get:function(){return this.textList}},{key:"setResult",value:function(t){var e,i=this;this.textList=t,this.toggleTextContainerVisible(!0);var n=null==(e=this.textList[0])?void 0:e.value;n&&Object.keys(n).forEach((function(t){i.renderText(t,n[t])})),this.emit("valueUpdated"),this.toggleTextContainerVisible(!!n)}},{key:"updateTextValue",value:function(t,e){this.textList[0].value[t]=e,this.renderText(t,e),this.emit("valueUpdated")}},{key:"renderText",value:function(t,e){var i=document.getElementById("textKey".concat(t));i&&(i.innerText=e)}},{key:"getTextDomID",value:function(t){return"textKey".concat(t)}},{key:"initTextDisplayContainer",value:function(){var t=this,e=document.createElement("div"),i={position:"absolute",right:"0",top:"0","z-index":"20","max-width":"20%","font-family":"SourceHanSansCN-Regular",background:"rgb(102, 230, 255)",color:"white","word-break":"break-all","line-height":"24px","white-space":"pre-wrap","max-height":"80%","overflow-y":"auto",opacity:"0.6"};e.setAttribute("style",Object.keys(i).reduce((function(t,e){return t+="".concat(e,": ").concat(i[e],";")}),"")),e.setAttribute("id",this.textValueContainerID),this.config.configList.forEach((function(i){var n=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div");n.setAttribute("style","padding: 8px 16px"),r.innerText="".concat(i.key,":"),o.innerText="",o.setAttribute("id",t.getTextDomID(i.key)),n.appendChild(r),n.appendChild(o),e.appendChild(n)})),this.container.appendChild(e)}},{key:"exportData",value:function(){return[this.textList,this.basicImgInfo]}},{key:"destroyCanvas",value:function(){(0,u.Z)((0,g.Z)(i.prototype),"destroyCanvas",this).call(this),this.textValueContainer&&this.container.removeChild(this.textValueContainer)}},{key:"onKeyDown",value:function(t){(0,u.Z)((0,g.Z)(i.prototype),"onKeyDown",this).call(this,t),t.keyCode===ii.Z&&this.toggleTextContainerVisible()}},{key:"toggleTextContainerVisible",value:function(t){if(this.textValueContainer){var e=(void 0!==t?t:"block"!==this.textValueContainer.style.display)?"block":"none";this.textValueContainer.style.display=e}}}]),i}(Ii),bn=Object.defineProperty,xn=Object.defineProperties,mn=Object.getOwnPropertyDescriptors,kn=Object.getOwnPropertySymbols,Ln=Object.prototype.hasOwnProperty,In=Object.prototype.propertyIsEnumerable,wn=function(t,e,i){return e in t?bn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},Pn=function(t,e){for(var i in e||(e={}))Ln.call(e,i)&&wn(t,i,e[i]);if(kn){var n,r=S(kn(e));try{for(r.s();!(n=r.n()).done;){i=n.value;In.call(e,i)&&wn(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},Cn=function(t,e){return xn(t,mn(e))},Dn=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"getStepInfo",value:function(t,e){return null==e?void 0:e.filter((function(e){return e.step===t}))[0]}},{key:"getCurrentStepInfo",value:function(t,e){var i=this.getStepInfo(t,e);return!i||i.type!==It.QUALITY_INSPECTION&&i.type!==It.MANUAL_CORRECTION?i:this.getCurrentStepInfo(i.dataSourceStep,e)}},{key:"getMaxOrder",value:function(t){var e=0;return t.forEach((function(t){t.order&&t.order>e&&(e=t.order)})),e}},{key:"hotkeyFilter",value:function(t){var e=t.target||t.srcElement;if(!e)return!0;var i=e.tagName,n=e.type;if(!i||!n)return!0;var r=!0;return(e.isContentEditable||"TEXTAREA"===i||("INPUT"===i&&"radio"!==n||"TEXTAREA"===i)&&!e.readOnly)&&(r=!1),r}},{key:"getCurrentOperation",value:function(t){switch(t){case E.Rect:case E.RectTrack:return ir;case E.Tag:return Vi;case E.Polygon:return Ui;case N.Check:return Zi;case E.Line:return rn;case E.Point:return yn;case E.Text:return pn;default:throw new Error("not match tool")}}},{key:"getNextSelectedRectID",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dt.ascend,i=arguments.length>2?arguments[2]:void 0,n=1;e===Dt.descend&&(n=-1);var r=t.sort((function(t,e){return t.x-e.x==0?t.y-e.y:n*(t.x-e.x)})),o=r.findIndex((function(t){return t.id===i})),s=r.length;return r[(o+1)%s]}},{key:"getNextSelectedRectIDByEvent",value:function(t,e,i){var n=e.shiftKey?Dt.descend:Dt.ascend;return this.getNextSelectedRectID(t,n,i)}},{key:"getRenderResultList",value:function(t,e){var i,n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0;return[t.filter((function(t){return o&&o===(null==t?void 0:t.id)?(i=t,!1):!(r.length>0&&!r.includes(null==t?void 0:t.attribute)||n.isDifferSourceID(null==t?void 0:t.sourceID,e))})),i]}},{key:"getSourceID",value:function(t){var e;return t&&null!=(e=null==t?void 0:t.id)?e:""}},{key:"findAllLine",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[],n=(0,b.Z)(t);n.length>=3&&!0===e&&n.push(Pn({},n[0]));for(var r=0;r<n.length;r++)n[r+1]&&i.push({point1:n[r],point2:n[r+1],pointIndex:r});return i}},{key:"translateSourceID",value:function(t){return(void 0===t||0===t||"0"===t)&&(t=""),t}},{key:"isDifferSourceID",value:function(t,e){return t=this.translateSourceID(t),e=this.translateSourceID(e),"".concat(t)!="".concat(e)}},{key:"isSameSourceID",value:function(t,e){return t=this.translateSourceID(t),e=this.translateSourceID(e),"".concat(t)=="".concat(e)}},{key:"getNextMarker",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0;if(0!==(null==e?void 0:e.length)){var n=e.map((function(t,e){return Cn(Pn({},t),{index:e})}));if("number"==typeof i&&i>0){var r=e[i];if(r&&t.every((function(t){return t.label!==r.value})))return{label:r.value,index:i};n=[].concat((0,b.Z)(n.slice(i,e.length)),(0,b.Z)(n.slice(0,i)))}for(var o=function(e){if(!t.some((function(t){return t.label===n[e].value})))return{v:{label:n[e].value,index:n[e].index}}},s=0;s<n.length;s++){var a=o(s);if("object"==typeof a)return a.v}}}},{key:"getCurrentMarkerIndex",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.findIndex((function(e){return t===e.value}))}}]),t}();Dn.jsonParser=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return"string"==typeof t?JSON.parse(t):(0,I.isObject)(t)?t:e}catch(i){return e}};var An,Rn=Object.defineProperty,Sn=Object.getOwnPropertySymbols,Tn=Object.prototype.hasOwnProperty,Zn=Object.prototype.propertyIsEnumerable,Mn=function(t,e,i){return e in t?Rn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},On=function(t,e){for(var i in e||(e={}))Tn.call(e,i)&&Mn(t,i,e[i]);if(Sn){var n,r=S(Sn(e));try{for(r.s();!(n=r.n()).done;){i=n.value;Zn.call(e,i)&&Mn(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},En=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"getHoverPolygonID",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:j.Line,o="",s=1/0,a=Wn.axisArea(t,n);return e.forEach((function(t){t.pointList&&a.forEach((function(e){var n=i.calcPolygonSize(t.pointList);i.isInPolygon(e,t.pointList,r)&&n<s&&(o=t.id,s=n)}))})),o}},{key:"calcPolygonSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if((null==t?void 0:t.length)<=2)return 0;var e=t.length,i=t.reduce((function(t,i,n,r){var o=r[(n+1)%e];return t+i.x*o.y-o.x*i.y}),0);return Math.abs(i)/2}},{key:"isInPolygon",value:function(t,e){var i,n,r,o,s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.Line,l=0;e=(0,b.Z)(e),a===j.Curve&&(e=this.createSmoothCurvePoints(e.reduce((function(t,e){return[].concat((0,b.Z)(t),[e.x,e.y])}),[]),.5,!0,20)),i=e,o=(0,p.Z)(i,1)[0];var u=e.length;for(n=1;n<=u;n++)s=e[n%u],t.x>Math.min(o.x,s.x)&&t.x<=Math.max(o.x,s.x)&&t.y<=Math.max(o.y,s.y)&&o.x!==s.x&&(r=(t.x-o.x)*(s.y-o.y)/(s.x-o.x)+o.y,(o.y===s.y||t.y<=r)&&l++),o=s;return l%2!=0}},{key:"createSmoothCurvePointsFromPointList",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:it;return this.createSmoothCurvePoints(t.reduce((function(t,e){return[].concat((0,b.Z)(t),[e.x,e.y])}),[]),.5,!1,e).map((function(e,i){var n,r=i/17,o=Math.floor(r),s=null!=(n=t[o])?n:{};return On(o===r?On({},s):{specialEdge:s.specialEdge},e)}))}},{key:"createSmoothCurvePoints",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:it;if(t.length<4)return t;var r,o,s,a,l,u,c,h,d,g,v,f,y,p=[],b=t.slice(0);for(i?(b.unshift(t[t.length-1]),b.unshift(t[t.length-2]),b.unshift(t[t.length-1]),b.unshift(t[t.length-2]),b.push(t[0]),b.push(t[1])):(b.unshift(t[1]),b.unshift(t[0]),b.push(t[t.length-2]),b.push(t[t.length-1])),y=2;y<b.length-4;y+=2)for(s=(b[y+2]-b[y-2])*e,a=(b[y+4]-b[y-0])*e,l=(b[y+3]-b[y-1])*e,u=(b[y+5]-b[y+1])*e,f=0;f<=n;f++)v=f/n,c=2*Math.pow(v,3)-3*Math.pow(v,2)+1,h=-2*Math.pow(v,3)+3*Math.pow(v,2),d=Math.pow(v,3)-2*Math.pow(v,2)+v,g=Math.pow(v,3)-Math.pow(v,2),r=c*b[y]+h*b[y+2]+d*s+g*a,o=c*b[y+1]+h*b[y+3]+d*l+g*u,p.push(r),p.push(o);for(var x=[],m=0;m<p.length-1;m+=2)x.push({x:p[m],y:p[m+1]});if(i)for(var k=0;k<n+1;k++){var L=x.shift();x.push(L)}return x}},{key:"getPolygonByID",value:function(t,e){return t.find((function(t){return t.id===e}))}},{key:"getHoverEdgeIndex",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.Line,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,r=(0,b.Z)(e);i===j.Curve?r=this.createSmoothCurvePoints(e.reduce((function(t,e){return[].concat((0,b.Z)(t),[e.x,e.y])}),[]),.5,!0,it):i===j.Line&&r.push(r[0]);for(var o=-1,s=n,a=0;a<r.length-1;a++){var l=Lt.getFootOfPerpendicular(t,r[a],r[a+1]),u=l.length;u<s&&(o=a,s=u)}return-1===o?-1:i===j.Curve?Math.floor(o/it):o}},{key:"getClosestPoint",value:function(t,e){var i,n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.Line,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,s=arguments.length>4?arguments[4]:void 0,a=!1,l=null==(i=null==s?void 0:s.isClose)||i,u="",c=-1,h=1/0,d=t,g=20,v=!1;return e.forEach((function(e){if(!v&&e.pointList)switch(r){case j.Line:Dn.findAllLine(e.pointList,l).forEach((function(i,n){if(!v){var r=Lt.getFootOfPerpendicular(t,i.point1,i.point2),s=r.length,l=r.footPoint,g=Lt.getLineLength(i.point1,t),f=Lt.getLineLength(i.point2,t);g<2*o&&(l=i.point1,s=g,v=!0),f<2*o&&(l=i.point2,s=f,v=!0),s<h&&s<o&&(u=e.id,c=n,h=s,d=l,a=!0)}}));break;case j.Curve:for(var i=n.createSmoothCurvePoints(e.pointList.reduce((function(t,e){return[].concat((0,b.Z)(t),[e.x,e.y])}),[]),.5,l,g),s=0;s<i.length-1;s++){var f=Lt.getFootOfPerpendicular(t,i[s],i[s+1]),y=f.length,p=f.footPoint;y<h&&y<o&&(u=e.id,c=Math.floor(s/(g+1)),h=y,d=p,a=!0)}}})),{dropFoot:d,closestEdgeIndex:c,closestPolygonID:u,hasClosed:a}}},{key:"isPointListInPolygon",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.Line;return t.every((function(t){return i.isInPolygon(t,e,n)}))}},{key:"isPointListOutSidePolygon",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.Line;return t.some((function(t){return!i.isInPolygon(t,e,n)}))}},{key:"getPolygonArea",value:function(t){for(var e=0,i=0,n=t.length;i<n;i++){e+=t[i].x*t[i===t.length-1?0:i+1].y*.5,e-=t[i===t.length-1?0:i+1].x*t[i].y*.5}return Math.abs(e)}},{key:"updatePolygonByRotate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0,n=1;return t===St.Anticlockwise&&(n=-1),n*=e,Lt.rotateRectPointList(n,i)}},{key:"deletePolygonLastPoint",value:function(t,e,i,n){return i===n.length-1?t:[].concat((0,b.Z)(t),[{x:e[0],y:e[1]}])}},{key:"concatBeginAndEnd",value:function(t){return t.length<1?t:[].concat((0,b.Z)(t),[t[0]])}},{key:"segmentPolygonByPolygon",value:function(e,i){var n,r;try{var o=(0,L.polygon)([(0,b.Z)(t.concatBeginAndEnd(e.map((function(t){return[t.x,t.y]}))))]);return i.forEach((function(e){var i=(0,L.polygon)([(0,b.Z)(t.concatBeginAndEnd(e.pointList.map((function(t){return[t.x,t.y]}))))]),n=(0,L.difference)(o,i);n&&(o=n)})),(null!=(r=null==(n=null==o?void 0:o.geometry)?void 0:n.coordinates.map((function(e){var i;return"MultiPolygon"===(null==(i=null==o?void 0:o.geometry)?void 0:i.type)?e[0].reduce(t.deletePolygonLastPoint,[]):e.reduce(t.deletePolygonLastPoint,[])})))?r:[]).reduce((function(t,e){var i=e.length,n=e.filter((function(t,n){var r=(n+1)%i;return!Wn.getIsInScope(t,e[r],1)}));return n.length<3?t:[].concat((0,b.Z)(t),[n])}),[])}catch(o){console.error(o)}}},{key:"getPolygonPointList",value:function(t,e){var i=e.find((function(e){return e.id===t}));return i&&i.pointList&&i.pointList.length>0?i.pointList:[]}},{key:"getWrapPolygonIndex",value:function(e,i){return i.findIndex((function(i){return t.isPointListInPolygon(e,i.pointList)}))}},{key:"clipPolygonFromWrapPolygon",value:function(e,i){var n=t.isPolygonClosewise(i),r=t.isPolygonClosewise(e),o=t.getClosePointDistanceFromPolygon(e[0],i),s=i[o],a=[].concat((0,b.Z)(i.slice(0,o)),[s],(0,b.Z)(e),[e[0]],(0,b.Z)(i.slice(o,i.length)));return n===r&&(a=[].concat((0,b.Z)(i.slice(0,o)),[s,e[0]],(0,b.Z)(e.reverse()),(0,b.Z)(i.slice(o,i.length)))),a}},{key:"isPolygonClosewise",value:function(t){var e,i,n,r,o=t.length,s=0;if(o<3)return 0;for(e=0;e<o;e++)n=(e+2)%o,r=(t[i=(e+1)%o].x-t[e].x)*(t[n].y-t[i].y),(r-=(t[i].y-t[e].y)*(t[n].x-t[i].x))<0?s--:r>0&&s++;return s>0?1:s<0?-1:0}},{key:"getClosePointDistanceFromPolygon",value:function(t,e){var i=Number.MAX_SAFE_INTEGER,n=-1;return e.forEach((function(e,r){var o=ei.calcDistance(t,e);o<i&&(i=o,n=r)})),n}},{key:"combinePolygonWithPolygon",value:function(e,i){var n,r;try{var o=(0,L.polygon)([(0,b.Z)(t.concatBeginAndEnd(e.pointList.map((function(t){return[t.x,t.y]}))))]),s=(0,L.polygon)([(0,b.Z)(t.concatBeginAndEnd(i.pointList.map((function(t){return[t.x,t.y]}))))]),a=(0,L.union)(o,s),l=[],u=e;if(1===(null==(r=null==(n=null==a?void 0:a.geometry)?void 0:n.coordinates)?void 0:r.length)){l.push(i.id);var c=null==a?void 0:a.geometry.coordinates.map((function(e){var i;return"MultiPolygon"===(null==(i=null==a?void 0:a.geometry)?void 0:i.type)?e[0].reduce(t.deletePolygonLastPoint,[]):e.reduce(t.deletePolygonLastPoint,[])}))[0];u.pointList=c}return{newPolygon:u,unionList:l}}catch(o){console.error(o)}}}]),t}(),Nn=Object.defineProperty,Hn=Object.defineProperties,Bn=Object.getOwnPropertyDescriptors,_n=Object.getOwnPropertySymbols,zn=Object.prototype.hasOwnProperty,Fn=Object.prototype.propertyIsEnumerable,jn=function(t,e,i){return e in t?Nn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},Un=function(t,e){for(var i in e||(e={}))zn.call(e,i)&&jn(t,i,e[i]);if(_n){var n,r=S(_n(e));try{for(r.s();!(n=r.n()).done;){i=n.value;Fn.call(e,i)&&jn(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},Vn=function(t,e){return Hn(t,Bn(e))},Wn=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"getOffsetCoordinate",value:function(t,e,i){return{x:t.x*i+e.x,y:t.y*i+e.y}}},{key:"changeDrawOutsideTarget",value:function(t,e,i,n,r,o){return"boolean"==typeof n&&!n&&(r&&o?(t.x-e.x>(r.x+r.width)*o&&(t.x=(r.x+r.width)*o+e.x),t.x-e.x<r.x*o&&(t.x=r.x*o+e.x),t.y-e.y>(r.y+r.height)*o&&(t.y=(r.y+r.height)*o+e.y),t.y-e.y<r.y*o&&(t.y=r.y*o+e.y)):(t.x-e.x>i.width&&(t.x=i.width+e.x),t.x-e.x<0&&(t.x=e.x),t.y-e.y>i.height&&(t.y=i.height+e.y),t.y-e.y<0&&(t.y=e.y))),t}},{key:"changeCoordinateByRotate",value:function(t,e,i){var n=i.width,r=i.height,o=t.x,s=t.y;switch(e%360){case 90:return{x:r-s,y:o};case 180:return{x:n-o,y:r-s};case 270:return{x:s,y:n-o};default:return t}}},{key:"changeRectByZoom",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};return Vn(Un({},t),{x:t.x*e+i.x,y:t.y*e+i.y,width:t.width*e,height:t.height*e})}},{key:"changePointByZoom",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};return Vn(Un({},t),{x:t.x*e+i.x,y:t.y*e+i.y})}},{key:"changePointListByZoom",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};return t.map((function(t){return i.changePointByZoom(t,e,n)}))}},{key:"axisArea",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=t.x,n=t.y,r=[],o=i-e;o<i+e;o+=e/3)for(var s=n-e;s<n+e;s+=e/3)r.push({x:o,y:s});return r}},{key:"getOriginCoordinateWithOffsetCoordinate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};return{x:(t.x-i.x)/e,y:(t.y-i.y)/e}}},{key:"returnClosePointIndex",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=-1,r=0;r<e.length;r++){var o=e[r];this.getIsInScope(t,o,i)&&(n=r)}return n}},{key:"getIsInScope",value:function(t,e,i){return Math.abs(t.x-e.x)<i&&Math.abs(t.y-e.y)<i}}]),t}(),Kn=function(){function t(e){(0,f.Z)(this,t),this.currentPos=e.currentPos,this.zoom=e.zoom,this.basicImgInfo=e.basicImgInfo,this.dependToolName=""}return(0,y.Z)(t,[{key:"isDependPolygon",get:function(){return this.dependToolName===E.Polygon}},{key:"isDependRect",get:function(){return this.dependToolName===E.Rect}},{key:"isDependOriginalImage",get:function(){return""===this.dependToolName}},{key:"getAbsCoord",value:function(t){return{x:(t.x-this.currentPos.x)/this.zoom,y:(t.y-this.currentPos.y)/this.zoom}}},{key:"getRenderCoord",value:function(t){return{x:t.x*this.zoom+this.currentPos.x,y:t.y*this.zoom+this.currentPos.y}}},{key:"coordInsideRect",value:function(t,e){var i=e.x,n=e.y,r=e.width,o=e.height;return{x:Lt.withinRange(t.x,[i,i+r]),y:Lt.withinRange(t.y,[n,n+o])}}},{key:"getPolygonPointList",value:function(t,e){return t===j.Curve?En.createSmoothCurvePointsFromPointList(e):e}},{key:"getIntersection",value:function(t,e,i){var n=this.getRenderCoord(e),r={pointA:n,pointB:this.getRenderCoord(t)};return ei.calcOptimalIntersection(i,r,n,3,this.zoom)}},{key:"coordInsidePolygon",value:function(t,e,i,n){var r=this,o=i.pointList,s=null==n?void 0:n.lineType;if(0===o.length)return t;var a=this.getPolygonPointList(s,o);if(En.isInPolygon(t,a))return t;var l=a.concat(a[0]).map((function(t){return r.getRenderCoord(t)})),u=this.getIntersection(t,e,l);return u?this.getAbsCoord(null==u?void 0:u.point):t}},{key:"coordInsideImage",value:function(t){return this.coordInsideRect(t,Vn(Un({},this.basicImgInfo),{x:0,y:0}))}},{key:"getNextCoordByDependTool",value:function(t,e){return this.isDependRect?this.coordInsideRect(t,this.basicResult):this.isDependPolygon?this.coordInsidePolygon(t,e,this.basicResult,this.dependToolConfig):this.isDependOriginalImage?this.coordInsideImage(t):void 0}},{key:"setDependInfo",value:function(t,e){this.dependToolName=null!=t?t:"",this.dependToolConfig=t?e:void 0}},{key:"setBasicImgInfo",value:function(t){this.basicImgInfo=t}},{key:"setBasicResult",value:function(t){this.basicResult=t}},{key:"setZoomAndCurrentPos",value:function(t,e){this.zoom=t,this.currentPos=e}},{key:"isCoordInsideTarget",value:function(t){if(this.isDependPolygon)return this.isInBasicPolygon(t);if(this.isDependRect){var e=this.basicResult,i=e.x,n=e.y,r=[i,i+e.width],o=[n,n+e.height];return Lt.isInRange(t.x,r)&&Lt.isInRange(t.y,o)}return Lt.isInRange(t.x,[0,this.basicImgInfo.width])&&Lt.isInRange(t.y,[0,this.basicImgInfo.height])}},{key:"isInBasicPolygon",value:function(t){var e,i;return En.isInPolygon(t,(null==(e=this.basicResult)?void 0:e.pointList)||[],null==(i=this.dependToolConfig)?void 0:i.lineType)}}]),t}(),Xn=Object.defineProperty,Gn=Object.defineProperties,Yn=Object.getOwnPropertyDescriptors,Jn=Object.getOwnPropertySymbols,qn=Object.prototype.hasOwnProperty,Qn=Object.prototype.propertyIsEnumerable,$n=function(t,e,i){return e in t?Xn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},tr=function(t,e){for(var i in e||(e={}))qn.call(e,i)&&$n(t,i,e[i]);if(Jn){var n,r=S(Jn(e));try{for(r.s();!(n=r.n()).done;){i=n.value;Qn.call(e,i)&&$n(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},er=function(t,e){return Gn(t,Yn(e))},ir=function(t){(0,h.Z)(i,t);var e=R(i);function i(t){var n;return(0,f.Z)(this,i),(n=e.call(this,t)).setMarkerIndex=function(t){n.markerIndex=t},n.setMarkerIndexAndSelect=function(t){if(n.config.markerList){n.markerIndex=t;var e=n.config.markerList[t].value,i=n.currentPageResult.find((function(t){return t.label===e}));i&&(n.setSelectedID(i.id),!0===n.config.attributeConfigurable&&n.setDefaultAttribute(i.attribute)),n.emit("markIndexChange")}},n.getHoverRectID=function(t){var e=n.getCoordinateUnderZoom(t),i=(0,c.Z)(n).currentShowList;if(i.length>0){if(n.selectedRectID){var r=(0,c.Z)(n).selectedRect;if(r&&Ut.isInRect(e,r,6,n.zoom))return r.id}var o=i.filter((function(t){return Ut.isInRect(e,t,6,n.zoom)}));if(0===o.length)return"";if(1===o.length)return o[0].id;if(o.length>1)return o.map((function(t){return{size:t.width*t.height,id:t.id}})).sort((function(t,e){return t.size-e.size}))[0].id}return""},n.textChange=function(t){!0!==n.config.textConfigurable||!n.selectedRectID||(n.setRectList(xe.textChange(t,n.selectedRectID,n.rectList),!0),n.emit("selectedChange"),n.render())},n.drawOutSideTarget=t.drawOutSideTarget||!1,n.rectList=[],n.isFlow=!0,n.config=Dn.jsonParser(t.config),n.hoverRectEdgeIndex=-1,n.hoverRectPointIndex=-1,n.markerIndex=0,n.setStyle(t.style),n.createNewDrawingRect=n.createNewDrawingRect.bind((0,c.Z)(n)),n.getDrawingRectWithRectList=n.getDrawingRectWithRectList.bind((0,c.Z)(n)),n.setSelectedIdAfterAddingDrawingRect=n.setSelectedIdAfterAddingDrawingRect.bind((0,c.Z)(n)),n.getCurrentSelectedData=n.getCurrentSelectedData.bind((0,c.Z)(n)),n.updateSelectedRectTextAttribute=n.updateSelectedRectTextAttribute.bind((0,c.Z)(n)),n.setSelectedID=n.setSelectedID.bind((0,c.Z)(n)),n}return(0,y.Z)(i,[{key:"setResult",value:function(t){if(this.clearActiveStatus(),this.setRectList(t),this.hasMarkerConfig){var e=Dn.getNextMarker(this.getCurrentPageResult(t),this.config.markerList);e&&this.setMarkerIndex(e.index)}this.render()}},{key:"destroy",value:function(){(0,u.Z)((0,g.Z)(i.prototype),"destroy",this).call(this),this._textAttributInstance&&this._textAttributInstance.clearTextAttribute()}},{key:"setConfig",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.config=t,!0===e&&this.clearResult(!1)}},{key:"setRectList",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.rectList.length;this.rectList=t,i!==t.length&&this.emit("updatePageNumber"),e&&this.emit("updateResult")}},{key:"selectedRect",get:function(){var t=this;return this.rectList.find((function(e){return e.id===t.selectedRectID}))}},{key:"selectedID",get:function(){return this.selectedRectID}},{key:"selectedText",get:function(){var t;return null==(t=this.selectedRect)?void 0:t.textAttribute}},{key:"dataList",get:function(){return this.rectList}},{key:"currentShowList",get:function(){var t=[],e=Dn.getRenderResultList(this.rectList,Dn.getSourceID(this.basicResult),this.attributeLockList,this.selectedID),i=(0,p.Z)(e,2),n=i[0],r=i[1];return t=n,this.isHidden&&(t=[]),r&&t.push(r),t}},{key:"currentPageResult",get:function(){var t=Dn.getRenderResultList(this.rectList,Dn.getSourceID(this.basicResult),[]);return(0,p.Z)(t,1)[0]}},{key:"getCurrentPageResult",value:function(t){var e=Dn.getRenderResultList(t,Dn.getSourceID(this.basicResult),[]);return(0,p.Z)(e,1)[0]}},{key:"setSelectedID",value:function(t){this.setSelectedRectID(t)}},{key:"setSelectedRectID",value:function(t){var e,i,n=this.selectedRectID;t!==n&&n&&(null==(e=this._textAttributInstance)||e.changeSelected()),t||null==(i=this._textAttributInstance)||i.clearTextAttribute(),this.selectedRectID=t,this.render(),this.emit("selectedChange")}},{key:"setStyle",value:function(t){var e;(0,u.Z)((0,g.Z)(i.prototype),"setStyle",this).call(this,t),this._textAttributInstance&&!1===this.config.attributeConfigurable&&(null==(e=this._textAttributInstance)||e.updateIcon(this.getTextIconSvg()))}},{key:"updateSelectedRectTextAttribute",value:function(t){var e=this;if(this._textAttributInstance&&t){var i=t;!1===xe.textAttributeValidate(this.config.textCheckType,"",i)&&(this.emit("messageError",xe.getErrorNotice(this.config.textCheckType,this.lang)),i=""),this.setRectList(this.rectList.map((function(t){return t.id===e.selectedRectID?er(tr({},t),{textAttribute:i}):t})),!0),this.emit("updateTextAttribute"),this.render()}}},{key:"getHoverRectPointIndex",value:function(t){return this.selectedRect?Wn.returnClosePointIndex(this.getCoordinateUnderZoom(t),Ut.getRectPointList(this.selectedRect,this.zoom),8):-1}},{key:"getHoverRectEdgeIndex",value:function(t){if(!this.selectedRect)return-1;for(var e=-1,i=this.selectedRect,n=Ut.getRectEdgeList(i,this.zoom),r=this.getCoordinateUnderZoom(t),o=0;o<n.length;o++){var s=n[o];Lt.getFootOfPerpendicular(r,s.begin,s.end).length<16&&(e=o)}return e}},{key:"getTextIconSvg",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return xe.getTextIconSvg(t,this.config.attributeList,this.config.attributeConfigurable,this.baseIcon)}},{key:"onMouseDown",value:function(t){var e=this;if(!(0,u.Z)((0,g.Z)(i.prototype),"onMouseDown",this).call(this,t)&&!this.forbidMouseOperation&&!0!==t.ctrlKey){var n=this.getCoordinateUnderZoom(t),r=this.getHoverRectID(t),o=this.currentShowList.find((function(t){return t.id===e.selectedRectID}));if(o&&2!==t.button&&(0!==t.button||!0!==this.isSpaceKey)){if(this.selectedRectID){if(this.getHoverRectPointIndex(t)>-1){var s=W.Point;return this.dragInfo={dragStartCoord:n,dragTarget:s,startTime:+new Date,firstRect:o},void(this.dragStatus=Pt.Start)}if(this.getHoverRectEdgeIndex(t)>-1){var a=W.Line;return this.dragInfo={dragStartCoord:n,dragTarget:a,startTime:+new Date,firstRect:o},void(this.dragStatus=Pt.Start)}}if(r===this.selectedRectID&&!this.drawingRect){var l=W.Plane;this.dragInfo={dragStartCoord:n,dragTarget:l,firstRect:o,startTime:+new Date},this.dragStatus=Pt.Start}}}}},{key:"onDragMove",value:function(t){var e,i,n,r,o,s,a=this;if(this.dragInfo){this.dragStatus=Pt.Move;var l=Ut.getRectUnderZoom(this.dragInfo.firstRect,this.zoom),u=l.x,c=l.y,h=l.width,d=l.height,g=t.x-this.dragInfo.dragStartCoord.x,v=t.y-this.dragInfo.dragStartCoord.y,f=this.rectList.filter((function(t){return t.id===a.selectedRectID}))[0];switch(this.dragInfo.dragTarget){case W.Plane:f=er(tr({},f),{x:u+g,y:c+v,width:h,height:d});break;case W.Point:var y=u,p=c,b=h,x=d;switch(this.hoverRectPointIndex){case 0:y=h-g<0?u+h:u+g,p=d-v<0?c+d:c+v,b=Math.abs(g-h),x=Math.abs(v-d);break;case 1:y=h+g>0?u:u+h+g,p=d-v<0?c+d:c+v,b=Math.abs(h+g),x=Math.abs(d-v);break;case 2:y=h+g>0?u:u+h+g,p=d+v>0?c:c+d+v,b=Math.abs(h+g),x=d+v>0?d+v:Math.abs(d+v);break;case 3:y=h-g<0?u+h:u+g,p=d+v>0?c:c+d+v,b=Math.abs(g-h),x=d+v>0?d+v:Math.abs(d+v);break;default:return}f=er(tr({},f),{x:y,y:p,width:b,height:x});break;case W.Line:var m=u,k=c,L=h,I=d;switch(this.hoverRectEdgeIndex){case 0:k=d-v<0?c+d:c+v,I=Math.abs(v-d);break;case 1:m=h+g>0?u:u+h+g,L=Math.abs(h+g);break;case 2:k=d+v>0?c:c+d+v,I=d+v>0?d+v:Math.abs(d+v);break;case 3:m=h-g<0?u+h:u+g,L=Math.abs(g-h);break;default:return}f=er(tr({},f),{x:m,y:k,width:L,height:I});break;default:return}if(!1===this.config.drawOutsideTarget)if(this.basicResult){if((null==(i=null==(e=this.basicResult)?void 0:e.pointList)?void 0:i.length)>0&&Ut.isRectNotInPolygon(f,pt(this.basicResult.pointList,this.zoom)))return;var w=this.basicResult.x*this.zoom,P=this.basicResult.y*this.zoom,C=this.basicResult.width*this.zoom,D=this.basicResult.height*this.zoom;if(this.dragInfo.dragTarget!==W.Plane&&(f.x<w-.01||f.y<P-.01||f.width>w+C-f.x+.01||f.height>P+D-f.y+.01))return;if(f.x<w&&(f.x=w),f.y<P&&(f.y=P),f.width>w+C-f.x)switch(this.dragInfo.dragTarget){case W.Plane:f.x=w+C-h;break;case W.Point:case W.Line:g>0&&v>0&&(f.width=w+C-f.x);break;default:return}if(f.height>P+D-f.y&&this.dragInfo.dragTarget===W.Plane)f.y=P+D-d}else if(f.x<0&&(f.x=0),f.y<0&&(f.y=0),this.imgInfo)if(this.dragInfo.dragTarget===W.Plane)f.x+f.width>(null==(n=this.imgInfo)?void 0:n.width)&&(f.x=this.imgInfo.width-h),f.y+f.height>(null==(r=this.imgInfo)?void 0:r.height)&&(f.y=this.imgInfo.height-d);else if(f.x+f.width>(null==(o=this.imgInfo)?void 0:o.width)+.01||f.y+f.height>(null==(s=this.imgInfo)?void 0:s.height)+.01)return;this.setRectList(this.rectList.map((function(t){return t.id===f.id?Ut.getRectUnderZoom(f,1/a.zoom):t}))),this.render()}}},{key:"onMouseMove",value:function(t){var e,n;if(!(0,u.Z)((0,g.Z)(i.prototype),"onMouseMove",this).call(this,t)&&!this.forbidMouseOperation&&this.imgInfo){var r=this.getCoordinateUnderZoom(t),o=Wn.changeDrawOutsideTarget(r,{x:0,y:0},this.imgInfo,this.config.drawOutsideTarget,this.basicResult,this.zoom);if(this.selectedRectID&&this.dragInfo)this.onDragMove(o);else{if(this.selectedRectID){var s=this.getHoverRectPointIndex(t);if(s!==this.hoverRectPointIndex)return this.hoverRectPointIndex=s,this.hoverRectEdgeIndex=-1,void this.render();if(-1===this.hoverRectPointIndex){var a=this.getHoverRectEdgeIndex(t);if(a!==this.hoverRectEdgeIndex)return this.hoverRectEdgeIndex=a,void this.render()}}var l=this.getHoverRectID(t),c=this.hoverRectID;if(this.hoverRectID=l,l!==c&&this.render(),this.drawingRect&&this.firstClickCoord){var h=this.firstClickCoord,d=h.x,v=h.y,f=this.drawingRect,y=f.width,p=f.height;if(y=Math.abs(d-o.x),p=Math.abs(v-o.y),o.x<d&&(d=o.x),o.y<v&&(v=o.y),!1===this.config.drawOutsideTarget){if((null==(n=null==(e=this.basicResult)?void 0:e.pointList)?void 0:n.length)>0&&Ut.isRectNotInPolygon(er(tr({},this.drawingRect),{x:d,y:v,width:y,height:p}),pt(this.basicResult.pointList,this.zoom)))return;o.x<0&&(y=Math.abs(this.firstClickCoord.x),d=0),o.y<0&&(p=Math.abs(this.firstClickCoord.y),v=0),this.imgInfo&&(d+y>this.imgInfo.width&&(y=Math.abs(this.imgInfo.width-d)),v+p>this.imgInfo.height&&(p=Math.abs(this.imgInfo.height-v)))}this.drawingRect=er(tr({},this.drawingRect),{x:d,y:v,width:y,height:p}),this.render()}}}}},{key:"setAttributeLockList",value:function(t){this.setSelectedRectID(void 0),(0,u.Z)((0,g.Z)(i.prototype),"setAttributeLockList",this).call(this,t)}},{key:"setBasicResult",value:function(t){(0,u.Z)((0,g.Z)(i.prototype),"setBasicResult",this).call(this,t),this.clearActiveStatus()}},{key:"setRectValidAndRender",value:function(t){!t||(this.setRectList(this.rectList.map((function(e){return e.id===t?er(tr({},e),{valid:!e.valid}):e})),!0),this.render(),this.emit("updateResult"))}},{key:"createNewDrawingRect",value:function(t,e){if(this.imgInfo){var i=this.getCoordinateUnderZoom(t),n=Wn.changeDrawOutsideTarget(i,{x:0,y:0},this.imgInfo,this.config.drawOutsideTarget,this.basicResult,this.zoom);if(this.setSelectedRectID(""),this.hoverRectID="",this.drawOutSideTarget&&(n.x<0&&(n.x=0),n.y<0&&(n.y=0)),this.drawingRect=er(tr({},n),{width:0,height:0,attribute:this.defaultAttribute,valid:!t.ctrlKey,isVisible:!0,id:Vt(8,62),sourceID:e,textAttribute:""}),this.hasMarkerConfig){var r=Dn.getNextMarker(this.currentPageResult,this.config.markerList,this.markerIndex);if(!r)return this.emit("messageInfo",ue.getMessagesByLocale(Wt.MarkerFinish,this.lang)),void(this.drawingRect=void 0);this.drawingRect&&(this.drawingRect=er(tr({},this.drawingRect),{label:r.label})),this.markerIndex=r.index,this.emit("markIndexChange")}if(this.config.textConfigurable){var o;o=xe.getTextAttribute(this.rectList.filter((function(t){return Dn.isSameSourceID(t.sourceID,e)})),this.config.textCheckType),this.drawingRect&&(this.drawingRect=er(tr({},this.drawingRect),{textAttribute:o}))}if(Object.assign(this.drawingRect,{order:Dn.getMaxOrder(this.rectList.filter((function(t){return Dn.isSameSourceID(t.sourceID,e)})))+1}),this.firstClickCoord=tr({},n),this.firstCurrentPos=tr({},this.currentPos),this.dataInjectionAtCreation){var s=this.dataInjectionAtCreation(this.drawingRect);s&&Object.assign(this.drawingRect,s)}}}},{key:"addDrawingRectToRectList",value:function(){if(this.drawingRect){var t=this.drawingRect,e=t.width,i=t.height;if(e/=this.zoom,i/=this.zoom,Math.round(e)<this.config.minWidth||Math.round(i)<this.config.minHeight)return this.emit("messageInfo",ue.getMessagesByLocale(Wt.RectErrorSizeNotice,this.lang)),this.drawingRect=void 0,this.firstClickCoord=void 0,this.dragInfo=void 0,this.dragStatus=Pt.Wait,void this.render();var n=this.getDrawingRectWithRectList();this.setRectList(n,!0),this.history.pushHistory(this.rectList),this.setSelectedIdAfterAddingDrawingRect(),this.firstClickCoord=void 0,this.drawingRect=void 0,this.dragInfo=void 0,this.dragStatus=Pt.Wait}}},{key:"setSelectedIdAfterAddingDrawingRect",value:function(){!this.drawingRect||(this.config.textConfigurable?this.setSelectedRectID(this.drawingRect.id):this.setSelectedRectID())}},{key:"getDrawingRectWithRectList",value:function(){if(!this.drawingRect)return this.rectList;var t=this.drawingRect,e=t.x,i=t.y,n=t.width,r=t.height;return e/=this.zoom,i/=this.zoom,n/=this.zoom,r/=this.zoom,[].concat((0,b.Z)(this.rectList),[er(tr({},this.drawingRect),{x:e,y:i,width:n,height:r})])}},{key:"rightMouseUp",value:function(t){var e=this.getHoverRectID(t),i=this.rectList.find((function(t){return t.id===e})),n=this.selectedRectID;if(this.setSelectedRectID(void 0),i&&this.setDefaultAttribute(i.attribute),this.drawingRect)this.drawingRect=void 0,this.firstClickCoord=void 0;else if(n!==e&&this.dblClickListener.clearRightDblClick(),this.setSelectedRectID(e),this.hoverRectID="",(null==i?void 0:i.label)&&this.hasMarkerConfig){var r=Dn.getCurrentMarkerIndex(i.label,this.config.markerList);r>=0&&(this.setMarkerIndex(r),this.emit("markIndexChange"))}this.render()}},{key:"shiftRightMouseUp",value:function(t){var e=this.getHoverRectID(t);this.emit("shiftRightMouseUp",e)}},{key:"onMouseUp",value:function(t){if((0,u.Z)((0,g.Z)(i.prototype),"onMouseUp",this).call(this,t)||this.forbidMouseOperation||!this.imgInfo)return!0;if(this.dragInfo&&this.dragStatus===Pt.Move)return this.dragInfo=void 0,this.dragStatus=Pt.Wait,this.history.pushHistory(this.rectList),void this.emit("updateResult");if(2!==t.button||!0!==t.shiftKey)if(2!==t.button){var e=Dn.getSourceID(this.basicResult);this.drawingRect?this.addDrawingRectToRectList():!0===t.ctrlKey&&0===t.button&&this.hoverRectID?this.setRectValidAndRender(this.hoverRectID):(this.createNewDrawingRect(t,e),this.render())}else this.rightMouseUp(t);else this.shiftRightMouseUp(t)}},{key:"onRightDblClick",value:function(t){(0,u.Z)((0,g.Z)(i.prototype),"onRightDblClick",this).call(this,t);var e=this.getHoverRectID(t);this.selectedRectID&&this.selectedRectID===e&&this.deleteRect(e)}},{key:"onKeyDown",value:function(t){if(Dn.hotkeyFilter(t)&&!1!==(0,u.Z)((0,g.Z)(i.prototype),"onKeyDown",this).call(this,t)){var e=t.keyCode;switch(e){case ii.Ctrl:this.drawingRect&&(this.drawingRect=er(tr({},this.drawingRect),{valid:!t.ctrlKey}),this.render());break;case ii.F:this.selectedRectID&&this.setRectValidAndRender(this.selectedRectID);break;case ii.Z:this.setIsHidden(!this.isHidden),this.render();break;case ii.Delete:this.deleteRect(this.selectedRectID);break;case ii.Tab:if(t.preventDefault(),this.drawingRect)return;var n=Dt.ascend;t.shiftKey&&(n=Dt.descend);var r=Dn.getRenderResultList(this.rectList,Dn.getSourceID(this.basicResult),this.attributeLockList,this.selectedRectID),o=(0,p.Z)(r,2),s=o[0],a=o[1],l=(0,b.Z)(s);a&&(l=[].concat((0,b.Z)(l),[a]));var c=Oe.getViewPort(this.canvas,this.currentPos,this.zoom);l=l.filter((function(t){return Oe.inViewPort({x:t.x,y:t.y},c)}));var h=Dn.getNextSelectedRectID(l,n,this.selectedRectID);h&&(this.setSelectedRectID(h.id),!0===this.config.attributeConfigurable&&this.setDefaultAttribute(h.attribute));break;default:if(this.config.attributeConfigurable){var d=xe.getAttributeByKeycode(e,this.config.attributeList);void 0!==d&&this.setDefaultAttribute(d)}}return!0}}},{key:"onKeyUp",value:function(t){if((0,u.Z)((0,g.Z)(i.prototype),"onKeyUp",this).call(this,t),t.keyCode===ii.Ctrl)this.drawingRect&&(this.drawingRect=er(tr({},this.drawingRect),{valid:!0}),this.render())}},{key:"onWheel",value:function(t){var e,n,r=this.zoom;this.drawingRect&&this.firstClickCoord&&(e=Ut.getRectUnderZoom(this.drawingRect,1/r),n=Wn.changePointByZoom(this.firstClickCoord,1/r)),(0,u.Z)((0,g.Z)(i.prototype),"onWheel",this).call(this,t,!1),e&&n&&(this.drawingRect=Ut.getRectUnderZoom(e,this.zoom),this.firstClickCoord=Wn.changePointByZoom(n,this.zoom)),this.render()}},{key:"getCurrentSelectedData",value:function(){var t=this.selectedRect;if(t){var e=this.getColor(t.attribute),i=t.valid?null==e?void 0:e.valid.stroke:null==e?void 0:e.invalid.stroke;return{width:t.width*this.zoom*.6,textAttribute:t.textAttribute,color:i}}}},{key:"getRenderStyle",value:function(t){var e,i,n=this.getColor(t.attribute);return!1===t.valid?(e=null==n?void 0:n.invalid.stroke,i=null==n?void 0:n.invalid.fill):(e=null==n?void 0:n.valid.stroke,i=null==n?void 0:n.valid.fill),{strokeColor:e,fillColor:i,textColor:e,toolColor:n}}},{key:"renderTextAttribute",value:function(){var t,e=this.selectedRect;if(this.ctx&&!0===this.config.textConfigurable&&e){var i=e.x,n=e.y,r=e.width,o=e.height,s=e.attribute,a=e.valid,l=r*this.zoom*.6,u=Wn.getOffsetCoordinate({x:i,y:n+o},this.currentPos,this.zoom),c=this.getColor(s),h=a?null==c?void 0:c.valid.stroke:null==c?void 0:c.invalid.stroke;this._textAttributInstance||(this._textAttributInstance=new Mi({width:l,container:this.container,icon:this.getTextIconSvg(s),color:h,getCurrentSelectedData:this.getCurrentSelectedData,updateSelectedTextAttribute:this.updateSelectedRectTextAttribute})),this._textAttributInstance&&!(null==(t=this._textAttributInstance)?void 0:t.isExit)&&this._textAttributInstance.appendToContainer(),this._textAttributInstance.update("".concat(e.textAttribute),{left:u.x,top:u.y+4,color:h,width:l})}}},{key:"renderSelectedRect",value:function(t){var e=this,i=this.selectedRect;if(this.ctx&&t&&i){var n=this.ctx,r=10,o=Ut.getRectPointList(i),s=o.length,a=this.getColor(t.attribute);o.forEach((function(i,l){var u,c;if(n.save(),n.moveTo(i.x,i.y),n.beginPath(),r=e.hoverRectPointIndex===l?12:6,!1===t.valid?(n.strokeStyle=null==a?void 0:a.invalid.stroke,n.fillStyle=null==a?void 0:a.invalid.stroke):(n.strokeStyle=null==a?void 0:a.valid.stroke,n.fillStyle=null==a?void 0:a.valid.stroke),n.arc(i.x*e.zoom+e.currentPos.x,i.y*e.zoom+e.currentPos.y,r,0,2*Math.PI),n.fill(),e.hoverRectEdgeIndex===l){n.beginPath(),n.lineWidth=10;var h=e.getColor(t.attribute),d=!1===t.valid?null==(u=null==h?void 0:h.invalid)?void 0:u.stroke:null==(c=null==h?void 0:h.valid)?void 0:c.stroke;n.strokeStyle=d,n.moveTo(o[l].x*e.zoom+e.currentPos.x,o[l].y*e.zoom+e.currentPos.y),n.lineTo(o[(l+1)%s].x*e.zoom+e.currentPos.x,o[(l+1)%s].y*e.zoom+e.currentPos.y),n.stroke()}n.restore()})),this.renderTextAttribute()}}},{key:"renderDrawingRect",value:function(t){var e,i,n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.ctx&&t){var a=this.ctx,l=this.style,u=l.hiddenText,c=void 0!==u&&u;a.save();var h=this.getRenderStyle(t),d=h.strokeColor,g=h.fillColor,v=h.textColor;a.font="lighter 14px Arial";var f="";(null==(e=this.config)?void 0:e.isShowOrder)&&t.order&&(null==t?void 0:t.order)>0&&(f="".concat(t.order)),t.label&&this.hasMarkerConfig&&(f="".concat(Dn.getCurrentMarkerIndex(t.label,this.config.markerList)+1,"_").concat(on.getMarkerShowText(t.label,this.config.markerList))),t.attribute&&(f="".concat(f,"  ").concat(xe.getAttributeShowText(t.attribute,null==(i=this.config)?void 0:i.attributeList)));var y=Wn.changeRectByZoom(t,s?o:this.zoom,this.currentPos);c||Ze.drawText(this.canvas,{x:y.x,y:y.y-5},f,{color:d,textMaxWidth:300});var p=null!=(r=null==(n=this.style)?void 0:n.width)?r:2;(t.id===this.hoverRectID||t.id===this.selectedRectID)&&Ze.drawRectWithFill(this.canvas,y,{color:g}),Ze.drawRect(this.canvas,y,{color:d,thickness:p,hiddenText:!0}),a.restore();var b="".concat(Math.round(t.width)," * ").concat(Math.round(t.height));!0===s&&(b="".concat(Math.round(t.width/this.zoom)," * ").concat(Math.round(y.height/this.zoom)));var x=7*b.length;if(!c&&t.textAttribute&&t.id!==this.selectedRectID){var m=0,k=Math.max(20,y.width-x);Ze.drawText(this.canvas,{x:y.x,y:y.y+y.height+20+m},t.textAttribute,{color:v,textMaxWidth:k})}}}},{key:"renderStaticRect",value:function(){var t,e=this;if((null==(t=this.rectList)?void 0:t.length)>0&&JSON.stringify(this.rectList)){var i=this.renderEnhance,n=void 0===i?{}:i,r=Dn.getRenderResultList(this.rectList,Dn.getSourceID(this.basicResult),this.attributeLockList,this.selectedRectID),o=(0,p.Z)(r,2),s=o[0],a=o[1];this.isHidden||null==s||s.forEach((function(t){t.isVisible&&(e.renderDrawingRect(t),n.staticRender&&n.staticRender(e.canvas,Wn.changeRectByZoom(t,e.zoom,e.currentPos),e.getRenderStyle(t)))})),a&&(this.renderDrawingRect(a),this.renderSelectedRect(a),n.selectedRender&&n.selectedRender(this.canvas,Wn.changeRectByZoom(a,this.zoom,this.currentPos),this.getRenderStyle(a)))}}},{key:"renderCreatingRect",value:function(){if(this.drawingRect){var t=this.renderEnhance,e=void 0===t?{}:t;this.renderDrawingRect(this.drawingRect,1,!0),e.creatingRender&&e.creatingRender(this.canvas,Wn.changeRectByZoom(this.drawingRect,1,this.currentPos),this.getRenderStyle(this.drawingRect))}}},{key:"renderRect",value:function(){this.container.dispatchEvent(this.saveDataEvent),this.renderStaticRect(),this.renderCreatingRect()}},{key:"render",value:function(){!this.ctx||!this.renderReady||((0,u.Z)((0,g.Z)(i.prototype),"render",this).call(this),this.renderRect(),this.renderCursorLine(this.getLineColor(this.defaultAttribute)))}},{key:"setDefaultAttribute",value:function(t){var e=this,i=this.defaultAttribute;if((this.defaultAttribute=null!=t?t:"",i!==t)&&(this.changeStyle(t),this.emit("changeAttributeSidebar"),this.selectedRect&&(this.setRectList(this.rectList.map((function(t){return t.id===e.selectedID?er(tr({},t),{attribute:e.defaultAttribute}):t})),!0),this.history.pushHistory(this.rectList),this.render()),this.drawingRect&&(this.drawingRect=er(tr({},this.drawingRect),{attribute:this.defaultAttribute}),this.render()),this._textAttributInstance)){if(this.attributeLockList.length>0&&!this.attributeLockList.includes(this.defaultAttribute))return void this._textAttributInstance.clearTextAttribute();this._textAttributInstance.updateIcon(this.getTextIconSvg(t))}}},{key:"setValid",value:function(t){(0,u.Z)((0,g.Z)(i.prototype),"setValid",this).call(this,t),this.emit("updateResult")}},{key:"clearActiveStatus",value:function(){this.drawingRect=void 0,this.firstClickCoord=void 0,this.dragInfo=void 0,this.dragStatus=Pt.Wait,this.setSelectedRectID(void 0)}},{key:"clearResult",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.rectList.filter((function(t){return!0===t.disableDelete}));e.length>0&&t&&this.emit("messageInfo",ue.getMessagesByLocale(Wt.ClearPartialData,this.lang)),this.setRectList(e,!0),this.setSelectedRectID(void 0)}},{key:"deleteRect",value:function(t){var e;if(t){var i=this.rectList.find((function(e){return e.id===t}));!0!==(null==i?void 0:i.disableDelete)?(this.setRectList(this.rectList.filter((function(e){return e.id!==t})),!0),this.history.pushHistory(this.rectList),this.setSelectedRectID(void 0),null==(e=this._textAttributInstance)||e.clearTextAttribute(),this.render()):this.emit("messageInfo",ue.getMessagesByLocale(Wt.DisableDelete,this.lang))}}},{key:"exportData",value:function(){return[this.rectList,this.basicImgInfo]}},{key:"undo",value:function(){var t=this.history.undo();t&&(t.length!==this.rectList.length&&this.setSelectedRectID(""),this.setRectList(t,!0),this.render())}},{key:"redo",value:function(){var t=this.history.redo();t&&(t.length!==this.rectList.length&&this.setSelectedRectID(""),this.setRectList(t,!0),this.render())}}]),i}(Ii),nr=(Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,function(){function t(e){(0,f.Z)(this,t),this._domMap=new Map,this._container=e.container,this._height=e.height}return(0,y.Z)(t,[{key:"wheelChange",value:function(t){t.stopPropagation()}},{key:"clearTag",value:function(t){var e,i=this._container;"undefined"!=typeof window&&(e=window.self.document.getElementById(t)),e&&i&&i.contains(e)&&(e.removeEventListener("wheel",this.wheelChange),null==i||i.removeChild(e))}},{key:"render",value:function(t){var e=this,i=Array.from(this._domMap.keys()),n=t.map((function(t){return t.id}));t.forEach((function(t){var i=t.text,n=t.textMaxWidth,r=t.color,o=void 0===r?"white":r,s=t.background,a=void 0===s?"rgba(0, 0, 0, 0.6)":s,l=t.style;if(e._domMap.has(t.id)){var u=e._domMap.get(t.id);u&&(u.innerHTML=i)}else{var c=Ze.drawTagByDom(e._container,i,t.id);c&&(c.setAttribute("style","\n              position: absolute;\n              top: 0;\n              right: 0;\n              z-index: 20;\n              padding: 8px 20px;\n              font-size: 15px;\n              max-width: ".concat(n,"px;\n              color: ").concat(o,";\n              text-align: left;\n              line-height: 32px;\n              word-break: break-all;\n              white-space: pre-wrap;\n              background: ").concat(a,";\n              opacity: 0.9;\n              max-height: ").concat(.8*e._height,"px;\n              overflow-y: scroll;\n              clear: both;\n              ").concat(Me.getStyle2String(l),"\n            ")),c.addEventListener("wheel",e.wheelChange),e._domMap.set(t.id,c))}})),i.forEach((function(t){-1===n.indexOf(t)&&(e.clearTag(t),e._domMap.delete(t))}))}}]),t}()),rr=Object.defineProperty,or=Object.defineProperties,sr=Object.getOwnPropertyDescriptors,ar=Object.getOwnPropertySymbols,lr=Object.prototype.hasOwnProperty,ur=Object.prototype.propertyIsEnumerable,cr=function(t,e,i){return e in t?rr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},hr=function(t,e){for(var i in e||(e={}))lr.call(e,i)&&cr(t,i,e[i]);if(ar){var n,r=S(ar(e));try{for(r.s();!(n=r.n()).done;){i=n.value;ur.call(e,i)&&cr(t,i,e[i])}}catch(o){r.e(o)}finally{r.f()}}return t},dr=function(t,e){return or(t,sr(e))},gr="#6371FF",vr=function(t){(0,h.Z)(i,t);var e=R(i);function i(t){var n,r;return(0,f.Z)(this,i),(n=e.call(this,dr(hr({},t),{showDefaultCursor:!0}))).style={},n.annotations=[],n.getHoverRectID=function(t){var e,i,r=n.getCoordinateUnderZoom(t),o=Wn.changePointByZoom(r,1/n.zoom);if(!((null==(e=n.annotations)?void 0:e.length)<=0)&&(null==(i=n.annotations)?void 0:i.length)){for(var s="",a=Number.MAX_SAFE_INTEGER,l=0;l<n.annotations.length;l++){var u=n.annotations[l];switch(u.type){case"rect":var c=u.annotation;if(Ut.isInRect(r,c,3,n.zoom)){var h=c.width*c.height;h<a&&(s=c.id,a=h)}break;case"polygon":var d=u.annotation;if(En.isInPolygon(o,d.pointList)){var g=En.getPolygonArea(d.pointList);g<a&&(s=d.id,a=g)}}}return s}},n.style=null!=(r=t.style)?r:{stroke:gr,thickness:3},n.annotations=t.annotations,n.loading=!1,n.renderDomInstance=new nr({container:n.container,height:n.canvas.height}),n}return(0,y.Z)(i,[{key:"setLoading",value:function(t){this.loading=t,this.render()}},{key:"onMouseLeave",value:function(){(0,u.Z)((0,g.Z)(i.prototype),"onMouseLeave",this).call(this),this.mouseHoverID=void 0,this.emit("onChange","hover",[])}},{key:"onMouseDown",value:function(t){if((0,u.Z)((0,g.Z)(i.prototype),"onMouseDown",this).call(this,t)||this.forbidMouseOperation||!this.imgInfo)return!0;var e=this.mouseHoverID;if(0===t.button){var n=[];e&&(n=[e]),this.emit("onChange","selected",n),this.render()}}},{key:"onMouseMove",value:function(t){if(!(0,u.Z)((0,g.Z)(i.prototype),"onMouseMove",this).call(this,t)&&!this.forbidMouseOperation&&this.imgInfo){var e=this.mouseHoverID,n=this.getHoverRectID(t);if(e!==n){this.mouseHoverID=n;var r=[];n&&(r=[n]),this.emit("onChange","hover",r),this.render()}}}},{key:"updateData",value:function(t){this.annotations=t,this.render()}},{key:"getSpecificStyle",value:function(t){var e=w().pick(t,["stroke","thickness","fill","radius"]),i=hr(hr({},this.style),e);return i.stroke&&Object.assign(i,{color:i.stroke}),i}},{key:"getRenderText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i="",n="";return t&&!0!==e?((null==t?void 0:t.order)&&(i="".concat(t.order)),(null==t?void 0:t.label)&&(i=i?"".concat(i,"_").concat(t.label):"".concat(t.label)),(null==t?void 0:t.attribute)&&(i=i?"".concat(i,"  ").concat(t.attribute):"".concat(t.attribute)),(null==t?void 0:t.textAttribute)&&(n=null==t?void 0:t.textAttribute),{headerText:i,bottomText:n}):{headerText:i,bottomText:n}}},{key:"getReferenceOptions",value:function(t){return t?{lineCap:"butt",lineDash:[20,20]}:{}}},{key:"render",value:function(){var t=this;try{if((0,u.Z)((0,g.Z)(i.prototype),"render",this).call(this),!0===this.loading)return;this.renderDomInstance.render(this.annotations.filter((function(t){return"text"===t.type&&"rt"===t.annotation.position})).map((function(t){return t.annotation}))),this.annotations.forEach((function(e){var i,n,r,o,s,a,l,u,c,h,d,g,v;switch(e.type){case"rect":var f=e.annotation,y=f.hiddenText,p=void 0!==y&&y,b=f.isReference,x=t.zoom,m=Wn.changeRectByZoom(f,t.zoom,t.currentPos),k=m.x,L=m.y,I=m.width,w=m.height,P=t.getSpecificStyle(f);if(f.id===t.mouseHoverID||P.fill){var C=(0,A.Z)(null!=(n=null!=(i=null==P?void 0:P.fill)?i:null==P?void 0:P.stroke)?n:gr),D="rgba(".concat(C[0],", ").concat(C[1],", ").concat(C[2],",").concat(.8*C[3],")");Ze.drawRectWithFill(t.canvas,m,{color:D})}Ze.drawRect(t.canvas,m,hr(dr(hr({},P),{hiddenText:!0}),t.getReferenceOptions(b)));var R=t.getRenderText(f,null==f?void 0:f.hiddenText),S=R.headerText,T=R.bottomText;S&&Ze.drawText(t.canvas,{x:k,y:L-6},S,dr(hr({color:P.stroke,font:"normal normal 900 14px SourceHanSansCN-Regular"},Zt),{textMaxWidth:300}));var Z="".concat(Math.round(I/x)," * ").concat(Math.round(w/x)),M=7*Z.length;if(p||Ze.drawText(t.canvas,{x:k+I-M,y:L+w+15},Z,hr({color:P.stroke,font:"normal normal 600 14px Arial"},Zt)),T){var O=Math.max(20,I-M);Ze.drawText(t.canvas,{x:k,y:L+w+20},f.textAttribute,hr({color:P.stroke,font:"italic normal 900 14px Arial",textMaxWidth:O},Zt))}break;case"polygon":var E=e.annotation;if(!((null==(r=null==E?void 0:E.pointList)?void 0:r.length)>=3))return;var N=E.lineType,H=void 0===N?j.Line:N,B=Wn.changePointListByZoom(null!=(o=null==E?void 0:E.pointList)?o:[],t.zoom,t.currentPos),_=t.getSpecificStyle(E);if(E.id===t.mouseHoverID||_.fill){var z=(0,A.Z)(null!=(a=null!=(s=null==_?void 0:_.fill)?s:null==_?void 0:_.stroke)?a:gr),F="rgba(".concat(z[0],", ").concat(z[1],", ").concat(z[2],",").concat(.8*z[3],")");Ze.drawPolygonWithFill(t.canvas,B,{color:F,lineType:H})}var U=dr(hr(dr(hr({},_),{isClose:!0}),t.getReferenceOptions(null==E?void 0:E.isReference)),{lineType:H,strokeColor:_.stroke}),V=[];if(V=E.showKeyPoint?Ze.drawPolygonWithKeyPoint(t.canvas,B,U):Ze.drawPolygon(t.canvas,B,U),!0===(null==E?void 0:E.showDirection)&&(null==(l=null==E?void 0:E.pointList)?void 0:l.length)>2){var W=B[0],K=Lt.getLineCenterPoint([B[0],B[1]]);if(H===j.Curve){var X=Math.floor(8);W=V[X],K=V[X+1]}Ze.drawArrowByCanvas(t.canvas,W,K,{color:_.stroke,thickness:_.thickness}),Ze.drawCircle(t.canvas,B[0],_.thickness+6,{color:_.stroke,thickness:_.thickness})}var G=t.getRenderText(E,null==E?void 0:E.hiddenText),Y=G.headerText,J=G.bottomText;if(Y&&Ze.drawText(t.canvas,B[0],Y,hr({color:_.stroke},Tt)),J){var q=B[B.length-1];Ze.drawText(t.canvas,{x:q.x+Mt.x,y:q.y+Mt.y},J,hr({color:_.stroke},Tt))}break;case"line":var $=e.annotation;if(!((null==(u=null==$?void 0:$.pointList)?void 0:u.length)>=2))return;var tt=$.lineType,et=void 0===tt?j.Line:tt,it=Wn.changePointListByZoom(null!=(c=null==$?void 0:$.pointList)?c:[],t.zoom,t.currentPos),nt=t.getSpecificStyle($),rt=Ze.drawPolygon(t.canvas,it,dr(hr(hr({},nt),t.getReferenceOptions(null==$?void 0:$.isReference)),{lineType:et}));if(!0===(null==$?void 0:$.showDirection)&&(null==(h=null==$?void 0:$.pointList)?void 0:h.length)>2){var ot=it[0],st=Lt.getLineCenterPoint([it[0],it[1]]);if(et===j.Curve){var at=Math.floor(8);ot=rt[at],st=rt[at+1]}Ze.drawArrowByCanvas(t.canvas,ot,st,{color:nt.stroke,thickness:nt.thickness}),Ze.drawCircle(t.canvas,it[0],nt.thickness+6,{color:nt.stroke,thickness:nt.thickness})}var lt=t.getRenderText($,null==$?void 0:$.hiddenText),ut=lt.headerText,ct=lt.bottomText;if(ut&&Ze.drawText(t.canvas,it[0],ut,hr({color:nt.stroke},Tt)),ct){var ht=it[it.length-1];Ze.drawText(t.canvas,{x:ht.x+Mt.x,y:ht.y+Mt.y},ct,hr({color:nt.stroke},Tt))}break;case"point":var dt=e.annotation,gt=Wn.changePointByZoom(dt,t.zoom,t.currentPos),vt=t.getSpecificStyle(dt),ft=null!=(d=vt.radius)?d:3;Ze.drawCircle(t.canvas,gt,ft,vt);var yt=t.getRenderText(dt,null==dt?void 0:dt.hiddenText),pt=yt.headerText,bt=yt.bottomText;pt&&Ze.drawText(t.canvas,{x:gt.x+ft/2,y:gt.y-ft-4},pt,{textAlign:"center",color:vt.stroke}),bt&&Ze.drawText(t.canvas,{x:gt.x+ft,y:gt.y+ft+24},bt,hr({color:vt.stroke},Tt));break;case"text":var xt=e.annotation,mt=xt.text,kt=xt.x,It=xt.y,wt=xt.textMaxWidth,Pt=xt.color,Ct=void 0===Pt?"white":Pt,Dt=xt.background,At=void 0===Dt?"rgba(0, 0, 0, 0.6)":Dt,Rt=xt.lineHeight,St=void 0===Rt?25:Rt,Ot=xt.font,Et=void 0===Ot?Q:Ot,Nt=xt.position,Ht=Wn.changePointByZoom({x:kt,y:It},t.zoom,t.currentPos),Bt=Lt.getTextArea(t.canvas,xt.text,wt,Et,St),_t=Bt.width,zt=Bt.height,Ft=Bt.fontHeight,jt=void 0===Ft?0:Ft;if("rt"===Nt)break;Ze.drawRectWithFill(t.canvas,{x:Ht.x,y:Ht.y,width:_t+20,height:zt+20,id:"",sourceID:"",valid:!0,textAttribute:"",attribute:"",isVisible:!0},{color:At}),Ze.drawText(t.canvas,{x:Ht.x+10,y:Ht.y+jt+10},mt,{color:Ct,lineHeight:St,font:Et,textMaxWidth:wt})}null==(v=null==(g=e.annotation)?void 0:g.renderEnhance)||v.call(g,{ctx:t.ctx,canvas:t.canvas,currentPos:t.currentPos,zoom:t.zoom,data:e,toolInstance:t})}))}catch(e){console.error("ViewOperation Render Error",e)}}}]),i}(Ii);!function(t){t[t.Upload=0]="Upload",t[t.UploadRetry=1]="UploadRetry",t[t.UploadFail=2]="UploadFail",t[t.Annotation=3]="Annotation",t[t.Terminated=4]="Terminated",t[t.Finish=5]="Finish",t[t.Publish=6]="Publish"}(An||(An={}));Object.freeze({__proto__:null,ANNOTATION_TYPE:{0:"目标检测",1:"图像分类"},ANNOTATION_STATUS:{0:"标注文件传输中",1:"标注文件传输重试",2:"标注文件传输失败",3:"标注中",4:"任务终止",5:"任务完成",6:"数据已发布"},get EAnnotationStatus(){return An}});var fr=function(){function t(){(0,f.Z)(this,t)}return(0,y.Z)(t,null,[{key:"load",value:function(t){return new Promise((function(e,i){var n;"undefined"!=typeof Image&&(n=new Image,t.startsWith("file")?n.src=encodeURI(t):n.src=t,n.onload=function(){e(n)},n.onerror=function(){i(n)})}))}}]),t}(),yr=Object.defineProperty,pr=Object.defineProperties,br=Object.getOwnPropertyDescriptors,xr=Object.getOwnPropertySymbols,mr=Object.prototype.hasOwnProperty,kr=Object.prototype.propertyIsEnumerable,Lr=function(t,e,i){return e in t?yr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i},Ir=function(t){return new Promise((function(e,i){var n=document.createElement("img");n.crossOrigin="Anonymous",n.onerror=function(t){console.error(t),i(n)},n.src=t,n.onload=function(){e(n)}}))},wr=function(){function t(e){var i,n,r,o=this;(0,f.Z)(this,t),this.setImgSrc=function(t){return function(t,e,i){return new Promise((function(n,r){var o=function(t){try{a(i.next(t))}catch(e){r(e)}},s=function(t){try{a(i.throw(t))}catch(e){r(e)}},a=function(t){return t.done?n(t.value):Promise.resolve(t.value).then(o,s)};a((i=i.apply(t,e)).next())}))}(o,null,k().mark((function e(){var i;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ir(t);case 2:!(i=e.sent)||this.setImgNode(i);case 4:case"end":return e.stop()}}),e,this)})))},this.tagConfigList=e.tagConfigList,this.attributeList=e.attributeList,this.container=e.container,this.size=e.size,this.toolName=e.toolName,this.imgNode=e.imgNode;var s=null!=(i=e.config)?i:je(e.toolName),a=(0,b.Z)(e.attributeList);("rectTool"===e.toolName||"pointTool"===e.toolName||"lineTool"===e.toolName||"polygonTool"===e.toolName)&&void 0!==e.config&&Object.keys(e.config).indexOf("attributeList")>=0&&(a=[].concat((0,b.Z)(a),(0,b.Z)(null==(n=e.config)?void 0:n.attributeList))),this.config=function(t,e){return pr(t,br(e))}(function(t,e){for(var i in e||(e={}))mr.call(e,i)&&Lr(t,i,e[i]);if(xr){var n,r=S(xr(e));try{for(r.s();!(n=r.n()).done;)i=n.value,kr.call(e,i)&&Lr(t,i,e[i])}catch(o){r.e(o)}finally{r.f()}}return t}({},s),{attributeList:a,tagConfigList:e.tagConfigList}),this.style=null!=(r=e.style)?r:Ue,this.i18nLanguage="cn",this._initToolOperation()}return(0,y.Z)(t,[{key:"setToolName",value:function(t,e){this.toolName=t;var i=e||je(t);this.config=i,this._initToolOperation()}},{key:"setImgNode",value:function(t,e){!this.toolInstance||(this.imgNode=t,this.toolInstance.setImgNode(t,e))}},{key:"setSize",value:function(t){this.size=t}},{key:"setStyle",value:function(t){this.style=t}},{key:"_initToolOperation",value:function(){this.toolInstance&&this.toolInstance.destroy();var t=Dn.getCurrentOperation(this.toolName);if(t){var e={container:this.container,size:this.size,config:this.config,drawOutSideTarget:!1,style:this.style};this.imgNode&&Object.assign(e,{imgNode:this.imgNode}),this.toolInstance=new t(e),this.setLang(this.i18nLanguage),this.toolInstance.init()}}},{key:"setBasicInfo",value:function(t,e){this.dependToolName=t,this.basicResult=e,this.toolInstance.setDependName(t),this.toolInstance.setBasicResult(e),this.toolInstance.renderBasicCanvas()}},{key:"setPrevResultList",value:function(t){this.toolInstance.setPrevResultList(t)}},{key:"clearBasicResult",value:function(){this.setBasicInfo()}},{key:"forbidOperation",value:function(){this.toolInstance.setForbidOperation(!0)}},{key:"launchOperation",value:function(){this.toolInstance.setForbidOperation(!1)}},{key:"setLang",value:function(t){switch(this.i18nLanguage=t,t){case"cn":this.toolInstance.setLang(Rt.Zh);break;case"en":this.toolInstance.setLang(Rt.US)}}},{key:"setDataInjectionAtCreation",value:function(t){this.toolInstance.setDataInjectionAtCreation(t)}},{key:"setRenderEnhance",value:function(t){this.toolInstance.setRenderEnhance(t)}}]),t}(),Pr=Dn}}]);
//# sourceMappingURL=ecd5c527-d2dacd96987c3570f416.js.map