{"ast":null,"code":"import _regeneratorRuntime from\"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";var _JSON$parse;import{createSlice}from'@reduxjs/toolkit';import{apiLogin,apiLogout}from'../api/user.api';import{createAsyncAction}from'./utils';import{getGlobalState}from'../utils/getGloabal';var initialState=_objectSpread(_objectSpread({},getGlobalState()),{},{noticeCount:0,locale:localStorage.getItem('locale')||'zh_CN',newUser:(_JSON$parse=JSON.parse(localStorage.getItem('newUser')))!==null&&_JSON$parse!==void 0?_JSON$parse:true,logged:localStorage.getItem('t')?true:false,menuList:[],username:localStorage.getItem('username')||'',role:localStorage.getItem('username')||''});var userSlice=createSlice({name:'user',initialState:initialState,reducers:{setUserItem:function setUserItem(state,action){var username=action.payload.username;if(username!==state.username){localStorage.setItem('username',action.payload.username||'');}Object.assign(state,action.payload);}}});var setUserItem=userSlice.actions.setUserItem;export{setUserItem};export default userSlice.reducer;// source async thunk\n// export const loginAsync = (payload: LoginParams) => {\n//   return async (dispatch: Dispatch) => {\n//     const { result, status } = await apiLogin(payload);\n//     if (status) {\n//       localStorage.setItem('t', result.token);\n//       localStorage.setItem('username', result.username);\n//       dispatch(\n//         setUserItem({\n//           logged: true,\n//           username: result.username\n//         })\n//       );\n//       return true;\n//     }\n//     return false;\n//   };\n// };\n// typed wrapper async thunk function demo, no extra feature, just for powerful typings\nexport var loginAsync=createAsyncAction(function(payload){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch,getState){var _yield$apiLogin,result,status;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return apiLogin(payload);case 2:_yield$apiLogin=_context.sent;result=_yield$apiLogin.result;status=_yield$apiLogin.status;if(!status){_context.next=10;break;}localStorage.setItem('t',result.token);localStorage.setItem('username',result.username);dispatch(setUserItem({logged:true,username:result.username}));return _context.abrupt(\"return\",true);case 10:return _context.abrupt(\"return\",false);case 11:case\"end\":return _context.stop();}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();});export var logoutAsync=function logoutAsync(){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch){var _yield$apiLogout,status;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return apiLogout({token:localStorage.getItem('t')});case 2:_yield$apiLogout=_context2.sent;status=_yield$apiLogout.status;if(!status){_context2.next=8;break;}localStorage.clear();dispatch(setUserItem({logged:false}));return _context2.abrupt(\"return\",true);case 8:return _context2.abrupt(\"return\",false);case 9:case\"end\":return _context2.stop();}},_callee2);}));return function(_x3){return _ref2.apply(this,arguments);};}();};","map":null,"metadata":{},"sourceType":"module"}