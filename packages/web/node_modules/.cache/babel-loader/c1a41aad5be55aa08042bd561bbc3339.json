{"ast":null,"code":"import _classCallCheck from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _createForOfIteratorHelper from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport { uuid as v } from \"@label-u/annotation\";\nimport { jsonParser as u } from \"./index.js\";\nimport { EToolName as d } from \"../data/enums/ToolType.js\";\nimport _ from \"lodash\";\nvar y = Object.defineProperty,\n  O = Object.defineProperties,\n  P = Object.getOwnPropertyDescriptors,\n  h = Object.getOwnPropertySymbols,\n  S = Object.prototype.hasOwnProperty,\n  w = Object.prototype.propertyIsEnumerable,\n  D = function D(a, t, e) {\n    return t in a ? y(a, t, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: e\n    }) : a[t] = e;\n  },\n  x = function x(a, t) {\n    for (var e in t || (t = {})) S.call(t, e) && D(a, e, t[e]);\n    if (h) {\n      var _iterator = _createForOfIteratorHelper(h(t)),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var e = _step.value;\n          w.call(t, e) && D(a, e, t[e]);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n    return a;\n  },\n  C = function C(a, t) {\n    return O(a, P(t));\n  };\nvar E = /*#__PURE__*/function () {\n  function E() {\n    _classCallCheck(this, E);\n  }\n  _createClass(E, null, [{\n    key: \"copyResultChange\",\n    value: function copyResultChange(t, e, s) {\n      try {\n        var r = u(t),\n          i = u(s),\n          o = \"step_\".concat(e);\n        if (r[o]) {\n          var n = r[o];\n          if (n.result) return n.result = n.result.map(function (c) {\n            return C(x({}, c), {\n              id: v(8, 62)\n            });\n          }), i[o] = n, JSON.stringify(i);\n        }\n        return t;\n      } catch (r) {\n        return t;\n      }\n    }\n  }, {\n    key: \"isResultSourceMatchedDependence\",\n    value: function isResultSourceMatchedDependence(t, e) {\n      var s = t == null ? void 0 : t.map(function (i) {\n          return i.sourceID;\n        }).sort(),\n        r = e == null ? void 0 : e.map(function (i) {\n          return i.id;\n        }).sort();\n      return _.isEqual(s, r);\n    }\n  }, {\n    key: \"deltaUpdateBasicResultList\",\n    value: function deltaUpdateBasicResultList(t, e) {\n      var s = t == null ? void 0 : t.map(function (r) {\n        return r.sourceID;\n      }).sort();\n      return e.filter(function (r) {\n        return !s.includes(r.id);\n      });\n    }\n  }, {\n    key: \"getInitialResultList\",\n    value: function getInitialResultList(t, e, s, r, i) {\n      var o = t != null ? t : [];\n      switch (s.tool) {\n        case d.Tag:\n        case d.Text:\n          return o;\n        default:\n          return o;\n      }\n    }\n  }, {\n    key: \"dataCorrection\",\n    value: function dataCorrection(t, e, s, r) {\n      var i, o;\n      try {\n        var n = r[0].tool,\n          c = u(t),\n          p = u(e),\n          f = (i = c[n]) == null ? void 0 : i.result,\n          l = (o = p[n]) == null ? void 0 : o.result;\n        if (!l || l && l.length === 0 || _.isEqual(f.sort(this.idCmp), l.sort(this.idCmp))) return t;\n        var m = this.findDeletedIds(f, l);\n        if (m.length === 0) return t;\n        var I = s,\n          g = this.getStepKeys(c).sort();\n        return this.deleteRes(c, I, m, g), JSON.stringify(c);\n      } catch (n) {\n        return console.error(n), t;\n      }\n    }\n  }, {\n    key: \"idCmp\",\n    value: function idCmp(t, e) {\n      var s = t.id,\n        r = e.id;\n      return s < r ? -1 : s > r ? 1 : 0;\n    }\n  }, {\n    key: \"findDeletedIds\",\n    value: function findDeletedIds(t, e) {\n      return this.findDeletedItems(e, t).map(function (s) {\n        return s.id;\n      });\n    }\n  }, {\n    key: \"findDeletedItems\",\n    value: function findDeletedItems(t, e) {\n      var s = [];\n      return t.forEach(function (r) {\n        e.some(function (o) {\n          return o.id === r.id;\n        }) || s.push(r);\n      }), s;\n    }\n  }, {\n    key: \"getStepKeys\",\n    value: function getStepKeys(t) {\n      return Object.keys(t).map(function (e) {\n        return parseInt(e.replace(\"step_\", \"\"), 10);\n      }).filter(function (e) {\n        return !isNaN(e);\n      });\n    }\n  }, {\n    key: \"deleteRes\",\n    value: function deleteRes(t, e, s, r) {\n      var _this = this;\n      r.forEach(function (i) {\n        if (i > e) {\n          var o = t[\"step_\".concat(i)];\n          if ([d.FolderTag, d.Segmentation].includes(o.tool)) return;\n          if (o.dataSourceStep === e) {\n            var n = [];\n            o.result = o.result.filter(function (c) {\n              return s.includes(c.sourceID) ? (n.push(c.id), !1) : !0;\n            }), _this.deleteRes(t, i, n, r);\n          } else o.result = o.result.filter(function (n) {\n            return !s.includes(n.sourceID);\n          });\n        }\n      });\n    }\n  }]);\n  return E;\n}();\nexport { E as default };","map":null,"metadata":{},"sourceType":"module"}