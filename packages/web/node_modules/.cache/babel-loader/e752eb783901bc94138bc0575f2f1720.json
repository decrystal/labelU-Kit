{"ast":null,"code":"import _defineProperty from\"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import AceEditor from'react-ace';import'ace-builds/src-noconflict/mode-json';import'ace-builds/src-noconflict/theme-xcode';import'ace-builds/src-noconflict/snippets/json';import'ace-builds/src-min-noconflict/ext-searchbox';import'ace-builds/src-noconflict/ext-language_tools';import'ace-builds/webpack-resolver';import _ from'lodash';import{useEffect,useState}from'react';import jsonToyam from'../../utils/jsonToyml';import{useDispatch,useSelector}from'react-redux';import ConfigNotMatchImg from'../../img/annotationCommon/configNotMatch.png';import{updateAllAttributeConfigList,updateFileInfo,updateTagConfigList,updateTextConfig,updateToolsConfig}from'../../stores/toolConfig.store';import{compare}from'../../utils';import{validateTools}from'../../utils/tool/common';import{Fragment as _Fragment}from\"@emotion/react/jsx-runtime\";import{jsx as _jsx}from\"@emotion/react/jsx-runtime\";var YamlConfig=function YamlConfig(props){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),xmlValue=_useState2[0],setXmlValue=_useState2[1];var dispatch=useDispatch();var _useSelector=useSelector(function(state){return state.toolsConfig;}),tools=_useSelector.tools,tagList=_useSelector.tagList,attribute=_useSelector.attribute,textConfig=_useSelector.textConfig;var onLoad=function onLoad(){};useEffect(function(){var tmpStepConfig={};var keys=Object.keys(props.toolsConfigState);for(var i=0;i<keys.length;i++){if(// @ts-ignore\nprops.toolsConfigState[keys[i]]&&(// @ts-ignore\nArray.isArray(props.toolsConfigState[keys[i]])&&props.toolsConfigState[keys[i]].length>0||// @ts-ignore\n!Array.isArray(props.toolsConfigState[keys[i]])&&// @ts-ignore\nObject.keys(props.toolsConfigState[keys[i]])&&// @ts-ignore\nObject.keys(props.toolsConfigState[keys[i]]).length>0)){// @ts-ignore\ntmpStepConfig=_objectSpread(_objectSpread({},tmpStepConfig),{},_defineProperty({},keys[i],props.toolsConfigState[keys[i]]));}}var jsonToyamUtil=new jsonToyam();var yml=jsonToyamUtil.json2yaml(tmpStepConfig);setXmlValue(yml);},[props.toolsConfigState]);var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),aceHeight=_useState4[0],setAceHeight=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),aceWidth=_useState6[0],setAceWidth=_useState6[1];useEffect(function(){var leftSiderDom=document.getElementById('lefeSiderId');var height=leftSiderDom===null||leftSiderDom===void 0?void 0:leftSiderDom.getBoundingClientRect().height;var width=leftSiderDom===null||leftSiderDom===void 0?void 0:leftSiderDom.getBoundingClientRect().width;setAceHeight(height-105);setAceWidth(width-50);},[]);// 触发工具配置更新\nvar onAceBlur=function onAceBlur(e){e.stopPropagation();try{var initConfig={tools:[],tagList:[],attribute:[],textConfig:[]};// @ts-ignore\nvar yamlConfigs=window.YAML.parse(xmlValue);// 清空配置\nvar configs=_objectSpread(_objectSpread({},initConfig),yamlConfigs);var keys=Object.keys(configs);for(var _i=0,_keys=keys;_i<_keys.length;_i++){var key=_keys[_i];if(key==='attribute'&&!compare(configs[key],attribute)){dispatch(updateAllAttributeConfigList(configs[key]));}else if(key==='tagList'&&!compare(configs[key],tagList)){dispatch(updateTagConfigList(configs[key]));}else if(key==='textConfig'&&!compare(configs[key],textConfig)){dispatch(updateTextConfig(configs[key]));}else if(key==='tools'&&!compare(configs[key],tools)){if(!validateTools(configs[key])){props.doSetImg(ConfigNotMatchImg,true);}else{props.doSetImg(ConfigNotMatchImg,false);}dispatch(updateToolsConfig(configs[key]));}else if(key==='fileInfo'){dispatch(updateFileInfo(configs[key]));}}}catch(error){props.doSetImg(ConfigNotMatchImg,true);}};var onChnageAce=_.debounce(function(e){setXmlValue(e);},10);return _jsx(_Fragment,{children:_jsx(AceEditor,{placeholder:\"\\u8BF7\\u8F93\\u5165\\u5DE5\\u5177\\u914D\\u7F6E\\uFF08yaml\\u683C\\u5F0F\\uFF09\",mode:\"json\",theme:\"xcode\",name:\"github\",width:aceWidth+'px',height:aceHeight+'px',onLoad:onLoad,onChange:onChnageAce,onBlur:onAceBlur,fontSize:14,showPrintMargin:true,showGutter:true,highlightActiveLine:true,wrapEnabled:true,value:xmlValue,editorProps:{$blockScrolling:Infinity},setOptions:{enableBasicAutocompletion:true,enableLiveAutocompletion:true,enableSnippets:true,showLineNumbers:true,tabSize:2}})});};export default YamlConfig;","map":null,"metadata":{},"sourceType":"module"}