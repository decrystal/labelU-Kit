{"ast":null,"code":"import _classCallCheck from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport h from \"react\";\nimport { CommonToolUtils as v, uuid as p } from \"@label-u/annotation\";\nimport f from \"../../utils/StepUtils.js\";\nimport { jsonParser as y } from \"../../utils/index.js\";\nimport { VideoPlayer as L } from \"./index.js\";\nimport { VideoTagLayer as R } from \"./VideoTagLayer.js\";\nimport c from \"lodash\";\nimport { getKeyCodeNumber as b } from \"./utils.js\";\nvar S = /*#__PURE__*/function (_h$Component) {\n  _inherits(S, _h$Component);\n  var _super = _createSuper(S);\n  function S(i) {\n    var _this;\n    _classCallCheck(this, S);\n    _this = _super.call(this, i);\n    _this.fns = {}, _this.labelSelectedList = [], _this.clearResult = function () {\n      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !0;\n      var e = arguments.length > 1 ? arguments[1] : undefined;\n      var s = e ? _this.state.tagResult.map(function (l) {\n        return (l == null ? void 0 : l.result[e]) && delete l.result[e], l;\n      }) : [];\n      _this.setState({\n        tagResult: s\n      }, function () {\n        return _this.emitEvent(\"render\");\n      });\n    }, _this.exportData = function () {\n      var t, e, s, l, r, n, o;\n      var a = (e = (t = _this.videoRef) == null ? void 0 : t.duration) != null ? e : 0,\n        d = (s = _this.videoRef) == null ? void 0 : s.getVideoPlaybackQuality(),\n        u = d == null ? void 0 : d.totalVideoFrames,\n        g = (r = (l = _this.videoRef) == null ? void 0 : l.videoWidth) != null ? r : 0,\n        m = (o = (n = _this.videoRef) == null ? void 0 : n.videoHeight) != null ? o : 0;\n      return [_this.state.tagResult, {\n        valid: _this.state.valid,\n        duration: a,\n        frames: u,\n        videoWidth: g,\n        videoHeight: m\n      }];\n    }, _this.emitEvent = function (t) {\n      _this.fns[t] && _this.fns[t]();\n    }, _this.combineResult = function (t) {\n      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var s, l;\n      var r = t.isMulti,\n        _t$value = t.value,\n        n = _t$value.key,\n        o = _t$value.value;\n      if (r) {\n        var a = (l = (s = e[n]) == null ? void 0 : s.split(\";\")) != null ? l : [];\n        a.includes(o) ? a = a.filter(function (u) {\n          return u !== o;\n        }) : a.push(o);\n        var d = new Set(a);\n        return e[n] = Array.from(d).join(\";\"), c.pickBy(e, function (u) {\n          return u;\n        });\n      }\n      return e[n] = e[n] === o ? void 0 : o, c.pickBy(e, function (a) {\n        return a;\n      });\n    }, _this.setResult = function (t) {\n      _this.setState({\n        tagResult: t\n      }), _this.fns.render && _this.fns.render();\n    }, _this.setLabel = function (t, e) {\n      _this.setLabelBySelectedList(t, e);\n    }, _this.keydown = function (t) {\n      var e = b(t.keyCode);\n      if (e) {\n        var s = e - 1;\n        if (_this.config.inputList.length === 1) {\n          _this.labelSelectedList = [0, s], _this.setLabel(0, s), setTimeout(function () {\n            _this.labelSelectedList = [], _this.emitEvent(\"render\");\n          }, 500);\n          return;\n        }\n        _this.labelSelectedList.length === 1 ? (_this.labelSelectedList = [_this.labelSelectedList[0], s], _this.setLabel(_this.labelSelectedList[0], s), setTimeout(function () {\n          _this.labelSelectedList = [], _this.emitEvent(\"render\");\n        }, 500)) : (_this.labelSelectedList = [s], _this.emitEvent(\"expend\"));\n      }\n    }, _this.setValid = function (t) {\n      _this.setState({\n        valid: t\n      }), t === !1 && _this.setState({\n        tagResult: []\n      }), _this.emitEvent(\"render\");\n    }, _this.setResultFromImgList = function (t) {\n      var e;\n      var s = t.imgList,\n        l = t.imgIndex,\n        r = t.step;\n      if (!s[l]) return;\n      var n = y(s[l].result),\n        o = n[\"step_\".concat(r)];\n      _this.setState({\n        tagResult: (e = o == null ? void 0 : o.result) != null ? e : [],\n        valid: (n == null ? void 0 : n.valid) === void 0 ? !0 : n.valid\n      });\n    }, _this.state = {\n      tagResult: [],\n      labelSelectedList: [],\n      valid: !0\n    };\n    return _this;\n  }\n  _createClass(S, [{\n    key: \"config\",\n    get: function get() {\n      var i = f.getCurrentStepInfo(this.props.step, this.props.stepList);\n      return i == null ? void 0 : i.config;\n    }\n  }, {\n    key: \"history\",\n    get: function get() {\n      return {\n        initRecord: function initRecord() {},\n        pushHistory: function pushHistory() {}\n      };\n    }\n  }, {\n    key: \"currentTagResult\",\n    get: function get() {\n      var i;\n      return (i = this.state.tagResult[0]) != null ? i : {};\n    }\n  }, {\n    key: \"valid\",\n    get: function get() {\n      return this.state.valid;\n    }\n  }, {\n    key: \"singleOn\",\n    value: function singleOn(i, t) {\n      this.fns[i] = t;\n    }\n  }, {\n    key: \"on\",\n    value: function on(i, t) {\n      this.singleOn(i, t);\n    }\n  }, {\n    key: \"getTagResultByCode\",\n    value: function getTagResultByCode(i, t) {\n      var e, s, l;\n      try {\n        var r = (s = (e = this.config) == null ? void 0 : e.inputList) != null ? s : [],\n          n = r.length > 1,\n          o = t !== void 0 ? i : 0,\n          a = t !== void 0 ? t : i,\n          d = n ? r[o] : r[0],\n          u = ((l = d.subSelected) != null ? l : [])[a];\n        if (d && u) return {\n          value: {\n            key: d.value,\n            value: u.value\n          },\n          isMulti: d.isMulti\n        };\n      } catch (r) {\n        return;\n      }\n    }\n  }, {\n    key: \"setLabelBySelectedList\",\n    value: function setLabelBySelectedList(i, t) {\n      var _this2 = this;\n      var e, s, l, r;\n      var n = this.getTagResultByCode(i, t);\n      if (n) {\n        var o = this.combineResult(n, (s = (e = this.state.tagResult[0]) == null ? void 0 : e.result) != null ? s : {}),\n          a = [{\n            sourceID: v.getSourceID(),\n            id: (r = (l = this.currentTagResult) == null ? void 0 : l.id) != null ? r : p(8, 62),\n            result: o\n          }];\n        this.setState({\n          tagResult: a\n        }, function () {\n          return _this2.emitEvent(\"render\");\n        });\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      document.addEventListener(\"keydown\", this.keydown), this.props.onMounted(this), this.setResultFromImgList(this.props);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.addEventListener(\"keydown\", this.keydown), this.props.onUnmounted();\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(i) {\n      return i.imgIndex !== this.props.imgIndex && this.setResultFromImgList(i), !0;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n      var i;\n      var _this$props = this.props,\n        t = _this$props.imgIndex,\n        e = _this$props.imgList,\n        s = _this$props.pageForward,\n        l = _this$props.pageJump,\n        r = _this$props.pageBackward,\n        _this$state = this.state,\n        n = _this$state.tagResult,\n        o = _this$state.valid;\n      return /*#__PURE__*/h.createElement(\"div\", {\n        style: {\n          height: \"100%\",\n          width: \"100%\",\n          position: \"relative\"\n        }\n      }, /*#__PURE__*/h.createElement(L, {\n        imgIndex: t,\n        imgList: e,\n        pageBackward: r,\n        pageForward: s,\n        pageJump: l,\n        valid: o,\n        setVideoRef: function setVideoRef(a) {\n          _this3.videoRef = a;\n        }\n      }), /*#__PURE__*/h.createElement(R, {\n        result: n,\n        inputList: (i = this.config) == null ? void 0 : i.inputList\n      }));\n    }\n  }]);\n  return S;\n}(h.Component);\nexport { S as TagToolInstanceAdaptor };","map":null,"metadata":{},"sourceType":"module"}