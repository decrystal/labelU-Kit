{"ast":null,"code":"import _regeneratorRuntime from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _toConsumableArray from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _createForOfIteratorHelper from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport { BasicToolOperation as V } from \"@label-u/annotation\";\nimport { ANNOTATION_ACTIONS as r } from \"../Actions.js\";\nimport { LoadFileAndFileData as U, getStepConfig as W } from \"./reducer.js\";\nimport { ESubmitType as _ } from \"../../constant/index.js\";\nimport { EPageTurningOperation as T } from \"../../data/enums/AnnotationSize.js\";\nimport X from \"../../utils/PageOperator.js\";\nimport { jsonParser as z } from \"../../utils/index.js\";\nvar K = Object.defineProperty,\n  g = Object.getOwnPropertySymbols,\n  Z = Object.prototype.hasOwnProperty,\n  q = Object.prototype.propertyIsEnumerable,\n  O = function O(t, e, n) {\n    return e in t ? K(t, e, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: n\n    }) : t[e] = n;\n  },\n  Y = function Y(t, e) {\n    for (var n in e || (e = {})) Z.call(e, n) && O(t, n, e[n]);\n    if (g) {\n      var _iterator = _createForOfIteratorHelper(g(e)),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var n = _step.value;\n          q.call(e, n) && O(t, n, e[n]);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n    return t;\n  },\n  L = function L(t, e, n) {\n    return new Promise(function (a, i) {\n      var p = function p(u) {\n          try {\n            l(n.next(u));\n          } catch (s) {\n            i(s);\n          }\n        },\n        o = function o(u) {\n          try {\n            l(n.throw(u));\n          } catch (s) {\n            i(s);\n          }\n        },\n        l = function l(u) {\n          return u.done ? a(u.value) : Promise.resolve(u.value).then(p, o);\n        };\n      l((n = n.apply(t, e)).next());\n    });\n  };\nvar $ = function $(t, e) {\n    return e.map(function (n) {\n      return t(n);\n    });\n  },\n  Q = function Q(t) {\n    return t === T.Forward ? _.Forward : t === T.Backward ? _.Backward : t === T.Jump ? _.Jump : _.Forward;\n  },\n  tt = function tt(t, e) {\n    var n, a;\n    var i = t.imgList,\n      p = t.imgIndex,\n      _W = W(t.stepList, t.step),\n      o = _W.dataSourceStep;\n    return ((a = (n = z(i[p - 1].result)[\"step_\".concat(o)]) == null ? void 0 : n.result) == null ? void 0 : a.length) - 1 || e;\n  };\nfunction et(t) {\n  return {\n    type: r.UPDATE_IMG_LIST,\n    payload: {\n      imgList: t\n    }\n  };\n}\nfunction m(_ref) {\n  var t = _ref.stepList,\n    e = _ref.step;\n  return {\n    type: r.SET_TASK_CONFIG,\n    payload: {\n      stepList: t,\n      step: e\n    }\n  };\n}\nfunction v(t) {\n  return {\n    type: r.UPDATE_ON_SUBMIT,\n    payload: {\n      onSubmit: t\n    }\n  };\n}\nfunction C(t) {\n  return {\n    type: r.UPDATE_ON_SAVE,\n    payload: {\n      onSave: t\n    }\n  };\n}\nfunction D(t) {\n  return {\n    type: r.UPDATE_ON_PAGE_CHANGE,\n    payload: {\n      onPageChange: t\n    }\n  };\n}\nfunction h(t) {\n  return {\n    type: r.UPDATE_ON_STEP_CHANGE,\n    payload: {\n      onStepChange: t\n    }\n  };\n}\nfunction x(t) {\n  return {\n    type: r.UPDATE_GET_FILE_DATA,\n    payload: {\n      getFileData: t\n    }\n  };\n}\nfunction w(t) {\n  return {\n    type: r.UPDATE_PAGE_SIZE,\n    payload: {\n      pageSize: t\n    }\n  };\n}\nfunction N(t) {\n  return {\n    type: r.UPDATE_LOAD_FILE_LIST,\n    payload: {\n      loadFileList: t\n    }\n  };\n}\nfunction R(t) {\n  return {\n    type: r.UPDATE_ATTRIBUTE_LIST,\n    payload: {\n      attributeList: t\n    }\n  };\n}\nfunction G(t) {\n  return {\n    type: r.UPDATE_TAG_LIST,\n    payload: {\n      tagConfigList: t\n    }\n  };\n}\nfunction F(t) {\n  return {\n    type: r.UPDATE_TOOLS_CONFIG,\n    payload: {\n      toolsBasicConfig: t\n    }\n  };\n}\nfunction nt() {\n  return {\n    type: r.UPDATE_ROTATE\n  };\n}\nfunction rt() {\n  return {\n    type: r.COPY_BACKWARD_RESULT\n  };\n}\nfunction B(t) {\n  return {\n    type: r.UPDATE_TEXT_CONFIG,\n    payload: {\n      textConfig: t\n    }\n  };\n}\nfunction ot(t) {\n  return {\n    type: r.UPDATE_IS_SHOW_ORDER,\n    payload: {\n      isShowOrder: t\n    }\n  };\n}\nfunction b(t) {\n  return {\n    type: r.INIT_TOOL,\n    payload: {\n      toolStyle: t\n    }\n  };\n}\nfunction at(_ref2) {\n  var t = _ref2.toolStyle,\n    e = _ref2.onSubmit,\n    n = _ref2.onSave,\n    a = _ref2.initToolName,\n    i = _ref2.tagConfigList,\n    p = _ref2.attributeList,\n    o = _ref2.toolsBasicConfig,\n    l = _ref2.textConfig,\n    u = _ref2.onPageChange,\n    s = _ref2.onStepChange,\n    c = _ref2.getFileData,\n    f = _ref2.pageSize,\n    y = _ref2.loadFileList,\n    A = _ref2.step,\n    j = _ref2.stepList;\n  var d = [];\n  if (o) {\n    d.push(F(o));\n    var P = a ? o.filter(function (J) {\n        return J.tool === a;\n      }) : [o[0]],\n      H = [Y({\n        step: 1\n      }, P[0])];\n    d.push(m({\n      stepList: H,\n      step: A\n    }));\n  } else d.push(m({\n    stepList: j,\n    step: A\n  }));\n  return l && d.push(B(l)), e && d.push(v(e)), i && d.push(G(i)), p && d.push(R(p)), n && d.push(C(n)), u && d.push(D(u)), s && d.push(h(s)), c && d.push(x(c)), y && d.push(N(y)), f && d.push(w(f)), d.push({\n    type: r.CALC_STEP_PROGRESS\n  }), d.push(b(t)), function (P) {\n    return $(P, d);\n  };\n}\nvar it = function it(t, e) {\n    var n;\n    var a = e == null ? void 0 : e.findIndex(function (i) {\n      return (i == null ? void 0 : i.step) === t;\n    });\n    return (n = e[a + 1]) == null ? void 0 : n.step;\n  },\n  ut = function ut(t) {\n    return function (e, n) {\n      var _n = n(),\n        a = _n.annotation,\n        i = a.step,\n        p = a.stepList,\n        o = it(i, p);\n      return [e(k(o, t))];\n    };\n  },\n  k = function k(t, e) {\n    return function (n, a) {\n      var i, p;\n      var _a = a(),\n        o = _a.annotation;\n      (i = o == null ? void 0 : o.onStepChange) == null || i.call(o, t);\n      var l = (p = o == null ? void 0 : o.imgIndex) != null ? p : 0;\n      return [n({\n        type: r.SUBMIT_RESULT\n      }), n({\n        type: r.SUBMIT_FILE_DATA,\n        payload: {\n          submitType: _.StepChanged\n        }\n      }), n({\n        type: r.SET_STEP,\n        payload: {\n          toStep: t\n        }\n      }), n({\n        type: r.CALC_STEP_PROGRESS\n      }), n(U(e != null ? e : l, 0))];\n    };\n  },\n  E = function E(t) {\n    return function (e) {\n      return [e({\n        type: r.SUBMIT_RESULT\n      }), e({\n        type: r.SUBMIT_FILE_DATA,\n        payload: {\n          submitType: t\n        }\n      })];\n    };\n  },\n  st = function st(t, e, n, a) {\n    return [t(E(n)), t(U(e, a))];\n  },\n  pt = function pt(t, e) {\n    return [t({\n      type: r.SUBMIT_RESULT\n    }), t({\n      type: r.SET_BASIC_INDEX,\n      payload: {\n        basicIndex: e\n      }\n    })];\n  },\n  lt = function lt(t, e) {\n    t({\n      type: r.SET_TRIGGER_EVENT_AFTER_INDEX_CHANGED,\n      payload: {\n        triggerEventAfterIndexChanged: e\n      }\n    });\n  },\n  dt = function dt() {\n    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;\n    return function (e, n) {\n      return S(e, n, T.Backward, t);\n    };\n  },\n  ct = function ct() {\n    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;\n    return function (e, n) {\n      return S(e, n, T.Forward, t);\n    };\n  },\n  _t = function _t(t) {\n    var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;\n    return function (n, a) {\n      if (t !== a().imgIndex) return S(n, a, T.Jump, e, t);\n    };\n  },\n  M = function M(t, e, n, a) {\n    return L(void 0, null, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var i, _e$annotation, p, o, l, u, s, c;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _e$annotation = e().annotation, p = _e$annotation.loadFileList, o = _e$annotation.imgList, l = _e$annotation.pageSize, u = Math.floor(n / l);\n            I(t, !0);\n            _context.prev = 2;\n            _context.next = 5;\n            return p(u, l);\n          case 5:\n            s = _context.sent;\n            if (!(I(t, !1), !((i = s == null ? void 0 : s.fileList) == null ? void 0 : i.length) || !(s == null ? void 0 : s.total))) {\n              _context.next = 8;\n              break;\n            }\n            throw new Error(\"fileList and total are required\");\n          case 8:\n            c = a ? new Array(s.total) : _toConsumableArray(o);\n            return _context.abrupt(\"return\", (c.splice.apply(c, [u * l, l].concat(_toConsumableArray(s.fileList))), t({\n              type: r.UPDATE_IMG_LIST,\n              payload: {\n                imgList: c\n              }\n            }), !0));\n          case 12:\n            _context.prev = 12;\n            _context.t0 = _context[\"catch\"](2);\n            I(t, !1), console.error(_context.t0);\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[2, 12]]);\n    }));\n  },\n  S = function S(t, e, n) {\n    var a = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !1;\n    var i = arguments.length > 4 ? arguments[4] : undefined;\n    return L(void 0, null, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      var p, o, _X$getNextPageInfo, l, u, s, c, f, y;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            o = e().annotation, _X$getNextPageInfo = X.getNextPageInfo(n, o, i), l = _X$getNextPageInfo.fileIndexChanged, u = _X$getNextPageInfo.fileIndex, s = _X$getNextPageInfo.basicIndexChanged, c = _X$getNextPageInfo.basicIndex;\n            V.Cache.set(\"nextIndex\", u);\n            f = Q(n);\n            if (!(lt(t, a), l)) {\n              _context2.next = 18;\n              break;\n            }\n            o.annotationEngine.toolInstance.clearCachedCoordinateAndZoom();\n            _context2.t0 = o.loading;\n            if (_context2.t0) {\n              _context2.next = 13;\n              break;\n            }\n            _context2.t1 = !o.imgList[u];\n            if (!_context2.t1) {\n              _context2.next = 12;\n              break;\n            }\n            _context2.next = 11;\n            return M(t, e, u);\n          case 11:\n            _context2.t1 = !_context2.sent;\n          case 12:\n            _context2.t0 = _context2.t1;\n          case 13:\n            if (!_context2.t0) {\n              _context2.next = 15;\n              break;\n            }\n            return _context2.abrupt(\"return\");\n          case 15:\n            (p = o.onPageChange) == null || p.call(o, u);\n            y = f === _.Backward ? tt(e().annotation, c) : c;\n            return _context2.abrupt(\"return\", st(t, u, f, y));\n          case 18:\n            return _context2.abrupt(\"return\", s ? pt(t, c) : t(E(f)));\n          case 19:\n          case \"end\":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }));\n  },\n  ft = function ft(t) {\n    t(E(_.Save)), t({\n      type: r.SAVE_RESULT\n    });\n  },\n  Tt = function Tt(t) {\n    return function (e) {\n      e({\n        type: r.UPDATE_CURRENT_TOOLNAME,\n        payload: {\n          toolName: t\n        }\n      });\n    };\n  },\n  I = function I(t, e) {\n    t({\n      type: r.SET_LOADING,\n      payload: {\n        loading: e\n      }\n    });\n  };\nexport { Tt as ChangeCurrentTool, ft as ChangeSave, rt as CopyBackWordResult, S as DispatcherTurning, at as InitTaskData, b as InitToolWithStyle, dt as PageBackward, ct as PageForward, _t as PageJump, I as SetAnnotationLoading, m as SetTaskConfig, ut as ToNextStep, E as ToSubmitFileData, R as UpdateAttributeList, x as UpdateGetFileData, N as UpdateGetFileList, et as UpdateImgList, ot as UpdateIsShowOrder, D as UpdateOnPageChange, C as UpdateOnSave, h as UpdateOnStepChange, v as UpdateOnSubmit, w as UpdatePageSize, k as UpdateProcessingStep, nt as UpdateRotate, G as UpdateTagList, B as UpdateTextConfig, F as UpdateToolsBasicConfig, M as loadImgList };","map":null,"metadata":{},"sourceType":"module"}