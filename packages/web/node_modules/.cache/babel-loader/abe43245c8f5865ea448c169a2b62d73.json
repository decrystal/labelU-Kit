{"ast":null,"code":"import _classCallCheck from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/decrytal-ade/project/work/shlab/labelU-Kit/packages/web/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport o from \"react\";\nimport D from \"./components/controller/index.js\";\nimport { getClassName as d } from \"../../utils/dom.js\";\nimport { cKeyCode as I } from \"@label-u/annotation\";\nimport { decimalReserved as h } from \"./utils.js\";\nimport N from \"../fileException/index.js\";\nvar s = I.default,\n  u = /*#__PURE__*/o.createContext({\n    isPlay: !1,\n    playPause: function playPause() {},\n    updateNextPlaybackRate: function updateNextPlaybackRate() {},\n    playbackRate: 1,\n    currentTime: 0,\n    duration: 0,\n    buffered: 0,\n    setCurrentTime: function setCurrentTime() {},\n    imgList: [],\n    imgIndex: -1,\n    pageBackward: function pageBackward() {},\n    pageJump: function pageJump(f) {},\n    pageForward: function pageForward() {}\n  }),\n  L = 50,\n  m = .1,\n  l = [.5, 1, 1.5, 2, 4, 6, 8, 16];\nvar c = /*#__PURE__*/function (_o$Component) {\n  _inherits(c, _o$Component);\n  var _super = _createSuper(c);\n  function c(i) {\n    var _this;\n    _classCallCheck(this, c);\n    _this = _super.call(this, i);\n    _this.changePlaybackPate = function (e) {\n      _this.videoElm && (_this.videoElm.playbackRate = e, _this.setState({\n        playbackRate: e\n      }));\n    }, _this.playPause = function () {\n      var e, t, a;\n      ((e = _this.videoElm) == null ? void 0 : e.paused) ? (t = _this.videoElm) == null || t.play() : (a = _this.videoElm) == null || a.pause();\n    }, _this.updateNextPlaybackRate = function () {\n      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !0;\n      var t = l.findIndex(function (r) {\n        return r === _this.state.playbackRate;\n      });\n      var a = e ? Math.min(t + 1, l.length - 1) : Math.max(t - 1, 0);\n      _this.changePlaybackPate(l[a]);\n    }, _this.fastForward = function () {\n      _this.videoElm && _this.setCurrentTime(_this.videoElm.currentTime + m);\n    }, _this.rewind = function () {\n      _this.videoElm && _this.setCurrentTime(_this.videoElm.currentTime - m);\n    }, _this.keydown = function (e) {\n      e.keyCode === s.Space && (e.preventDefault(), _this.playPause()), e.keyCode === s.Up && (e.preventDefault(), _this.updateNextPlaybackRate()), e.keyCode === s.Down && (e.preventDefault(), _this.updateNextPlaybackRate(!1)), e.keyCode === s.Left && (e.preventDefault(), _this.rewind()), e.keyCode === s.Right && (e.preventDefault(), _this.fastForward());\n    }, _this.onPlay = function () {\n      _this.setState({\n        isPlay: !0\n      }, _this.onVideoStart);\n    }, _this.onPause = function () {\n      _this.onVideoStopped();\n    }, _this.onVideoStopped = function () {\n      _this.setState({\n        isPlay: !1\n      }), _this.timeInterval && (clearInterval(_this.timeInterval), _this.timeInterval = void 0), _this.videoElm && _this.setCurrentTime(_this.videoElm.currentTime);\n    }, _this.onVideoStart = function () {\n      typeof window != \"undefined\" && (_this.timeInterval = window.setInterval(function () {\n        var e, t, a;\n        if (_this.videoElm) try {\n          if (((e = _this.videoElm) == null ? void 0 : e.buffered.length) > 0) {\n            var r = (t = _this.videoElm) == null ? void 0 : t.buffered.end(0);\n            _this.setState({\n              currentTime: h((a = _this.videoElm) == null ? void 0 : a.currentTime, 1),\n              buffered: r\n            });\n          }\n        } catch (r) {\n          console.error(r);\n        }\n      }, L));\n    }, _this.resetVideoData = function () {\n      _this.setState({\n        currentTime: 0,\n        buffered: 0,\n        error: !1,\n        isPlay: !1\n      }), _this.videoElm && (_this.videoElm.playbackRate = _this.state.playbackRate), _this.onVideoStopped();\n    }, _this.setDuration = function () {\n      var e;\n      if (_this.videoElm) {\n        var t = h((e = _this.videoElm) == null ? void 0 : e.duration, 1);\n        _this.setState({\n          duration: t\n        });\n      }\n    }, _this.setCurrentTime = function (e) {\n      _this.videoElm && (_this.videoElm.currentTime = e, _this.setState({\n        currentTime: e\n      }));\n    }, _this.reload = function () {\n      var e;\n      (e = _this.videoElm) == null || e.load();\n    }, _this.onError = function () {\n      _this.resetVideoData(), _this.setState({\n        error: !0\n      });\n    }, _this.state = {\n      playbackRate: 1,\n      currentTime: 0,\n      isPlay: !1,\n      duration: 0,\n      buffered: 0,\n      error: !1\n    }, _this.videoRef = /*#__PURE__*/o.createRef();\n    return _this;\n  }\n  _createClass(c, [{\n    key: \"videoElm\",\n    get: function get() {\n      var i;\n      return (i = this.videoRef) == null ? void 0 : i.current;\n    }\n  }, {\n    key: \"videoSrc\",\n    get: function get() {\n      var i, e;\n      var _this$props = this.props,\n        t = _this$props.imgIndex,\n        a = _this$props.imgList;\n      return t > -1 && (e = (i = a[t]) == null ? void 0 : i.url) != null ? e : \"\";\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var i, e;\n      window == null || window.addEventListener(\"keydown\", this.keydown), ((i = this.videoRef) == null ? void 0 : i.current) && this.props.setVideoRef && this.props.setVideoRef((e = this.videoRef) == null ? void 0 : e.current);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window == null || window.removeEventListener(\"keydown\", this.keydown);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n        i = _this$state.isPlay,\n        e = _this$state.playbackRate,\n        t = _this$state.currentTime,\n        a = _this$state.duration,\n        r = _this$state.buffered,\n        v = _this$state.error,\n        _this$props2 = this.props,\n        p = _this$props2.imgList,\n        y = _this$props2.imgIndex,\n        E = _this$props2.pageBackward,\n        P = _this$props2.pageJump,\n        R = _this$props2.pageForward,\n        w = _this$props2.valid,\n        n = this.playPause,\n        k = this.updateNextPlaybackRate,\n        b = this.onPause,\n        g = this.onPlay,\n        C = this.resetVideoData,\n        x = this.setDuration,\n        T = this.setCurrentTime,\n        S = this.onError,\n        _ = this.videoRef,\n        V = this.videoSrc;\n      return /*#__PURE__*/o.createElement(u.Provider, {\n        value: {\n          videoRef: this.videoRef,\n          isPlay: i,\n          playPause: n,\n          updateNextPlaybackRate: k,\n          playbackRate: e,\n          currentTime: t,\n          duration: a,\n          buffered: r,\n          setCurrentTime: T,\n          imgIndex: y,\n          imgList: p,\n          pageBackward: E,\n          pageJump: P,\n          pageForward: R\n        }\n      }, /*#__PURE__*/o.createElement(\"div\", {\n        className: d(\"video-wrapper\")\n      }, /*#__PURE__*/o.createElement(\"div\", {\n        className: d(\"video-container\")\n      }, /*#__PURE__*/o.createElement(\"video\", {\n        ref: _,\n        className: d(\"video\"),\n        src: V,\n        onPause: b,\n        onPlay: g,\n        onLoadedMetadata: C,\n        onError: S,\n        onDurationChange: x,\n        width: \"100%\",\n        height: \"100%\",\n        onClick: n\n      }), /*#__PURE__*/o.createElement(N, {\n        fileType: \"video\",\n        errorProps: {\n          reloadImage: this.reload,\n          backgroundColor: \"#e2e2e2\",\n          ignoreOffsetY: !0,\n          isError: v\n        },\n        invalidProps: {\n          isValid: w\n        }\n      })), /*#__PURE__*/o.createElement(D, null)));\n    }\n  }]);\n  return c;\n}(o.Component);\nexport { c as VideoPlayer, u as VideoPlayerCtx, c as default };","map":null,"metadata":{},"sourceType":"module"}